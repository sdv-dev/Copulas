

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>scipy.stats._continuous_distns &mdash; Copulas 0.12.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../_static/copulas.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Copulas
          

          
            
            <img src="../../../_static/copulas-200.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing Copulas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#install-with-pip">Install with pip</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#install-with-conda">Install with conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#install-from-source">Install from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../install.html#install-for-development">Install for development</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/00_Quickstart.html">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/00_Quickstart.html#1.-Load-the-data">1. Load the data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/00_Quickstart.html#2.-Create-a-Copula-instance">2. Create a Copula instance</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/00_Quickstart.html#3.-Fit-the-model">3. Fit the model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/00_Quickstart.html#4.-Sample-new-data">4. Sample new data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/00_Quickstart.html#5.-Load-and-save-a-model">5. Load and save a model</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/00_Quickstart.html#6.-Extract-and-set-parameters">6. Extract and set parameters</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/01_Introduction_to_Copulas.html">Introduction to Copulas</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/01_Introduction_to_Copulas.html#Probability-Review">Probability Review</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/01_Introduction_to_Copulas.html#Probability-Density-Function">Probability Density Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/01_Introduction_to_Copulas.html#Cumulative-Distribution-Function">Cumulative Distribution Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/01_Introduction_to_Copulas.html#Probability-Integral-Transform">Probability Integral Transform</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/01_Introduction_to_Copulas.html#Copulas">Copulas</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html">Univariate Distributions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Univariate-Usage-Example">Univariate Usage Example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Fitting-the-model">Fitting the model</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Sampling-new-data">Sampling new data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Probability-Density">Probability Density</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Cumulative-Distribution">Cumulative Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#to_dict-and-from_dict">to_dict and from_dict</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Selecting-the-best-Univariate">Selecting the best Univariate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Fitting-a-generic-Univariate">Fitting a generic Univariate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Recreating-the-Univariate">Recreating the Univariate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/02_Univariate_Distributions.html#Univariate-Families">Univariate Families</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/03_Multivariate_Distributions.html">Multivariate Distributions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/03_Multivariate_Distributions.html#Gaussian-Multivariate">Gaussian Multivariate</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/03_Multivariate_Distributions.html#Fitting-a-Model-and-Generating-Synthetic-Data">Fitting a Model and Generating Synthetic Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/03_Multivariate_Distributions.html#Specifying-column-distributions">Specifying column distributions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/03_Multivariate_Distributions.html#Probability-Density-and-Cumulative-Distribution">Probability Density and Cumulative Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../tutorials/03_Multivariate_Distributions.html#to_dict-and-from_dict">to_dict and from_dict</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/03_Multivariate_Distributions.html#Vine-Copulas">Vine Copulas</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/04_Syntehtic_Data_for_Machine_Learning.html">Synthetic Data for Machine Learning</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/04_Syntehtic_Data_for_Machine_Learning.html#Loading-the-dataset">Loading the dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/04_Syntehtic_Data_for_Machine_Learning.html#Generating-synthetic-data">Generating synthetic data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tutorials/04_Syntehtic_Data_for_Machine_Learning.html#Training-a-linear-model">Training a linear model</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/copulas.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.bivariate.html">copulas.bivariate package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.bivariate.base.html">copulas.bivariate.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.bivariate.clayton.html">copulas.bivariate.clayton module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.bivariate.frank.html">copulas.bivariate.frank module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.bivariate.gumbel.html">copulas.bivariate.gumbel module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.bivariate.independence.html">copulas.bivariate.independence module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.bivariate.utils.html">copulas.bivariate.utils module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.multivariate.html">copulas.multivariate package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.multivariate.base.html">copulas.multivariate.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.multivariate.gaussian.html">copulas.multivariate.gaussian module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.multivariate.tree.html">copulas.multivariate.tree module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.multivariate.vine.html">copulas.multivariate.vine module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.optimize.html">copulas.optimize package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.univariate.html">copulas.univariate package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.base.html">copulas.univariate.base module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.beta.html">copulas.univariate.beta module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.gamma.html">copulas.univariate.gamma module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.gaussian.html">copulas.univariate.gaussian module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.gaussian_kde.html">copulas.univariate.gaussian_kde module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.log_laplace.html">copulas.univariate.log_laplace module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.selection.html">copulas.univariate.selection module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.student_t.html">copulas.univariate.student_t module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.truncated_gaussian.html">copulas.univariate.truncated_gaussian module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../api/copulas.univariate.uniform.html">copulas.univariate.uniform module</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.datasets.html">copulas.datasets module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.errors.html">copulas.errors module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.utils.html">copulas.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../api/copulas.visualization.html">copulas.visualization module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Authors</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Copulas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>scipy.stats._continuous_distns</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for scipy.stats._continuous_distns</h1><div class="highlight"><pre>
<span></span><span class="c1">#</span>
<span class="c1"># Author:  Travis Oliphant  2002-2011 with contributions from</span>
<span class="c1">#          SciPy Developers 2004-2011</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span><span class="p">,</span> <span class="n">cached_property</span>
<span class="kn">import</span> <span class="nn">ctypes</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>
<span class="kn">from</span> <span class="nn">scipy._lib.doccer</span> <span class="kn">import</span> <span class="p">(</span><span class="n">extend_notes_in_docstring</span><span class="p">,</span>
                               <span class="n">replace_notes_in_docstring</span><span class="p">,</span>
                               <span class="n">inherit_docstring_from</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">scipy._lib._ccallback</span> <span class="kn">import</span> <span class="n">LowLevelCallable</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">integrate</span>
<span class="kn">import</span> <span class="nn">scipy.special</span> <span class="k">as</span> <span class="nn">sc</span>

<span class="kn">import</span> <span class="nn">scipy.special._ufuncs</span> <span class="k">as</span> <span class="nn">scu</span>
<span class="kn">from</span> <span class="nn">scipy._lib._util</span> <span class="kn">import</span> <span class="n">_lazyselect</span><span class="p">,</span> <span class="n">_lazywhere</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_stats</span>
<span class="kn">from</span> <span class="nn">._tukeylambda_stats</span> <span class="kn">import</span> <span class="p">(</span><span class="n">tukeylambda_variance</span> <span class="k">as</span> <span class="n">_tlvar</span><span class="p">,</span>
                                 <span class="n">tukeylambda_kurtosis</span> <span class="k">as</span> <span class="n">_tlkurt</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._distn_infrastructure</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">get_distribution_names</span><span class="p">,</span> <span class="n">_kurtosis</span><span class="p">,</span>
    <span class="n">rv_continuous</span><span class="p">,</span> <span class="n">_skew</span><span class="p">,</span> <span class="n">_get_fixed_fit_value</span><span class="p">,</span> <span class="n">_check_shape</span><span class="p">,</span> <span class="n">_ShapeInfo</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._ksstats</span> <span class="kn">import</span> <span class="n">kolmogn</span><span class="p">,</span> <span class="n">kolmognp</span><span class="p">,</span> <span class="n">kolmogni</span>
<span class="kn">from</span> <span class="nn">._constants</span> <span class="kn">import</span> <span class="p">(</span><span class="n">_XMIN</span><span class="p">,</span> <span class="n">_LOGXMIN</span><span class="p">,</span> <span class="n">_EULER</span><span class="p">,</span> <span class="n">_ZETA3</span><span class="p">,</span> <span class="n">_SQRT_PI</span><span class="p">,</span>
                         <span class="n">_SQRT_2_OVER_PI</span><span class="p">,</span> <span class="n">_LOG_SQRT_2_OVER_PI</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">._censored_data</span> <span class="kn">import</span> <span class="n">CensoredData</span>
<span class="kn">import</span> <span class="nn">scipy.stats._boost</span> <span class="k">as</span> <span class="nn">_boost</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root_scalar</span>
<span class="kn">from</span> <span class="nn">scipy.stats._warnings_errors</span> <span class="kn">import</span> <span class="n">FitError</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>


<span class="k">def</span> <span class="nf">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove the optimizer-related keyword arguments &#39;loc&#39;, &#39;scale&#39; and</span>
<span class="sd">    &#39;optimizer&#39; from `kwds`.  Then check that `kwds` is empty, and</span>
<span class="sd">    raise `TypeError(&quot;Unknown arguments: %s.&quot; % kwds)` if it is not.</span>

<span class="sd">    This function is used in the fit method of distributions that override</span>
<span class="sd">    the default method and do not use the default optimization code.</span>

<span class="sd">    `kwds` is modified in-place.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;optimizer&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kwds</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Unknown arguments: </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">kwds</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_call_super_mom</span><span class="p">(</span><span class="n">fun</span><span class="p">):</span>
    <span class="c1"># If fit method is overridden only for MLE and doesn&#39;t specify what to do</span>
    <span class="c1"># if method == &#39;mm&#39; or with censored data, this decorator calls the generic</span>
    <span class="c1"># implementation.</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">censored</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">censored</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">num_censored</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">censored</span><span class="p">:</span>
                <span class="c1"># data is an instance of CensoredData, but actually holds</span>
                <span class="c1"># no censored values, so replace it with the array of</span>
                <span class="c1"># uncensored values.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensored</span>
            <span class="k">return</span> <span class="n">fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">_get_left_bracket</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">,</span> <span class="n">lbrack</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># find left bracket for `root_scalar`. A guess for lbrack may be provided.</span>
    <span class="n">lbrack</span> <span class="o">=</span> <span class="n">lbrack</span> <span class="ow">or</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="n">lbrack</span>

    <span class="c1"># if there is no sign change in `fun` between the brackets, expand</span>
    <span class="c1"># rbrack - lbrack until a sign change occurs</span>
    <span class="k">def</span> <span class="nf">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">):</span>
        <span class="c1"># return true if the signs disagree.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="n">lbrack</span><span class="p">))</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">fun</span><span class="p">(</span><span class="n">rbrack</span><span class="p">))</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">):</span>
        <span class="n">diff</span> <span class="o">*=</span> <span class="mi">2</span>
        <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="n">diff</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The solver could not find a bracket containing a &quot;</span>
               <span class="s2">&quot;root to an MLE first order condition.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">lbrack</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitSolverError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lbrack</span>


<span class="k">class</span> <span class="nc">ksone_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kolmogorov-Smirnov one-sided test statistic distribution.</span>

<span class="sd">    This is the distribution of the one-sided Kolmogorov-Smirnov (KS)</span>
<span class="sd">    statistics :math:`D_n^+` and :math:`D_n^-`</span>
<span class="sd">    for a finite sample size ``n &gt;= 1`` (the shape parameter).</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    kstwobign, kstwo, kstest</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    :math:`D_n^+` and :math:`D_n^-` are given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        D_n^+ &amp;= \text{sup}_x (F_n(x) - F(x)),\\</span>
<span class="sd">        D_n^- &amp;= \text{sup}_x (F(x) - F_n(x)),\\</span>

<span class="sd">    where :math:`F` is a continuous CDF and :math:`F_n` is an empirical CDF.</span>
<span class="sd">    `ksone` describes the distribution under the null hypothesis of the KS test</span>
<span class="sd">    that the empirical CDF corresponds to :math:`n` i.i.d. random variates</span>
<span class="sd">    with CDF :math:`F`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Birnbaum, Z. W. and Tingey, F.H. &quot;One-sided confidence contours</span>
<span class="sd">       for probability distribution functions&quot;, The Annals of Mathematical</span>
<span class="sd">       Statistics, 22(4), pp 592-596 (1951).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">scu</span><span class="o">.</span><span class="n">_smirnovp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_smirnovc</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">smirnov</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_smirnovci</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">smirnovi</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>


<span class="n">ksone</span> <span class="o">=</span> <span class="n">ksone_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ksone&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kstwo_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kolmogorov-Smirnov two-sided test statistic distribution.</span>

<span class="sd">    This is the distribution of the two-sided Kolmogorov-Smirnov (KS)</span>
<span class="sd">    statistic :math:`D_n` for a finite sample size ``n &gt;= 1``</span>
<span class="sd">    (the shape parameter).</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    kstwobign, ksone, kstest</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    :math:`D_n` is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        D_n = \text{sup}_x |F_n(x) - F(x)|</span>

<span class="sd">    where :math:`F` is a (continuous) CDF and :math:`F_n` is an empirical CDF.</span>
<span class="sd">    `kstwo` describes the distribution under the null hypothesis of the KS test</span>
<span class="sd">    that the empirical CDF corresponds to :math:`n` i.i.d. random variates</span>
<span class="sd">    with CDF :math:`F`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Simard, R., L&#39;Ecuyer, P. &quot;Computing the Two-Sided</span>
<span class="sd">       Kolmogorov-Smirnov Distribution&quot;,  Journal of Statistical Software,</span>
<span class="sd">       Vol 39, 11, 1-18 (2011).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="n">n</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">n</span><span class="p">)),</span>
                <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmognp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogn</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">cdf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kolmogni</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">cdf</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="c1"># Use the pdf, (not the ppf) to compute moments</span>
<span class="n">kstwo</span> <span class="o">=</span> <span class="n">kstwo_gen</span><span class="p">(</span><span class="n">momtype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kstwo&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kstwobign_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Limiting distribution of scaled Kolmogorov-Smirnov two-sided test statistic.</span>

<span class="sd">    This is the asymptotic distribution of the two-sided Kolmogorov-Smirnov</span>
<span class="sd">    statistic :math:`\sqrt{n} D_n` that measures the maximum absolute</span>
<span class="sd">    distance of the theoretical (continuous) CDF from the empirical CDF.</span>
<span class="sd">    (see `kstest`).</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ksone, kstwo, kstest</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    :math:`\sqrt{n} D_n` is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        D_n = \text{sup}_x |F_n(x) - F(x)|</span>

<span class="sd">    where :math:`F` is a continuous CDF and :math:`F_n` is an empirical CDF.</span>
<span class="sd">    `kstwobign`  describes the asymptotic distribution (i.e. the limit of</span>
<span class="sd">    :math:`\sqrt{n} D_n`) under the null hypothesis of the KS test that the</span>
<span class="sd">    empirical CDF corresponds to i.i.d. random variates with CDF :math:`F`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Feller, W. &quot;On the Kolmogorov-Smirnov Limit Theorems for Empirical</span>
<span class="sd">       Distributions&quot;,  Ann. Math. Statist. Vol 19, 177-189 (1948).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">scu</span><span class="o">.</span><span class="n">_kolmogp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_kolmogc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">kolmogorov</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_kolmogci</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">kolmogi</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


<span class="n">kstwobign</span> <span class="o">=</span> <span class="n">kstwobign_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kstwobign&#39;</span><span class="p">)</span>


<span class="c1">## Normal distribution</span>

<span class="c1"># loc = mu, scale = std</span>
<span class="c1"># Keep these implementations out of the class definition so they can be reused</span>
<span class="c1"># by other distributions.</span>
<span class="n">_norm_pdf_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">_norm_pdf_logC</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_norm_pdf_C</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">_norm_pdf_C</span>


<span class="k">def</span> <span class="nf">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">_norm_pdf_logC</span>


<span class="k">def</span> <span class="nf">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ndtr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log_ndtr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ndtri</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_norm_isf</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">norm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A normal continuous random variable.</span>

<span class="sd">    The location (``loc``) keyword specifies the mean.</span>
<span class="sd">    The scale (``scale``) keyword specifies the standard deviation.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `norm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{\exp(-x^2/2)}{\sqrt{2\pi}}</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># norm.pdf(x) = exp(-x**2/2)/sqrt(2*pi)</span>
        <span class="k">return</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_isf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@replace_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        For the normal distribution, method of moments and maximum likelihood</span>
<span class="s2">        estimation give identical fits, and explicit formulas for the estimates</span>
<span class="s2">        are available.</span>
<span class="s2">        This function uses these explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the normal distribution parameters, so the</span>
<span class="s2">        `optimizer` and `method` arguments are ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="c1"># Without this check, this function would just return the</span>
            <span class="c1"># parameters that were given.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        @returns Moments of standard normal distribution for integer n &gt;= 0</span>

<span class="sd">        See eq. 16 of https://arxiv.org/abs/1209.4340v2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">factorial2</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.</span>


<span class="n">norm</span> <span class="o">=</span> <span class="n">norm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;norm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">alpha_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An alpha continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `alpha` ([1]_, [2]_) is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{1}{x^2 \Phi(a) \sqrt{2\pi}} *</span>
<span class="sd">                  \exp(-\frac{1}{2} (a-1/x)^2)</span>

<span class="sd">    where :math:`\Phi` is the normal CDF, :math:`x &gt; 0`, and :math:`a &gt; 0`.</span>

<span class="sd">    `alpha` takes ``a`` as a shape parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Johnson, Kotz, and Balakrishnan, &quot;Continuous Univariate</span>
<span class="sd">           Distributions, Volume 1&quot;, Second Edition, John Wiley and Sons,</span>
<span class="sd">           p. 173 (1994).</span>
<span class="sd">    .. [2] Anthony A. Salvia, &quot;Reliability applications of the Alpha</span>
<span class="sd">           Distribution&quot;, IEEE Transactions on Reliability, Vol. R-34,</span>
<span class="sd">           No. 3, pp. 251-252 (1985).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># alpha.pdf(x, a) = 1/(x**2*Phi(a)*sqrt(2*pi)) * exp(-1/2 * (a-1/x)**2)</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span><span class="o">*</span><span class="mi">2</span>


<span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;alpha&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">anglit_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An anglit continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `anglit` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \sin(2x + \pi/2) = \cos(2x)</span>

<span class="sd">    for :math:`-\pi/4 \le x \le \pi/4`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># anglit.pdf(x) = sin(2*x + \pi/2) = cos(2*x)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span> <span class="o">**</span> <span class="mf">2.0</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">16</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">96</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">8</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">anglit</span> <span class="o">=</span> <span class="n">anglit_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;anglit&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">arcsine_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An arcsine continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `arcsine` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi \sqrt{x (1-x)}}</span>

<span class="sd">    for :math:`0 &lt; x &lt; 1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># arcsine.pdf(x) = 1/(pi*sqrt(x*(1-x)))</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">8</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.24156447527049044468</span>


<span class="n">arcsine</span> <span class="o">=</span> <span class="n">arcsine_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;arcsine&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FitDataError</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Raised when input data is inconsistent with fixed parameters.&quot;&quot;&quot;</span>
    <span class="c1"># This exception is raised by, for example, beta_gen.fit when both floc</span>
    <span class="c1"># and fscale are fixed and there are values in the data not in the open</span>
    <span class="c1"># interval (floc, floc+fscale).</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distr</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Invalid values in `data`.  Maximum likelihood &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;estimation with </span><span class="si">{</span><span class="n">distr</span><span class="si">!r}</span><span class="s2"> requires that </span><span class="si">{</span><span class="n">lower</span><span class="si">!r}</span><span class="s2"> &lt; &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;(x - loc)/scale  &lt; </span><span class="si">{</span><span class="n">upper</span><span class="si">!r}</span><span class="s2"> for each x in `data`.&quot;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">FitSolverError</span><span class="p">(</span><span class="n">FitError</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised when a solver fails to converge while fitting a distribution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This exception is raised by, for example, beta_gen.fit when</span>
    <span class="c1"># optimize.fsolve returns with ier != 1.</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesg</span><span class="p">):</span>
        <span class="n">emsg</span> <span class="o">=</span> <span class="s2">&quot;Solver for the MLE equations failed to converge: &quot;</span>
        <span class="n">emsg</span> <span class="o">+=</span> <span class="n">mesg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">emsg</span><span class="p">,)</span>


<span class="k">def</span> <span class="nf">_beta_mle_a</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s1</span><span class="p">):</span>
    <span class="c1"># The zeros of this function give the MLE for `a`, with</span>
    <span class="c1"># `b`, `n` and `s1` given.  `s1` is the sum of the logs of</span>
    <span class="c1"># the data. `n` is the number of data points.</span>
    <span class="n">psiab</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">func</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">psiab</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">def</span> <span class="nf">_beta_mle_ab</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">):</span>
    <span class="c1"># Zeros of this function are critical points of</span>
    <span class="c1"># the maximum likelihood function.  Solving this system</span>
    <span class="c1"># for theta (which contains a and b) gives the MLE for a and b</span>
    <span class="c1"># given `n`, `s1` and `s2`.  `s1` is the sum of the logs of the data,</span>
    <span class="c1"># and `s2` is the sum of the logs of 1 - data.  `n` is the number</span>
    <span class="c1"># of data points.</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">theta</span>
    <span class="n">psiab</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">func</span> <span class="o">=</span> <span class="p">[</span><span class="n">s1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">psiab</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span>
            <span class="n">s2</span> <span class="o">-</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">psiab</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">b</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">func</span>


<span class="k">class</span> <span class="nc">beta_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A beta continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `beta` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{\Gamma(a+b) x^{a-1} (1-x)^{b-1}}</span>
<span class="sd">                          {\Gamma(a) \Gamma(b)}</span>

<span class="sd">    for :math:`0 &lt;= x &lt;= 1`, :math:`a &gt; 0`, :math:`b &gt; 0`, where</span>
<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `beta` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1">#                     gamma(a+b) * x**(a-1) * (1-x)**(b-1)</span>
        <span class="c1"># beta.pdf(x, a, b) = ------------------------------------</span>
        <span class="c1">#                              gamma(a)*gamma(b)</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">lPx</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">lPx</span> <span class="o">-=</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lPx</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">betainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_mean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_variance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_skewness</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_beta_kurtosis_excess</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>

        <span class="n">g1</span> <span class="o">=</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_kurtosis</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">sk</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>
            <span class="n">ku</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ku</span> <span class="o">/=</span> <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ku</span> <span class="o">*=</span> <span class="mi">6</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">sk</span><span class="o">-</span><span class="n">g1</span><span class="p">,</span> <span class="n">ku</span><span class="o">-</span><span class="n">g2</span><span class="p">]</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        In the special case where `method=&quot;MLE&quot;` and</span>
<span class="s2">        both `floc` and `fscale` are given, a</span>
<span class="s2">        `ValueError` is raised if any value `x` in `data` does not satisfy</span>
<span class="s2">        `floc &lt; x &lt; floc + fscale`.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1"># Override rv_continuous.fit, so we can more efficiently handle the</span>
        <span class="c1"># case where floc and fscale are given.</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># do general fit</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># We already got these from kwds, so just pop them.</span>
        <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">f0</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="s1">&#39;fa&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_a&#39;</span><span class="p">])</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f1&#39;</span><span class="p">,</span> <span class="s1">&#39;fb&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_b&#39;</span><span class="p">])</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">f1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="c1"># Special case: loc and scale are constrained, so we are fitting</span>
        <span class="c1"># just the shape parameters.  This can be done much more efficiently</span>
        <span class="c1"># than the method used in `rv_continuous.fit`.  (See the subsection</span>
        <span class="c1"># &quot;Two unknown parameters&quot; in the section &quot;Maximum likelihood&quot; of</span>
        <span class="c1"># the Wikipedia article on the Beta distribution for the formulas.)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="c1"># Normalize the data to the interval [0, 1].</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">floc</span><span class="p">)</span> <span class="o">/</span> <span class="n">fscale</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">floc</span> <span class="o">+</span> <span class="n">fscale</span><span class="p">)</span>

        <span class="n">xbar</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">f1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># One of the shape parameters is fixed.</span>

            <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># The shape parameter a is fixed, so swap the parameters</span>
                <span class="c1"># and flip the data.  We always solve for `a`.  The result</span>
                <span class="c1"># will be swapped back before returning.</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">f0</span>
                <span class="n">data</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">data</span>
                <span class="n">xbar</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">f1</span>

            <span class="c1"># Initial guess for a.  Use the formula for the mean of the beta</span>
            <span class="c1"># distribution, E[x] = a / (a + b), to generate a reasonable</span>
            <span class="c1"># starting point based on the mean of the data and the given</span>
            <span class="c1"># value of b.</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">xbar</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span><span class="p">)</span>

            <span class="c1"># Compute the MLE for `a` by solving _beta_mle_a.</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">mesg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span>
                <span class="n">_beta_mle_a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()),</span>
                <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitSolverError</span><span class="p">(</span><span class="n">mesg</span><span class="o">=</span><span class="n">mesg</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">theta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># The shape parameter a was fixed, so swap back the</span>
                <span class="c1"># parameters.</span>
                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Neither of the shape parameters is fixed.</span>

            <span class="c1"># s1 and s2 are used in the extra arguments passed to _beta_mle_ab</span>
            <span class="c1"># by optimize.fsolve.</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="c1"># Use the &quot;method of moments&quot; to estimate the initial</span>
            <span class="c1"># guess for a and b.</span>
            <span class="n">fac</span> <span class="o">=</span> <span class="n">xbar</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span><span class="p">)</span> <span class="o">/</span> <span class="n">data</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">ddof</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">xbar</span> <span class="o">*</span> <span class="n">fac</span>
            <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xbar</span><span class="p">)</span> <span class="o">*</span> <span class="n">fac</span>

            <span class="c1"># Compute the MLE for a and b by solving _beta_mle_ab.</span>
            <span class="n">theta</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">mesg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span>
                <span class="n">_beta_mle_ab</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
                <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">),</span>
                <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitSolverError</span><span class="p">(</span><span class="n">mesg</span><span class="o">=</span><span class="n">mesg</span><span class="p">)</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">theta</span>

        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">regular</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span>
                    <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">asymptotic_ab_large</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="n">sum_ab</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
            <span class="n">log_term</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sum_ab</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="mi">110</span><span class="o">/</span><span class="n">sum_ab</span> <span class="o">+</span> <span class="mi">20</span><span class="o">*</span><span class="n">sum_ab</span><span class="o">**-</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">sum_ab</span><span class="o">**-</span><span class="mf">3.0</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">sum_ab</span><span class="o">**-</span><span class="mf">4.0</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="o">/</span><span class="n">a</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">a</span><span class="o">**-</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">a</span><span class="o">**-</span><span class="mf">3.0</span> <span class="o">+</span> <span class="n">a</span><span class="o">**-</span><span class="mf">4.0</span>
            <span class="n">t3</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="o">/</span><span class="n">b</span> <span class="o">-</span> <span class="mi">10</span><span class="o">*</span><span class="n">b</span><span class="o">**-</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">b</span><span class="o">**-</span><span class="mf">3.0</span> <span class="o">+</span> <span class="n">b</span><span class="o">**-</span><span class="mf">4.0</span>
            <span class="k">return</span> <span class="n">log_term</span> <span class="o">+</span> <span class="p">(</span><span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">t3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">120</span>

        <span class="k">def</span> <span class="nf">asymptotic_b_large</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="n">sum_ab</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span>
                <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="o">**-</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">12</span> <span class="o">-</span> <span class="n">b</span><span class="o">**-</span><span class="mf">3.0</span><span class="o">/</span><span class="mi">120</span> <span class="o">+</span> <span class="n">b</span><span class="o">**-</span><span class="mf">4.0</span><span class="o">/</span><span class="mi">120</span>
                <span class="o">+</span> <span class="n">b</span><span class="o">**-</span><span class="mf">5.0</span><span class="o">/</span><span class="mi">252</span> <span class="o">-</span> <span class="n">b</span><span class="o">**-</span><span class="mf">6.0</span><span class="o">/</span><span class="mi">252</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">sum_ab</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">sum_ab</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">sum_ab</span><span class="o">**-</span><span class="mf">2.0</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="n">sum_ab</span><span class="o">**-</span><span class="mf">3.0</span><span class="o">/</span><span class="mi">120</span> <span class="o">-</span> <span class="n">sum_ab</span><span class="o">**-</span><span class="mf">4.0</span><span class="o">/</span><span class="mi">60</span>
                <span class="o">-</span> <span class="n">sum_ab</span><span class="o">**-</span><span class="mf">5.0</span><span class="o">/</span><span class="mi">252</span> <span class="o">+</span> <span class="n">sum_ab</span><span class="o">**-</span><span class="mf">6.0</span><span class="o">/</span><span class="mi">126</span>
            <span class="p">)</span>
            <span class="n">log_term</span> <span class="o">=</span> <span class="n">sum_ab</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sum_ab</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">log_term</span>

        <span class="k">def</span> <span class="nf">threshold_large</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1000</span>

            <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">digits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">digits</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span>
            <span class="k">return</span> <span class="n">d</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="mi">7</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">4.96e6</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="mf">4.96e6</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">asymptotic_ab_large</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mf">4.9e6</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">-</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">1e6</span> <span class="ow">and</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="n">threshold_large</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">asymptotic_b_large</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mf">4.9e6</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="mf">1e6</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="n">threshold_large</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">asymptotic_b_large</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">regular</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>


<span class="n">beta</span> <span class="o">=</span> <span class="n">beta_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;beta&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">betaprime_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A beta prime continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `betaprime` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{x^{a-1} (1+x)^{-a-b}}{\beta(a, b)}</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`a &gt; 0`, :math:`b &gt; 0`, where</span>
<span class="sd">    :math:`\beta(a, b)` is the beta function (see `scipy.special.beta`).</span>

<span class="sd">    `betaprime` takes ``a`` and ``b`` as shape parameters.</span>

<span class="sd">    The distribution is related to the `beta` distribution as follows:</span>
<span class="sd">    If :math:`X` follows a beta distribution with parameters :math:`a, b`,</span>
<span class="sd">    then :math:`Y = X/(1-X)` has a beta prime distribution with</span>
<span class="sd">    parameters :math:`a, b` ([1]_).</span>

<span class="sd">    The beta prime distribution is a reparametrized version of the</span>
<span class="sd">    F distribution.  The beta prime distribution with shape parameters</span>
<span class="sd">    ``a`` and ``b`` and ``scale = s`` is equivalent to the F distribution</span>
<span class="sd">    with parameters ``d1 = 2*a``, ``d2 = 2*b`` and ``scale = (a/b)*s``.</span>
<span class="sd">    For example,</span>

<span class="sd">    &gt;&gt;&gt; from scipy.stats import betaprime, f</span>
<span class="sd">    &gt;&gt;&gt; x = [1, 2, 5, 10]</span>
<span class="sd">    &gt;&gt;&gt; a = 12</span>
<span class="sd">    &gt;&gt;&gt; b = 5</span>
<span class="sd">    &gt;&gt;&gt; betaprime.pdf(x, a, b, scale=2)</span>
<span class="sd">    array([0.00541179, 0.08331299, 0.14669185, 0.03150079])</span>
<span class="sd">    &gt;&gt;&gt; f.pdf(x, 2*a, 2*b, scale=(a/b)*2)</span>
<span class="sd">    array([0.00541179, 0.08331299, 0.14669185, 0.03150079])</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Beta prime distribution, Wikipedia,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Beta_prime_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u1</span> <span class="o">/</span> <span class="n">u2</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># betaprime.pdf(x, a, b) = x**(a-1) * (1+x)**(-a-b) / beta(a, b)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># note: f2 is the direct way to compute the cdf if the relationship</span>
        <span class="c1"># to the beta distribution is used.</span>
        <span class="c1"># however, for very large x, x/(1+x) == 1. since the distribution</span>
        <span class="c1"># has very fat tails if b is small, this can cause inaccurate results</span>
        <span class="c1"># use the following relationship of the incomplete beta function:</span>
        <span class="c1"># betainc(x, a, b) = 1 - betainc(1-x, b, a)</span>
        <span class="c1"># see gh-17631</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
            <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span><span class="p">:</span> <span class="n">beta</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x_</span><span class="p">),</span> <span class="n">b_</span><span class="p">,</span> <span class="n">a_</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span><span class="p">:</span> <span class="n">beta</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x_</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x_</span><span class="p">),</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
            <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span><span class="p">:</span> <span class="n">beta</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x_</span><span class="p">),</span> <span class="n">b_</span><span class="p">,</span> <span class="n">a_</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span><span class="p">:</span> <span class="n">beta</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x_</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x_</span><span class="p">),</span> <span class="n">a_</span><span class="p">,</span> <span class="n">b_</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="c1"># by default, compute compute the ppf by solving the following:</span>
        <span class="c1"># p = beta._cdf(x/(1+x), a, b). This implies x = r/(1-r) with</span>
        <span class="c1"># r = beta._ppf(p, a, b). This can cause numerical issues if r is</span>
        <span class="c1"># very close to 1. in that case, invert the alternative expression of</span>
        <span class="c1"># the cdf: p = beta._sf(1/(1+x), b, a).</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mf">0.9999</span><span class="p">)</span>
        <span class="n">out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">stats</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">_isf</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">b</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([(</span><span class="n">a</span><span class="o">+</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="n">betaprime</span> <span class="o">=</span> <span class="n">betaprime_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;betaprime&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">bradford_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Bradford continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `bradford` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{c}{\log(1+c) (1+cx)}</span>

<span class="sd">    for :math:`0 &lt;= x &lt;= 1` and :math:`c &gt; 0`.</span>

<span class="sd">    `bradford` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># bradford.pdf(x, c) = c / (k * (1+c*x))</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span><span class="o">+</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">9</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">))</span>
            <span class="n">g1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">6</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="mi">24</span><span class="p">)</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span>
                  <span class="mi">6</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">k</span><span class="o">-</span><span class="mi">14</span><span class="p">)</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">g2</span> <span class="o">/=</span> <span class="mi">3</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>


<span class="n">bradford</span> <span class="o">=</span> <span class="n">bradford_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bradford&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">burr_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Burr (Type III) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fisk : a special case of either `burr` or `burr12` with ``d=1``</span>
<span class="sd">    burr12 : Burr Type XII distribution</span>
<span class="sd">    mielke : Mielke Beta-Kappa / Dagum distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `burr` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x; c, d) = c d \frac{x^{-c - 1}}</span>
<span class="sd">                              {{(1 + x^{-c})}^{d + 1}}</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c, d &gt; 0`.</span>

<span class="sd">    `burr` takes ``c`` and ``d`` as shape parameters for :math:`c` and</span>
<span class="sd">    :math:`d`.</span>

<span class="sd">    This is the PDF corresponding to the third CDF given in Burr&#39;s list;</span>
<span class="sd">    specifically, it is equation (11) in Burr&#39;s paper [1]_. The distribution</span>
<span class="sd">    is also commonly referred to as the Dagum distribution [2]_. If the</span>
<span class="sd">    parameter :math:`c &lt; 1` then the mean of the distribution does not</span>
<span class="sd">    exist and if :math:`c &lt; 2` the variance does not exist [2]_.</span>
<span class="sd">    The PDF is finite at the left endpoint :math:`x = 0` if :math:`c * d &gt;= 1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Burr, I. W. &quot;Cumulative frequency functions&quot;, Annals of</span>
<span class="sd">       Mathematical Statistics, 13(2), pp 215-232 (1942).</span>
<span class="sd">    .. [2] https://en.wikipedia.org/wiki/Dagum_distribution</span>
<span class="sd">    .. [3] Kleiber, Christian. &quot;A guide to the Dagum distributions.&quot;</span>
<span class="sd">       Modeling Income Distributions and Lorenz Curves  pp 97-117 (2008).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Do not set _support_mask to rv_continuous._open_support_mask</span>
    <span class="c1"># Whether the left-hand endpoint is suitable for pdf evaluation is dependent</span>
    <span class="c1"># on the values of c and d: if c*d &gt;= 1, the pdf is finite, otherwise infinite.</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="nb">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># burr.pdf(x, c, d) = c * d * x**(-c-1) * (1+x**(-c))**(-d-1)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">],</span>
            <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="n">c_</span> <span class="o">*</span> <span class="n">d_</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_</span><span class="o">**</span><span class="p">(</span><span class="n">c_</span><span class="o">*</span><span class="n">d_</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x_</span><span class="o">**</span><span class="n">c_</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="p">(</span><span class="n">c_</span> <span class="o">*</span> <span class="n">d_</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">c_</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">/</span>
                                   <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x_</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">c_</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="n">d_</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="p">[()]</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">],</span>
            <span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c_</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c_</span><span class="o">*</span><span class="n">d_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_</span><span class="p">)</span>
                                <span class="o">-</span> <span class="p">(</span><span class="n">d_</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x_</span><span class="o">**</span><span class="p">(</span><span class="n">c_</span><span class="p">))),</span>
            <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x_</span><span class="p">,</span> <span class="n">c_</span><span class="p">,</span> <span class="n">d_</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c_</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d_</span><span class="p">)</span>
                                   <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="o">-</span><span class="n">c_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_</span><span class="p">)</span>
                                   <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">d_</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x_</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c_</span><span class="p">))))</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span><span class="p">[()]</span>
        <span class="k">return</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">d</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">_q</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">_q</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span>
        <span class="c1"># ek is the kth raw moment, e1 is the mean e2-e1**2 variance etc.</span>
        <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">e4</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">nc</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">nc</span><span class="p">)</span> <span class="o">*</span> <span class="n">d</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">mu2_if_c</span> <span class="o">=</span> <span class="n">e2</span> <span class="o">-</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">c</span> <span class="o">&gt;</span> <span class="mf">3.0</span><span class="p">,</span>
            <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">:</span> <span class="p">((</span><span class="n">e3</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">e2</span><span class="o">*</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">e1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                                             <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">mu2_if_c</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span>
            <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">c</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">,</span>
            <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">e4</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">,</span> <span class="n">e3</span><span class="p">,</span> <span class="n">e4</span><span class="p">,</span> <span class="n">mu2_if_c</span><span class="p">:</span> <span class="p">(</span>
                <span class="p">((</span><span class="n">e4</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">e3</span><span class="o">*</span><span class="n">e1</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">e2</span><span class="o">*</span><span class="n">e1</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">e1</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu2_if_c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">mu</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">mu2</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">g1</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">g2</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">nc</span><span class="p">,</span> <span class="n">d</span> <span class="o">+</span> <span class="n">nc</span><span class="p">)</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">c</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>


<span class="n">burr</span> <span class="o">=</span> <span class="n">burr_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;burr&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">burr12_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Burr (Type XII) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    fisk : a special case of either `burr` or `burr12` with ``d=1``</span>
<span class="sd">    burr : Burr Type III distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `burr12` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x; c, d) = c d \frac{x^{c-1}}</span>
<span class="sd">                              {(1 + x^c)^{d + 1}}</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c, d &gt; 0`.</span>

<span class="sd">    `burr12` takes ``c`` and ``d`` as shape parameters for :math:`c`</span>
<span class="sd">    and :math:`d`.</span>

<span class="sd">    This is the PDF corresponding to the twelfth CDF given in Burr&#39;s list;</span>
<span class="sd">    specifically, it is equation (20) in Burr&#39;s paper [1]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The Burr type 12 distribution is also sometimes referred to as</span>
<span class="sd">    the Singh-Maddala distribution from NIST [2]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Burr, I. W. &quot;Cumulative frequency functions&quot;, Annals of</span>
<span class="sd">       Mathematical Statistics, 13(2), pp 215-232 (1942).</span>

<span class="sd">    .. [2] https://www.itl.nist.gov/div898/software/dataplot/refman2/auxillar/b12pdf.htm</span>

<span class="sd">    .. [3] &quot;Burr distribution&quot;,</span>
<span class="sd">       https://en.wikipedia.org/wiki/Burr_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="nb">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># burr12.pdf(x, c, d) = c * d * x**(c-1) * (1+x**(c))**(-d-1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="o">-</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># The following is an implementation of</span>
        <span class="c1">#   ((1 - q)**(-1.0/d) - 1)**(1.0/c)</span>
        <span class="c1"># that does a better job handling small values of q.</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">d</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">moment_if_exists</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">d</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">nc</span><span class="p">,</span> <span class="n">d</span> <span class="o">-</span> <span class="n">nc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">moment_if_exists</span><span class="p">,</span>
                          <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>


<span class="n">burr12</span> <span class="o">=</span> <span class="n">burr12_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;burr12&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">fisk_gen</span><span class="p">(</span><span class="n">burr_gen</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Fisk continuous random variable.</span>

<span class="sd">    The Fisk distribution is also known as the log-logistic distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    burr</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `fisk` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{c x^{c-1}}</span>
<span class="sd">                       {(1 + x^c)^2}</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c &gt; 0`.</span>

<span class="sd">    Please note that the above expression can be transformed into the following</span>
<span class="sd">    one, which is also commonly used:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{c x^{-c-1}}</span>
<span class="sd">                       {(1 + x^{-c})^2}</span>

<span class="sd">    `fisk` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    `fisk` is a special case of `burr` or `burr12` with ``d=1``.</span>

<span class="sd">    Suppose ``X`` is a logistic random variable with location ``l``</span>
<span class="sd">    and scale ``s``. Then ``Y = exp(X)`` is a Fisk (log-logistic)</span>
<span class="sd">    random variable with ``scale = exp(l)`` and shape ``c = 1/s``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># fisk.pdf(x, c) = c * x**(-c-1) * (1 + x**(-c))**(-2)</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># fisk.pdf(x, c) = c * x**(-c-1) * (1 + x**(-c))**(-2)</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_isf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">burr</span><span class="o">.</span><span class="n">_stats</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>


<span class="n">fisk</span> <span class="o">=</span> <span class="n">fisk_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fisk&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">cauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `cauchy` is</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi (1 + x^2)}</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># cauchy.pdf(x) = 1 / (pi * (1 + x**2))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Initialize ML guesses using quartiles instead of moments.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="n">p25</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="n">p75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">p50</span><span class="p">,</span> <span class="p">(</span><span class="n">p75</span> <span class="o">-</span> <span class="n">p25</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<span class="n">cauchy</span> <span class="o">=</span> <span class="n">cauchy_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;cauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">chi_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A chi continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `chi` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k) = \frac{1}{2^{k/2-1} \Gamma \left( k/2 \right)}</span>
<span class="sd">                   x^{k-1} \exp \left( -x^2/2 \right)</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`k &gt; 0` (degrees of freedom, denoted ``df``</span>
<span class="sd">    in the implementation). :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    Special cases of `chi` are:</span>

<span class="sd">        - ``chi(1, loc, scale)`` is equivalent to `halfnorm`</span>
<span class="sd">        - ``chi(2, 0, scale)`` is equivalent to `rayleigh`</span>
<span class="sd">        - ``chi(3, 0, scale)`` is equivalent to `maxwell`</span>

<span class="sd">    `chi` takes ``df`` as a shape parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">chi2</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1">#                   x**(df-1) * exp(-x**2/2)</span>
        <span class="c1"># chi.pdf(x, df) =  -------------------------</span>
        <span class="c1">#                   2**(df/2-1) * gamma(df/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">df</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">l</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="mf">.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="mf">.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="mf">.5</span><span class="o">*</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># poch(df/2, 1/2) = gamma(df/2 + 1/2) / gamma(df/2)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">poch</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">df</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">df</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="n">mu</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mf">3.0</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">df</span><span class="p">)</span><span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">df</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">regular_formula</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">.5</span> <span class="o">*</span> <span class="n">df</span><span class="p">)</span>
                    <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">df</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">asymptotic_formula</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span>
                    <span class="o">-</span> <span class="mi">4</span><span class="o">/</span><span class="mi">45</span><span class="o">*</span><span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="mi">15</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">df</span> <span class="o">&lt;</span> <span class="mf">3e2</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">),</span> <span class="n">regular_formula</span><span class="p">,</span>
                          <span class="n">f2</span><span class="o">=</span><span class="n">asymptotic_formula</span><span class="p">)</span>


<span class="n">chi</span> <span class="o">=</span> <span class="n">chi_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;chi&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">chi2_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A chi-squared continuous random variable.</span>

<span class="sd">    For the noncentral chi-square distribution, see `ncx2`.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ncx2</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `chi2` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k) = \frac{1}{2^{k/2} \Gamma \left( k/2 \right)}</span>
<span class="sd">                   x^{k/2-1} \exp \left( -x/2 \right)</span>

<span class="sd">    for :math:`x &gt; 0`  and :math:`k &gt; 0` (degrees of freedom, denoted ``df``</span>
<span class="sd">    in the implementation).</span>

<span class="sd">    `chi2` takes ``df`` as a shape parameter.</span>

<span class="sd">    The chi-squared distribution is a special case of the gamma</span>
<span class="sd">    distribution, with gamma parameters ``a = df/2``, ``loc = 0`` and</span>
<span class="sd">    ``scale = 2``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">chisquare</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># chi2.pdf(x, df) = 1 / (2*gamma(df/2)) * (x/2)**(df/2-1) * exp(-x/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mf">2.</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">/</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">df</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chdtr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chdtrc</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chdtri</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">df</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">df</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">12.0</span><span class="o">/</span><span class="n">df</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">half_df</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">df</span>

        <span class="k">def</span> <span class="nf">regular_formula</span><span class="p">(</span><span class="n">half_df</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">half_df</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">half_df</span><span class="p">)</span> <span class="o">+</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">half_df</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">half_df</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">asymptotic_formula</span><span class="p">(</span><span class="n">half_df</span><span class="p">):</span>
            <span class="c1"># plug in the above formula the following asymptotic</span>
            <span class="c1"># expansions:</span>
            <span class="c1"># ln(gamma(a)) ~ (a - 0.5) * ln(a) - a + 0.5 * ln(2 * pi) +</span>
            <span class="c1">#                 1/(12 * a) - 1/(360 * a**3)</span>
            <span class="c1"># psi(a) ~ ln(a) - 1/(2 * a) - 1/(3 * a**2) + 1/120 * a**4)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
            <span class="n">h</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">/</span><span class="n">half_df</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span> <span class="o">+</span> <span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">/</span><span class="mi">45</span> <span class="o">+</span> <span class="n">h</span><span class="o">/</span><span class="mf">7.5</span><span class="p">)))</span> <span class="o">+</span>
                    <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">half_df</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">half_df</span> <span class="o">&lt;</span> <span class="mi">125</span><span class="p">,</span> <span class="p">(</span><span class="n">half_df</span><span class="p">,</span> <span class="p">),</span>
                          <span class="n">regular_formula</span><span class="p">,</span>
                          <span class="n">f2</span><span class="o">=</span><span class="n">asymptotic_formula</span><span class="p">)</span>


<span class="n">chi2</span> <span class="o">=</span> <span class="n">chi2_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;chi2&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">cosine_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A cosine continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The cosine distribution is an approximation to the normal distribution.</span>
<span class="sd">    The probability density function for `cosine` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{2\pi} (1+\cos(x))</span>

<span class="sd">    for :math:`-\pi \le x \le \pi`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># cosine.pdf(x) = 1/(2*pi) * (1+cos(x))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                          <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                          <span class="n">fillvalue</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_cosine_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_cosine_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">scu</span><span class="o">.</span><span class="n">_cosine_invcdf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">scu</span><span class="o">.</span><span class="n">_cosine_invcdf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span>
        <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mf">6.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mi">90</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">5.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="mf">1.0</span>


<span class="n">cosine</span> <span class="o">=</span> <span class="n">cosine_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">dgamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A double gamma continuous random variable.</span>

<span class="sd">    The double gamma distribution is also known as the reflected gamma</span>
<span class="sd">    distribution [1]_.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `dgamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{1}{2\Gamma(a)} |x|^{a-1} \exp(-|x|)</span>

<span class="sd">    for a real number :math:`x` and :math:`a &gt; 0`. :math:`\Gamma` is the</span>
<span class="sd">    gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `dgamma` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Johnson, Kotz, and Balakrishnan, &quot;Continuous Univariate</span>
<span class="sd">           Distributions, Volume 1&quot;, Second Edition, John Wiley and Sons</span>
<span class="sd">           (1994).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">gm</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">gm</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># dgamma.pdf(x, a) = 1 / (2*gamma(a)) * abs(x)**(a-1) * exp(-abs(x))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">a</span><span class="p">))</span><span class="o">*</span><span class="n">ax</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ax</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="o">-</span> <span class="n">ax</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                        <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
                        <span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">gamma</span><span class="o">.</span><span class="n">_entropy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span>
                        <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                        <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">2.0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mf">3.0</span><span class="p">)</span><span class="o">/</span><span class="n">mu2</span><span class="o">-</span><span class="mf">3.0</span>


<span class="n">dgamma</span> <span class="o">=</span> <span class="n">dgamma_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dgamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">dweibull_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A double Weibull continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `dweibull` is given by</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c / 2 |x|^{c-1} \exp(-|x|^c)</span>

<span class="sd">    for a real number :math:`x` and :math:`c &gt; 0`.</span>

<span class="sd">    `dweibull` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">weibull_min</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">u</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># dweibull.pdf(x, c) = c / 2 * abs(x)**(c-1) * exp(-abs(x)**c)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">ax</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">ax</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Px</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">ax</span><span class="p">)</span> <span class="o">-</span> <span class="n">ax</span><span class="o">**</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">Cx1</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Cx1</span><span class="p">,</span> <span class="n">Cx1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fac</span><span class="p">),</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">fac</span><span class="p">,</span> <span class="o">-</span><span class="n">fac</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">half_weibull_min_sf</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">stats</span><span class="o">.</span><span class="n">weibull_min</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">half_weibull_min_sf</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">half_weibull_min_sf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">double_q</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">weibull_min_isf</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">weibull_min</span><span class="o">.</span><span class="n">_isf</span><span class="p">(</span><span class="n">double_q</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">weibull_min_isf</span><span class="p">,</span> <span class="n">weibull_min_isf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>

    <span class="c1"># since we know that all odd moments are zeros, return them at once.</span>
    <span class="c1"># returning Nones from _stats makes the public stats call _munp</span>
    <span class="c1"># so overall we&#39;re saving one or two gamma function evaluations here.</span>
    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">weibull_min</span><span class="o">.</span><span class="n">_entropy</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span>


<span class="n">dweibull</span> <span class="o">=</span> <span class="n">dweibull_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dweibull&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">expon_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponential continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `expon` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(-x)</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    A common parameterization for `expon` is in terms of the rate parameter</span>
<span class="sd">    ``lambda``, such that ``pdf = lambda * exp(-lambda * x)``. This</span>
<span class="sd">    parameterization corresponds to using ``scale = 1 / lambda``.</span>

<span class="sd">    The exponential distribution is a special case of the gamma</span>
<span class="sd">    distributions, with gamma shape parameter ``a = 1``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_exponential</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># expon.pdf(x) = exp(-x)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">6.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@replace_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        When `method=&#39;MLE&#39;`,</span>
<span class="s2">        this function uses explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the exponential distribution parameters, so the</span>
<span class="s2">        `optimizer`, `loc` and `scale` keyword arguments are</span>
<span class="s2">        ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many arguments.&quot;</span><span class="p">)</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="n">data_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ML estimate of the location is the minimum of the data.</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data_min</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
            <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="n">loc</span><span class="p">:</span>
                <span class="c1"># There are values that are less than the specified loc.</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;expon&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># ML estimate of the scale is the shifted mean.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">loc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="c1"># We expect the return values to be floating point, so ensure it</span>
        <span class="c1"># by explicitly converting to float.</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>


<span class="n">expon</span> <span class="o">=</span> <span class="n">expon_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;expon&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">exponnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponentially modified Normal continuous random variable.</span>

<span class="sd">    Also known as the exponentially modified Gaussian distribution [1]_.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `exponnorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, K) = \frac{1}{2K} \exp\left(\frac{1}{2 K^2} - x / K \right)</span>
<span class="sd">                  \text{erfc}\left(-\frac{x - 1/K}{\sqrt{2}}\right)</span>

<span class="sd">    where :math:`x` is a real number and :math:`K &gt; 0`.</span>

<span class="sd">    It can be thought of as the sum of a standard normal random variable</span>
<span class="sd">    and an independent exponentially distributed random variable with rate</span>
<span class="sd">    ``1/K``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    An alternative parameterization of this distribution (for example, in</span>
<span class="sd">    the Wikipedia article [1]_) involves three parameters, :math:`\mu`,</span>
<span class="sd">    :math:`\lambda` and :math:`\sigma`.</span>

<span class="sd">    In the present parameterization this corresponds to having ``loc`` and</span>
<span class="sd">    ``scale`` equal to :math:`\mu` and :math:`\sigma`, respectively, and</span>
<span class="sd">    shape parameter :math:`K = 1/(\sigma\lambda)`.</span>

<span class="sd">    .. versionadded:: 0.16.0</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Exponentially modified Gaussian distribution, Wikipedia,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Exponentially_modified_Gaussian_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">expval</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_exponential</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">K</span>
        <span class="n">gval</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expval</span> <span class="o">+</span> <span class="n">gval</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">invK</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">K</span>
        <span class="n">exparg</span> <span class="o">=</span> <span class="n">invK</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">invK</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exparg</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">invK</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">invK</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">K</span>
        <span class="n">expval</span> <span class="o">=</span> <span class="n">invK</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">invK</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">logprod</span> <span class="o">=</span> <span class="n">expval</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">invK</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logprod</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">invK</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">K</span>
        <span class="n">expval</span> <span class="o">=</span> <span class="n">invK</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">invK</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">logprod</span> <span class="o">=</span> <span class="n">expval</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">invK</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logprod</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">):</span>
        <span class="n">K2</span> <span class="o">=</span> <span class="n">K</span> <span class="o">*</span> <span class="n">K</span>
        <span class="n">opK2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="n">K2</span>
        <span class="n">skw</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">K</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">opK2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">krt</span> <span class="o">=</span> <span class="mf">6.0</span> <span class="o">*</span> <span class="n">K2</span> <span class="o">*</span> <span class="n">K2</span> <span class="o">*</span> <span class="n">opK2</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">K</span><span class="p">,</span> <span class="n">opK2</span><span class="p">,</span> <span class="n">skw</span><span class="p">,</span> <span class="n">krt</span>


<span class="n">exponnorm</span> <span class="o">=</span> <span class="n">exponnorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;exponnorm&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_pow1pm1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute (1 + x)**y - 1.</span>

<span class="sd">    Uses expm1 and xlog1py to avoid loss of precision when</span>
<span class="sd">    (1 + x)**y is close to 1.</span>

<span class="sd">    Note that the inverse of this function with respect to x is</span>
<span class="sd">    ``_pow1pm1(x, 1/y)``.  That is, if</span>

<span class="sd">        t = _pow1pm1(x, y)</span>

<span class="sd">    then</span>

<span class="sd">        x = _pow1pm1(t, 1/y)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">exponweib_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponentiated Weibull continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    weibull_min, numpy.random.Generator.weibull</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `exponweib` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, c) = a c [1-\exp(-x^c)]^{a-1} \exp(-x^c) x^{c-1}</span>

<span class="sd">    and its cumulative distribution function is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        F(x, a, c) = [1-\exp(-x^c)]^a</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`a &gt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `exponweib` takes :math:`a` and :math:`c` as shape parameters:</span>

<span class="sd">    * :math:`a` is the exponentiation parameter,</span>
<span class="sd">      with the special case :math:`a=1` corresponding to the</span>
<span class="sd">      (non-exponentiated) Weibull distribution `weibull_min`.</span>
<span class="sd">    * :math:`c` is the shape parameter of the non-exponentiated Weibull law.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    https://en.wikipedia.org/wiki/Exponentiated_Weibull_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ic</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># exponweib.pdf(x, a, c) =</span>
        <span class="c1">#     a * c * (1-exp(-x**c))**(a-1) * exp(-x**c)*x**(c-1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">negxc</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="n">c</span>
        <span class="n">exm1c</span> <span class="o">=</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">negxc</span><span class="p">)</span>
        <span class="n">logp</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">exm1c</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">negxc</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">logp</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">exm1c</span> <span class="o">=</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">exm1c</span><span class="o">**</span><span class="n">a</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)))</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_pow1pm1</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">),</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">_pow1pm1</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="n">a</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>


<span class="n">exponweib</span> <span class="o">=</span> <span class="n">exponweib_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exponweib&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">exponpow_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponential power continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `exponpow` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = b x^{b-1} \exp(1 + x^b - \exp(x^b))</span>

<span class="sd">    for :math:`x \ge 0`, :math:`b &gt; 0`.  Note that this is a different</span>
<span class="sd">    distribution from the exponential power distribution that is also known</span>
<span class="sd">    under the names &quot;generalized normal&quot; or &quot;generalized Gaussian&quot;.</span>

<span class="sd">    `exponpow` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    http://www.math.wm.edu/~leemis/chart/UDR/PDFs/Exponentialpower.pdf</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># exponpow.pdf(x, b) = b * x**(b-1) * exp(1 + x**b - exp(x**b))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">xb</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="n">b</span>
        <span class="n">f</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">xb</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>


<span class="n">exponpow</span> <span class="o">=</span> <span class="n">exponpow_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exponpow&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">fatiguelife_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A fatigue-life (Birnbaum-Saunders) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `fatiguelife` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{x+1}{2c\sqrt{2\pi x^3}} \exp(-\frac{(x-1)^2}{2x c^2})</span>

<span class="sd">    for :math:`x &gt;= 0` and :math:`c &gt; 0`.</span>

<span class="sd">    `fatiguelife` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Birnbaum-Saunders distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Birnbaum-Saunders_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">z</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># fatiguelife.pdf(x, c) =</span>
        <span class="c1">#     (x+1) / (2*c*sqrt(2*pi*x**3)) * exp(-(x-1)**2/(2*x*c**2))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span>
                <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">tmp</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># NB: the formula for kurtosis in wikipedia seems to have an error:</span>
        <span class="c1"># it&#39;s 40, not 41. At least it disagrees with the one from Wolfram</span>
        <span class="c1"># Alpha.  And the latter one, below, passes the tests, while the wiki</span>
        <span class="c1"># one doesn&#39;t So far I didn&#39;t have the guts to actually check the</span>
        <span class="c1"># coefficients from the expressions for the raw moments.</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">1.0</span>
        <span class="n">den</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">+</span> <span class="mf">4.0</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">c2</span><span class="o">*</span><span class="n">den</span> <span class="o">/</span> <span class="mf">4.0</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mi">11</span><span class="o">*</span><span class="n">c2</span> <span class="o">+</span> <span class="mf">6.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">den</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">93</span><span class="o">*</span><span class="n">c2</span> <span class="o">+</span> <span class="mf">40.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">den</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">fatiguelife</span> <span class="o">=</span> <span class="n">fatiguelife_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fatiguelife&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">foldcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A folded Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `foldcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{1}{\pi (1+(x-c)^2)} + \frac{1}{\pi (1+(x+c)^2)}</span>

<span class="sd">    for :math:`x \ge 0` and :math:`c \ge 0`.</span>

<span class="sd">    `foldcauchy` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cauchy</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                              <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># foldcauchy.pdf(x, c) = 1/(pi*(1+(x-c)**2)) + 1/(pi*(1+(x+c)**2))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># 1 - CDF(x, c) = 1 - (atan(x - c) + atan(x + c))/pi</span>
        <span class="c1">#               = ((pi/2 - atan(x - c)) + (pi/2 - atan(x + c)))/pi</span>
        <span class="c1">#               = (acot(x - c) + acot(x + c))/pi</span>
        <span class="c1">#               = (atan2(1, x - c) + atan2(1, x + c))/pi</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="n">foldcauchy</span> <span class="o">=</span> <span class="n">foldcauchy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;foldcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">f_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An F continuous random variable.</span>

<span class="sd">    For the noncentral F distribution, see `ncf`.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    ncf</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The F distribution with :math:`df_1 &gt; 0` and :math:`df_2 &gt; 0` degrees of freedom is</span>
<span class="sd">    the distribution of the ratio of two independent chi-squared distributions with</span>
<span class="sd">    :math:`df_1` and :math:`df_2` degrees of freedom, after rescaling by</span>
<span class="sd">    :math:`df_2 / df_1`.</span>
<span class="sd">    </span>
<span class="sd">    The probability density function for `f` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, df_1, df_2) = \frac{df_2^{df_2/2} df_1^{df_1/2} x^{df_1 / 2-1}}</span>
<span class="sd">                                {(df_2+df_1 x)^{(df_1+df_2)/2}</span>
<span class="sd">                                 B(df_1/2, df_2/2)}</span>

<span class="sd">    for :math:`x &gt; 0`.</span>

<span class="sd">    `f` accepts shape parameters ``dfn`` and ``dfd`` for :math:`df_1`, the degrees of</span>
<span class="sd">    freedom of the chi-squared distribution in the numerator, and :math:`df_2`, the</span>
<span class="sd">    degrees of freedom of the chi-squared distribution in the denominator, respectively.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idfn</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;dfn&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">idfd</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;dfd&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idfn</span><span class="p">,</span> <span class="n">idfd</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">f</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="c1">#                      df2**(df2/2) * df1**(df1/2) * x**(df1/2-1)</span>
        <span class="c1"># F.pdf(x, df1, df2) = --------------------------------------------</span>
        <span class="c1">#                      (df2+df1*x)**((df1+df2)/2) * B(df1/2, df2/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">dfn</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">dfd</span>
        <span class="n">lPx</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">n</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
               <span class="o">-</span> <span class="p">(((</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">lPx</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">fdtr</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">fdtrc</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">fdtri</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">dfn</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">*</span> <span class="n">dfd</span>
        <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">,</span> <span class="n">v2_8</span> <span class="o">=</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">,</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">,</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">6.</span><span class="p">,</span> <span class="n">v2</span> <span class="o">-</span> <span class="mf">8.</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">:</span> <span class="n">v2</span> <span class="o">/</span> <span class="n">v2_2</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">mu2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">:</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="n">v2</span> <span class="o">*</span> <span class="n">v2</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2_2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">v1</span> <span class="o">*</span> <span class="n">v2_2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v2_4</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">g1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2_2</span><span class="p">,</span> <span class="n">v2_4</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">:</span>
            <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">v1</span> <span class="o">+</span> <span class="n">v2_2</span><span class="p">)</span> <span class="o">/</span> <span class="n">v2_6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v2_4</span> <span class="o">/</span> <span class="p">(</span><span class="n">v1</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span> <span class="o">+</span> <span class="n">v2_2</span><span class="p">))),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">8.</span><span class="p">)</span>

        <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">v2</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">,</span> <span class="n">v2_8</span><span class="p">),</span>
            <span class="k">lambda</span> <span class="n">g1</span><span class="p">,</span> <span class="n">v2_6</span><span class="p">,</span> <span class="n">v2_8</span><span class="p">:</span> <span class="p">(</span><span class="mi">8</span> <span class="o">+</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">g1</span> <span class="o">*</span> <span class="n">v2_6</span><span class="p">)</span> <span class="o">/</span> <span class="n">v2_8</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">*=</span> <span class="mf">3.</span> <span class="o">/</span> <span class="mf">2.</span>

        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">):</span>
        <span class="c1"># the formula found in literature is incorrect. This one yields the</span>
        <span class="c1"># same result as numerical integration using the generic entropy</span>
        <span class="c1"># definition. This is also tested in tests/test_conntinous_basic</span>
        <span class="n">half_dfn</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dfn</span>
        <span class="n">half_dfd</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dfd</span>
        <span class="n">half_sum</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">dfn</span> <span class="o">+</span> <span class="n">dfd</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dfd</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dfn</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">betaln</span><span class="p">(</span><span class="n">half_dfn</span><span class="p">,</span> <span class="n">half_dfd</span><span class="p">)</span> <span class="o">+</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">half_dfn</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">half_dfn</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">half_dfd</span><span class="p">)</span> <span class="o">*</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">half_dfd</span><span class="p">)</span> <span class="o">+</span> <span class="n">half_sum</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">half_sum</span><span class="p">))</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">f_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span>


<span class="c1">## Folded Normal</span>
<span class="c1">##   abs(Z) where (Z is normal with mu=L and std=S so that c=abs(L)/S)</span>
<span class="c1">##</span>
<span class="c1">##  note: regress docs have scale parameter correct, but first parameter</span>
<span class="c1">##    he gives is a shape parameter A = c * scale</span>

<span class="c1">##  Half-normal is folded normal with shape-parameter c=0.</span>

<span class="k">class</span> <span class="nc">foldnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A folded normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `foldnorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \sqrt{2/\pi} cosh(c x) \exp(-\frac{x^2+c^2}{2})</span>

<span class="sd">    for :math:`x \ge 0` and :math:`c \ge 0`.</span>

<span class="sd">    `foldnorm` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># foldnormal.pdf(x, c) = sqrt(2/pi) * cosh(c*x) * exp(-(x**2+c**2)/2)</span>
        <span class="k">return</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">sqrt_two</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">sqrt_two</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">sqrt_two</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># Regina C. Elandt, Technometrics 3, 551 (1961)</span>
        <span class="c1"># https://www.jstor.org/stable/1266561</span>
        <span class="c1">#</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">c</span>
        <span class="n">expfac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">c2</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">expfac</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="n">mu</span>

        <span class="n">g1</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> <span class="n">c2</span><span class="o">*</span><span class="n">mu</span> <span class="o">-</span> <span class="n">expfac</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>

        <span class="n">g2</span> <span class="o">=</span> <span class="n">c2</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span> <span class="o">+</span> <span class="mf">6.</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mf">8.</span><span class="o">*</span><span class="n">expfac</span><span class="o">*</span><span class="n">mu</span>
        <span class="n">g2</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mu</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">g2</span> <span class="o">/</span> <span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">-</span> <span class="mf">3.</span>

        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">foldnorm</span> <span class="o">=</span> <span class="n">foldnorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;foldnorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">weibull_min_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Weibull minimum continuous random variable.</span>

<span class="sd">    The Weibull Minimum Extreme Value distribution, from extreme value theory</span>
<span class="sd">    (Fisher-Gnedenko theorem), is also often simply called the Weibull</span>
<span class="sd">    distribution. It arises as the limiting distribution of the rescaled</span>
<span class="sd">    minimum of iid random variables.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    weibull_max, numpy.random.Generator.weibull, exponweib</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `weibull_min` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c x^{c-1} \exp(-x^c)</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `weibull_min` takes ``c`` as a shape parameter for :math:`c`.</span>
<span class="sd">    (named :math:`k` in Wikipedia article and :math:`a` in</span>
<span class="sd">    ``numpy.random.weibull``).  Special shape values are :math:`c=1` and</span>
<span class="sd">    :math:`c=2` where Weibull distribution reduces to the `expon` and</span>
<span class="sd">    `rayleigh` distributions respectively.</span>

<span class="sd">    Suppose ``X`` is an exponentially distributed random variable with</span>
<span class="sd">    scale ``s``. Then ``Y = X**k`` is `weibull_min` distributed with shape</span>
<span class="sd">    ``c = 1/k`` and scale ``s**k``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    https://en.wikipedia.org/wiki/Weibull_distribution</span>

<span class="sd">    https://en.wikipedia.org/wiki/Fisher-Tippett-Gnedenko_theorem</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># weibull_min.pdf(x, c) = c * x**(c-1) * exp(-x**c)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_EULER</span> <span class="o">/</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        If ``method=&#39;mm&#39;``, parameters fixed by the user are respected, and the</span>
<span class="s2">        remaining parameters are used to match distribution and sample moments</span>
<span class="s2">        where possible. For example, if the user fixes the location with</span>
<span class="s2">        ``floc``, the parameters will only match the distribution skewness and</span>
<span class="s2">        variance to the sample skewness and variance; no attempt will be made</span>
<span class="s2">        to match the means or minimize a norm of the errors.</span>
<span class="s2">        </span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">num_censored</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># this extracts fixed shape, location, and scale however they</span>
        <span class="c1"># are specified, and also leaves them in `kwds`</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">fc</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                             <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># See https://en.wikipedia.org/wiki/Weibull_distribution#Moments for</span>
        <span class="c1"># moment formulas.</span>
        <span class="k">def</span> <span class="nf">skew</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">gamma1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>
            <span class="n">gamma2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>
            <span class="n">gamma3</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">3</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>
            <span class="n">num</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">gamma1</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">gamma1</span><span class="o">*</span><span class="n">gamma2</span> <span class="o">+</span> <span class="n">gamma3</span>
            <span class="n">den</span> <span class="o">=</span> <span class="p">(</span><span class="n">gamma2</span> <span class="o">-</span> <span class="n">gamma1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">num</span><span class="o">/</span><span class="n">den</span>

        <span class="c1"># For c in [1e2, 3e4], population skewness appears to approach</span>
        <span class="c1"># asymptote near -1.139, but past c &gt; 3e4, skewness begins to vary</span>
        <span class="c1"># wildly, and MoM won&#39;t provide a good guess. Get out early.</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">max_c</span> <span class="o">=</span> <span class="mf">1e4</span>
        <span class="n">s_min</span> <span class="o">=</span> <span class="n">skew</span><span class="p">(</span><span class="n">max_c</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="n">s_min</span> <span class="ow">and</span> <span class="n">method</span> <span class="o">!=</span> <span class="s2">&quot;mm&quot;</span> <span class="ow">and</span> <span class="n">fc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># If method is method of moments, we don&#39;t need the user&#39;s guesses.</span>
        <span class="c1"># Otherwise, extract the guesses from args and kwds.</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># not fixed and no guess: use MoM</span>
            <span class="c1"># Solve for c that matches sample distribution skewness to sample</span>
            <span class="c1"># skewness.</span>
            <span class="c1"># we start having numerical issues with `weibull_min` with</span>
            <span class="c1"># parameters outside this range - and not just in this method.</span>
            <span class="c1"># We could probably improve the situation by doing everything</span>
            <span class="c1"># in the log space, but that is for another time.</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">skew</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">max_c</span><span class="p">],</span>
                            <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bisect&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">root</span>
        <span class="k">elif</span> <span class="n">fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># fixed: use it</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">fc</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span> <span class="o">/</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">scale</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># At this point, parameter &quot;guesses&quot; may equal the fixed parameters</span>
            <span class="c1"># in kwds. No harm in passing them as guesses, too.</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">weibull_min</span> <span class="o">=</span> <span class="n">weibull_min_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;weibull_min&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">truncweibull_min_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A doubly truncated Weibull minimum continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    weibull_min, truncexpon</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `truncweibull_min` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b, c) = \frac{c x^{c-1} \exp(-x^c)}{\exp(-a^c) - \exp(-b^c)}</span>

<span class="sd">    for :math:`a &lt; x &lt;= b`, :math:`0 \le a &lt; b` and :math:`c &gt; 0`.</span>

<span class="sd">    `truncweibull_min` takes :math:`a`, :math:`b`, and :math:`c` as shape</span>
<span class="sd">    parameters.</span>

<span class="sd">    Notice that the truncation values, :math:`a` and :math:`b`, are defined in</span>
<span class="sd">    standardized form:</span>

<span class="sd">    .. math::</span>

<span class="sd">        a = (u_l - loc)/scale</span>
<span class="sd">        b = (u_r - loc)/scale</span>

<span class="sd">    where :math:`u_l` and :math:`u_r` are the specific left and right</span>
<span class="sd">    truncation values, respectively. In other words, the support of the</span>
<span class="sd">    distribution becomes :math:`(a*scale + loc) &lt; x &lt;= (b*scale + loc)` when</span>
<span class="sd">    :math:`loc` and/or :math:`scale` are provided.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] Rinne, H. &quot;The Weibull Distribution: A Handbook&quot;. CRC Press (2009).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Arbitrary, but default a=b=c=1 is not valid</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">denum</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span> <span class="o">/</span> <span class="n">denum</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">logdenum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">logdenum</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="n">denum</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">num</span> <span class="o">/</span> <span class="n">denum</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">lognum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="n">logdenum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">lognum</span> <span class="o">-</span> <span class="n">logdenum</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="n">denum</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">num</span> <span class="o">/</span> <span class="n">denum</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">lognum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="n">logdenum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">lognum</span> <span class="o">-</span> <span class="n">logdenum</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span>
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))),</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span>
            <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">+</span> <span class="n">q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))),</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">gamma_fun</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">c</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">c</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span> <span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="n">c</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="n">denum</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">gamma_fun</span> <span class="o">/</span> <span class="n">denum</span>


<span class="n">truncweibull_min</span> <span class="o">=</span> <span class="n">truncweibull_min_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;truncweibull_min&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">weibull_max_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Weibull maximum continuous random variable.</span>

<span class="sd">    The Weibull Maximum Extreme Value distribution, from extreme value theory</span>
<span class="sd">    (Fisher-Gnedenko theorem), is the limiting distribution of rescaled</span>
<span class="sd">    maximum of iid random variables. This is the distribution of -X</span>
<span class="sd">    if X is from the `weibull_min` function.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    weibull_min</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `weibull_max` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c (-x)^{c-1} \exp(-(-x)^c)</span>

<span class="sd">    for :math:`x &lt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `weibull_max` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    https://en.wikipedia.org/wiki/Weibull_distribution</span>

<span class="sd">    https://en.wikipedia.org/wiki/Fisher-Tippett-Gnedenko_theorem</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># weibull_max.pdf(x, c) = c * (-x)**(c-1) * exp(-(-x)**c)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">sgn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sgn</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sgn</span> <span class="o">*</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_EULER</span> <span class="o">/</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mi">1</span>


<span class="n">weibull_max</span> <span class="o">=</span> <span class="n">weibull_max_gen</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;weibull_max&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genlogistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized logistic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genlogistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c \frac{\exp(-x)}</span>
<span class="sd">                         {(1 + \exp(-x))^{c+1}}</span>

<span class="sd">    for real :math:`x` and :math:`c &gt; 0`. In literature, different</span>
<span class="sd">    generalizations of the logistic distribution can be found. This is the type 1</span>
<span class="sd">    generalized logistic distribution according to [1]_. It is also referred to</span>
<span class="sd">    as the skew-logistic distribution [2]_.</span>

<span class="sd">    `genlogistic` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Johnson et al. &quot;Continuous Univariate Distributions&quot;, Volume 2,</span>
<span class="sd">           Wiley. 1995.</span>
<span class="sd">    .. [2] &quot;Generalized Logistic Distribution&quot;, Wikipedia,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Generalized_logistic_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genlogistic.pdf(x, c) = c * exp(-x) / (1 + exp(-x))**(c+1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># Two mathematically equivalent expressions for log(pdf(x, c)):</span>
        <span class="c1">#     log(pdf(x, c)) = log(c) - x - (c + 1)*log(1 + exp(-x))</span>
        <span class="c1">#                    = log(c) + c*x - (c + 1)*log(1 + exp(x))</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">absx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">mult</span><span class="o">*</span><span class="n">absx</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">absx</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">Cx</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Cx</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">powm1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">_ZETA3</span>
        <span class="n">g1</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mf">15.0</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">/=</span> <span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mf">8e6</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                          <span class="c1"># asymptotic expansion: psi(c) ~ log(c) - 1/(2 * c)</span>
                          <span class="c1"># a = -log(c) + psi(c + 1)</span>
                          <span class="c1">#   = -log(c) + psi(c) + 1/c</span>
                          <span class="c1">#   ~ -log(c) + log(c) - 1/(2 * c) + 1/c</span>
                          <span class="c1">#   = 1/(2 * c)</span>
                          <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="n">genlogistic</span> <span class="o">=</span> <span class="n">genlogistic_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;genlogistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genpareto_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized Pareto continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genpareto` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = (1 + c x)^{-1 - 1/c}</span>

<span class="sd">    defined for :math:`x \ge 0` if :math:`c \ge 0`, and for</span>
<span class="sd">    :math:`0 \le x \le -1/c` if :math:`c &lt; 0`.</span>

<span class="sd">    `genpareto` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    For :math:`c=0`, `genpareto` reduces to the exponential</span>
<span class="sd">    distribution, `expon`:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, 0) = \exp(-x)</span>

<span class="sd">    For :math:`c=-1`, `genpareto` is uniform on ``[0, 1]``:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, -1) = 1</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                       <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genpareto.pdf(x, c) = (1 + c * x)**(-1 - 1/c)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">inv_boxcox1p</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">inv_boxcox</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">boxcox1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;m&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">/</span>
                                       <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">xi</span><span class="p">)),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                           <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">xi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xi</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span>
                                       <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">cnk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">cnk</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="n">ki</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">ki</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,),</span>
                          <span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">__munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.</span> <span class="o">+</span> <span class="n">c</span>


<span class="n">genpareto</span> <span class="o">=</span> <span class="n">genpareto_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;genpareto&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genexpon_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized exponential continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genexpon` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b, c) = (a + b (1 - \exp(-c x)))</span>
<span class="sd">                        \exp(-a x - b x + \frac{b}{c}  (1-\exp(-c x)))</span>

<span class="sd">    for :math:`x \ge 0`, :math:`a, b, c &gt; 0`.</span>

<span class="sd">    `genexpon` takes :math:`a`, :math:`b` and :math:`c` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    H.K. Ryu, &quot;An Extension of Marshall and Olkin&#39;s Bivariate Exponential</span>
<span class="sd">    Distribution&quot;, Journal of the American Statistical Association, 1993.</span>

<span class="sd">    N. Balakrishnan, Asit P. Basu (editors), *The Exponential Distribution:</span>
<span class="sd">    Theory, Methods and Applications*, Gordon and Breach, 1995.</span>
<span class="sd">    ISBN 10: 2884491929</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ic</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genexpon.pdf(x, a, b, c) = (a + b * (1 - exp(-c*x))) * \</span>
        <span class="c1">#                            exp(-a*x - b*x + b/c * (1-exp(-c*x)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span>
                                                <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)))</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">s</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">lambertw</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="n">s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">/</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="o">/</span><span class="n">s</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">lambertw</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="n">s</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">/</span><span class="n">c</span>


<span class="n">genexpon</span> <span class="o">=</span> <span class="n">genexpon_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;genexpon&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genextreme_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized extreme value continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gumbel_r</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    For :math:`c=0`, `genextreme` is equal to `gumbel_r` with</span>
<span class="sd">    probability density function</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(-\exp(-x)) \exp(-x),</span>

<span class="sd">    where :math:`-\infty &lt; x &lt; \infty`.</span>

<span class="sd">    For :math:`c \ne 0`, the probability density function for `genextreme` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \exp(-(1-c x)^{1/c}) (1-c x)^{1/c-1},</span>

<span class="sd">    where :math:`-\infty &lt; x \le 1/c` if :math:`c &gt; 0` and</span>
<span class="sd">    :math:`1/c \le x &lt; \infty` if :math:`c &lt; 0`.</span>

<span class="sd">    Note that several sources and software packages use the opposite</span>
<span class="sd">    convention for the sign of the shape parameter :math:`c`.</span>

<span class="sd">    `genextreme` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_XMIN</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">_XMIN</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span>

    <span class="k">def</span> <span class="nf">_loglogcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># Returns log(-log(cdf(x, c)))</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genextreme.pdf(x, c) =</span>
        <span class="c1">#     exp(-exp(-x))*exp(-x),                    for c==0</span>
        <span class="c1">#     exp(-(1-c*x)**(1/c))*(1-c*x)**(1/c-1),    for x \le 1/c, c &gt; 0</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">cx</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">logex2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">cx</span><span class="p">)</span>
        <span class="n">logpex2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loglogcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">pex2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logpex2</span><span class="p">)</span>
        <span class="c1"># Handle special cases</span>
        <span class="n">np</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">logpex2</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">logpdf</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="o">~</span><span class="p">((</span><span class="n">cx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cx</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)),</span>
                            <span class="p">(</span><span class="n">pex2</span><span class="p">,</span> <span class="n">logpex2</span><span class="p">,</span> <span class="n">logex2</span><span class="p">),</span>
                            <span class="k">lambda</span> <span class="n">pex2</span><span class="p">,</span> <span class="n">lpex2</span><span class="p">,</span> <span class="n">lex2</span><span class="p">:</span> <span class="o">-</span><span class="n">pex2</span> <span class="o">+</span> <span class="n">lpex2</span> <span class="o">-</span> <span class="n">lex2</span><span class="p">,</span>
                            <span class="n">fillvalue</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">putmask</span><span class="p">(</span><span class="n">logpdf</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">logpdf</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loglogcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">g3</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">g4</span> <span class="o">=</span> <span class="n">g</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">g2mg12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span> <span class="n">g2</span><span class="o">-</span><span class="n">g1</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">gam2k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mf">2.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span>
                         <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-14</span>
        <span class="n">gamk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">eps</span><span class="p">,</span> <span class="o">-</span><span class="n">_EULER</span><span class="p">,</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="o">-</span><span class="n">gamk</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">g1</span><span class="o">**</span><span class="mf">2.0</span><span class="o">*</span><span class="n">gam2k</span><span class="p">)</span>

        <span class="c1"># skewness</span>
        <span class="n">sk1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g2mg12</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">c</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g2mg12</span><span class="p">:</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">g3</span> <span class="o">+</span> <span class="p">(</span><span class="n">g2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">g2mg12</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span><span class="p">)</span><span class="o">/</span><span class="n">g2mg12</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                         <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">sk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">eps</span><span class="o">**</span><span class="mf">0.29</span><span class="p">,</span> <span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">*</span><span class="n">_ZETA3</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span> <span class="n">sk1</span><span class="p">)</span>

        <span class="c1"># kurtosis</span>
        <span class="n">ku1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">,</span> <span class="n">g2mg12</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g3</span><span class="p">,</span> <span class="n">g4</span><span class="p">,</span> <span class="n">g2mg12</span><span class="p">:</span>
                             <span class="p">(</span><span class="n">g4</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">g3</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">g2</span> <span class="o">+</span> <span class="n">g2mg12</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span><span class="p">)</span><span class="o">*</span><span class="n">g1</span><span class="p">)</span><span class="o">/</span><span class="n">g2mg12</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">fillvalue</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="n">ku</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">eps</span><span class="p">)</span><span class="o">**</span><span class="mf">0.23</span><span class="p">,</span> <span class="mf">12.0</span><span class="o">/</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">ku1</span><span class="o">-</span><span class="mf">3.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sk</span><span class="p">,</span> <span class="n">ku</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="c1"># This is better than the default shape of (1,).</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">g</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="n">sc</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">n</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>


<span class="n">genextreme</span> <span class="o">=</span> <span class="n">genextreme_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;genextreme&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_digammainv</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inverse of the digamma function (real positive arguments only).</span>

<span class="sd">    This function is used in the `fit` method of `gamma_gen`.</span>
<span class="sd">    The function uses either optimize.fsolve or optimize.newton</span>
<span class="sd">    to solve `sc.digamma(x) - y = 0`.  There is probably room for</span>
<span class="sd">    improvement, but currently it works over a wide range of y:</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; rng = np.random.default_rng()</span>
<span class="sd">    &gt;&gt;&gt; y = 64*rng.standard_normal(1000000)</span>
<span class="sd">    &gt;&gt;&gt; y.min(), y.max()</span>
<span class="sd">    (-311.43592651416662, 351.77388222276869)</span>
<span class="sd">    &gt;&gt;&gt; x = [_digammainv(t) for t in y]</span>
<span class="sd">    &gt;&gt;&gt; np.abs(sc.digamma(x) - y).max()</span>
<span class="sd">    1.1368683772161603e-13</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_em</span> <span class="o">=</span> <span class="mf">0.5772156649015328606065120</span>

    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.125</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c1"># Some experimentation shows that newton reliably converges</span>
            <span class="c1"># must faster than fsolve in this y range.  For larger y,</span>
            <span class="c1"># newton sometimes fails to converge.</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
    <span class="k">elif</span> <span class="n">y</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="mf">2.332</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.08661</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">y</span> <span class="o">-</span> <span class="n">_em</span><span class="p">)</span>

    <span class="n">value</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">mesg</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span>
                                             <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;_digammainv: fsolve failed, y = </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<span class="c1">## Gamma (Use MATLAB and MATHEMATICA (b=theta=scale, a=alpha=shape) definition)</span>

<span class="c1">## gamma(a, loc, scale)  with a an integer is the Erlang distribution</span>
<span class="c1">## gamma(1, loc, scale)  is the Exponential distribution</span>
<span class="c1">## gamma(df/2, 0, 2) is the chi2 distribution with df degrees of freedom.</span>

<span class="k">class</span> <span class="nc">gamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    erlang, expon</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{x^{a-1} e^{-x}}{\Gamma(a)}</span>

<span class="sd">    for :math:`x \ge 0`, :math:`a &gt; 0`. Here :math:`\Gamma(a)` refers to the</span>
<span class="sd">    gamma function.</span>

<span class="sd">    `gamma` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    When :math:`a` is an integer, `gamma` reduces to the Erlang</span>
<span class="sd">    distribution, and when :math:`a=1` to the exponential distribution.</span>

<span class="sd">    Gamma distributions are sometimes parameterized with two variables,</span>
<span class="sd">    with a probability density function of:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \alpha, \beta) =</span>
<span class="sd">        \frac{\beta^\alpha x^{\alpha - 1} e^{-\beta x }}{\Gamma(\alpha)}</span>

<span class="sd">    Note that this parameterization is equivalent to the above, with</span>
<span class="sd">    ``scale = 1 / beta``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># gamma.pdf(x, a) = x**(a-1) * exp(-x) / gamma(a)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="mf">6.0</span><span class="o">/</span><span class="n">a</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">regular_formula</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">asymptotic_formula</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="c1"># plug in above formula the expansions:</span>
            <span class="c1"># psi(a) ~ ln(a) - 1/2a - 1/12a^2 + 1/120a^4</span>
            <span class="c1"># gammaln(a) ~ a * ln(a) - a - 1/2 * ln(a) + 1/2 ln(2 * pi) +</span>
            <span class="c1">#              1/12a - 1/360a^3</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">3.</span><span class="p">)</span><span class="o">/</span><span class="mi">90</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">4.</span><span class="p">)</span><span class="o">/</span><span class="mi">120</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mi">250</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">),</span> <span class="n">regular_formula</span><span class="p">,</span>
                          <span class="n">f2</span><span class="o">=</span><span class="n">asymptotic_formula</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># The skewness of the gamma distribution is `2 / np.sqrt(a)`.</span>
        <span class="c1"># We invert that to estimate the shape `a` using the skewness</span>
        <span class="c1"># of the data.  The formula is regularized with 1e-8 in the</span>
        <span class="c1"># denominator to allow for degenerate data where the skewness</span>
        <span class="c1"># is close to 0.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="n">sk</span> <span class="o">=</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e-8</span> <span class="o">+</span> <span class="n">sk</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,))</span>

    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        When the location is fixed by using the argument `floc`</span>
<span class="s2">        and `method=&#39;MLE&#39;`, this</span>
<span class="s2">        function uses explicit formulas or solves a simpler numerical</span>
<span class="s2">        problem than the full ML optimization problem.  So in that case,</span>
<span class="s2">        the `optimizer`, `loc` and `scale` arguments are ignored.</span>
<span class="s2">        </span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">)</span> <span class="ow">or</span>
                <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;mm&#39;</span><span class="p">):</span>
            <span class="c1"># loc is not fixed or we&#39;re not doing standard MLE.</span>
            <span class="c1"># Use the default fit method.</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># We already have this value, so just pop it from kwds.</span>
        <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">f0</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="s1">&#39;fa&#39;</span><span class="p">,</span> <span class="s1">&#39;fix_a&#39;</span><span class="p">])</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="c1"># Without this check, this function would just return the</span>
            <span class="c1"># parameters that were given.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="c1"># Fixed location is handled by shifting the data.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="c1"># Use explicit formulas for mm (gh-19884)</span>
        <span class="k">if</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">m3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">f0</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>
            <span class="c1"># Three unknowns</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">loc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">m3</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">m2</span><span class="p">)</span>
            <span class="c1"># Two unknowns</span>
            <span class="k">if</span> <span class="n">loc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">m2</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">/</span> <span class="p">(</span><span class="n">m1</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="c1"># One unknown</span>
            <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
            <span class="k">if</span> <span class="n">loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">-</span> <span class="n">a</span> <span class="o">*</span> <span class="n">scale</span>
            <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

        <span class="c1"># Special case: loc is fixed.</span>

        <span class="c1"># NB: data == loc is ok if a &gt;= 1; the below check is more strict.</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">floc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;gamma&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Don&#39;t do the subtraction in-place, because `data` might be a</span>
            <span class="c1"># view of the input array.</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">floc</span>
        <span class="n">xbar</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

        <span class="c1"># Three cases to handle:</span>
        <span class="c1"># * shape and scale both free</span>
        <span class="c1"># * shape fixed, scale free</span>
        <span class="c1"># * shape free, scale fixed</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale is free</span>
            <span class="k">if</span> <span class="n">f0</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># shape is fixed</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">f0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># shape and scale are both free.</span>
                <span class="c1"># The MLE for the shape parameter `a` is the solution to:</span>
                <span class="c1"># np.log(a) - sc.digamma(a) - np.log(xbar) +</span>
                <span class="c1">#                             np.log(data).mean() = 0</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">xbar</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">aest</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="n">s</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">s</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="n">s</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
                <span class="n">xa</span> <span class="o">=</span> <span class="n">aest</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">xb</span> <span class="o">=</span> <span class="n">aest</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">0.4</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span>
                                    <span class="n">xa</span><span class="p">,</span> <span class="n">xb</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># The MLE for the scale parameter is just the data mean</span>
            <span class="c1"># divided by the shape parameter.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">xbar</span> <span class="o">/</span> <span class="n">a</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># scale is fixed, shape is free</span>
            <span class="c1"># The MLE for the shape parameter `a` is the solution to:</span>
            <span class="c1"># sc.digamma(a) - np.log(data).mean() + np.log(fscale) = 0</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fscale</span><span class="p">)</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">_digammainv</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">erlang_gen</span><span class="p">(</span><span class="n">gamma_gen</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An Erlang continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gamma</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The Erlang distribution is a special case of the Gamma distribution, with</span>
<span class="sd">    the shape parameter `a` an integer.  Note that this restriction is not</span>
<span class="sd">    enforced by `erlang`. It will, however, generate a warning the first time</span>
<span class="sd">    a non-integer value is used for the shape parameter.</span>

<span class="sd">    Refer to `gamma` for examples.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">allint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">allint</span><span class="p">:</span>
            <span class="c1"># An Erlang distribution shouldn&#39;t really have a non-integer</span>
            <span class="c1"># shape parameter, so warn the user.</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;The shape parameter of the erlang distribution &#39;</span>
                       <span class="sa">f</span><span class="s1">&#39;has been given a non-integer value </span><span class="si">{</span><span class="n">a</span><span class="si">!r}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Override gamma_gen_fitstart so that an integer initial value is</span>
        <span class="c1"># used.  (Also regularize the division, to avoid issues when</span>
        <span class="c1"># _skew(data) is 0 or close to 0.)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1e-8</span> <span class="o">+</span> <span class="n">_skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">gamma_gen</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,))</span>

    <span class="c1"># Trivial override of the fit method, so we can monkey-patch its</span>
    <span class="c1"># docstring.</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        The Erlang distribution is generally defined to have integer values</span>
<span class="s2">        for the shape parameter.  This is not enforced by the `erlang` class.</span>
<span class="s2">        When fitting the distribution, it will generally return a non-integer</span>
<span class="s2">        value for the shape parameter.  By using the keyword argument</span>
<span class="s2">        `f0=&lt;integer&gt;`, the fit method can be constrained to fit the data to</span>
<span class="s2">        a specific integer shape parameter.&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">erlang</span> <span class="o">=</span> <span class="n">erlang_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;erlang&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gengamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gamma, invgamma, weibull_min</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gengamma` is ([1]_):</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, c) = \frac{|c| x^{c a-1} \exp(-x^c)}{\Gamma(a)}</span>

<span class="sd">    for :math:`x \ge 0`, :math:`a &gt; 0`, and :math:`c \ne 0`.</span>
<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `gengamma` takes :math:`a` and :math:`c` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] E.W. Stacy, &quot;A Generalization of the Gamma Distribution&quot;,</span>
<span class="sd">       Annals of Mathematical Statistics, Vol 33(3), pp. 1187--1192.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ic</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                                        <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span>
                          <span class="n">fillvalue</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">xc</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="n">c</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val1</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">val2</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val1</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># Pochhammer symbol: sc.pocha,n) = gamma(a+n)/gamma(a)</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">poch</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">n</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">regular</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="n">val</span> <span class="o">/</span> <span class="n">c</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span>
            <span class="k">return</span> <span class="n">h</span>

        <span class="k">def</span> <span class="nf">asymptotic</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="c1"># using asymptotic expansions for gammaln and psi (see gh-18093)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">_entropy</span><span class="p">()</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">3.</span><span class="p">)</span><span class="o">/</span><span class="mi">90</span>
                    <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="mi">12</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">**-</span><span class="mf">4.</span><span class="p">)</span><span class="o">/</span><span class="mi">120</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">2e2</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">asymptotic</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">regular</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span>


<span class="n">gengamma</span> <span class="o">=</span> <span class="n">gengamma_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gengamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genhalflogistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized half-logistic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genhalflogistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{2 (1 - c x)^{1/(c-1)}}{[1 + (1 - c x)^{1/c}]^2}</span>

<span class="sd">    for :math:`0 \le x \le 1/c`, and :math:`c &gt; 0`.</span>

<span class="sd">    `genhalflogistic` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># genhalflogistic.pdf(x, c) =</span>
        <span class="c1">#    2 * (1-c*x)**(1/c-1) / (1+(1-c*x)**(1/c))**2</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="n">tmp0</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">**</span><span class="p">(</span><span class="n">limit</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp0</span><span class="o">*</span><span class="n">tmp</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">tmp0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tmp2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">limit</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span>
        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="n">tmp2</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">**</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">tmp2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">tmp2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">genhalflogistic</span> <span class="o">=</span> <span class="n">genhalflogistic_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;genhalflogistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">genhyperbolic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized hyperbolic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    t, norminvgauss, geninvgauss, laplace, cauchy</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `genhyperbolic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, p, a, b) =</span>
<span class="sd">            \frac{(a^2 - b^2)^{p/2}}</span>
<span class="sd">            {\sqrt{2\pi}a^{p-1/2}</span>
<span class="sd">            K_p\Big(\sqrt{a^2 - b^2}\Big)}</span>
<span class="sd">            e^{bx} \times \frac{K_{p - 1/2}</span>
<span class="sd">            (a \sqrt{1 + x^2})}</span>
<span class="sd">            {(\sqrt{1 + x^2})^{1/2 - p}}</span>

<span class="sd">    for :math:`x, p \in ( - \infty; \infty)`,</span>
<span class="sd">    :math:`|b| &lt; a` if :math:`p \ge 0`,</span>
<span class="sd">    :math:`|b| \le a` if :math:`p &lt; 0`.</span>
<span class="sd">    :math:`K_{p}(.)` denotes the modified Bessel function of the second</span>
<span class="sd">    kind and order :math:`p` (`scipy.special.kv`)</span>

<span class="sd">    `genhyperbolic` takes ``p`` as a tail parameter,</span>
<span class="sd">    ``a`` as a shape parameter,</span>
<span class="sd">    ``b`` as a skewness parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The original parameterization of the Generalized Hyperbolic Distribution</span>
<span class="sd">    is found in [1]_ as follows</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \lambda, \alpha, \beta, \delta, \mu) =</span>
<span class="sd">           \frac{(\gamma/\delta)^\lambda}{\sqrt{2\pi}K_\lambda(\delta \gamma)}</span>
<span class="sd">           e^{\beta (x - \mu)} \times \frac{K_{\lambda - 1/2}</span>
<span class="sd">           (\alpha \sqrt{\delta^2 + (x - \mu)^2})}</span>
<span class="sd">           {(\sqrt{\delta^2 + (x - \mu)^2} / \alpha)^{1/2 - \lambda}}</span>

<span class="sd">    for :math:`x \in ( - \infty; \infty)`,</span>
<span class="sd">    :math:`\gamma := \sqrt{\alpha^2 - \beta^2}`,</span>
<span class="sd">    :math:`\lambda, \mu \in ( - \infty; \infty)`,</span>
<span class="sd">    :math:`\delta \ge 0, |\beta| &lt; \alpha` if :math:`\lambda \ge 0`,</span>
<span class="sd">    :math:`\delta &gt; 0, |\beta| \le \alpha` if :math:`\lambda &lt; 0`.</span>

<span class="sd">    The location-scale-based parameterization implemented in</span>
<span class="sd">    SciPy is based on [2]_, where :math:`a = \alpha\delta`,</span>
<span class="sd">    :math:`b = \beta\delta`, :math:`p = \lambda`,</span>
<span class="sd">    :math:`scale=\delta` and :math:`loc=\mu`</span>

<span class="sd">    Moments are implemented based on [3]_ and [4]_.</span>

<span class="sd">    For the distributions that are a special case such as Student&#39;s t,</span>
<span class="sd">    it is not recommended to rely on the implementation of genhyperbolic.</span>
<span class="sd">    To avoid potential numerical problems and for performance reasons,</span>
<span class="sd">    the methods of the specific distributions should be used.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] O. Barndorff-Nielsen, &quot;Hyperbolic Distributions and Distributions</span>
<span class="sd">       on Hyperbolae&quot;, Scandinavian Journal of Statistics, Vol. 5(3),</span>
<span class="sd">       pp. 151-157, 1978. https://www.jstor.org/stable/4615705</span>

<span class="sd">    .. [2] Eberlein E., Prause K. (2002) The Generalized Hyperbolic Model:</span>
<span class="sd">        Financial Derivatives and Risk Measures. In: Geman H., Madan D.,</span>
<span class="sd">        Pliska S.R., Vorst T. (eds) Mathematical Finance - Bachelier</span>
<span class="sd">        Congress 2000. Springer Finance. Springer, Berlin, Heidelberg.</span>
<span class="sd">        :doi:`10.1007/978-3-662-12429-1_12`</span>

<span class="sd">    .. [3] Scott, David J, Würtz, Diethelm, Dong, Christine and Tran,</span>
<span class="sd">       Thanh Tam, (2009), Moments of the generalized hyperbolic</span>
<span class="sd">       distribution, MPRA Paper, University Library of Munich, Germany,</span>
<span class="sd">       https://EconPapers.repec.org/RePEc:pra:mprapa:19081.</span>

<span class="sd">    .. [4] E. Eberlein and E. A. von Hammerstein. Generalized hyperbolic</span>
<span class="sd">       and inverse Gaussian distributions: Limiting cases and approximation</span>
<span class="sd">       of processes. FDM Preprint 80, April 2003. University of Freiburg.</span>
<span class="sd">       https://freidok.uni-freiburg.de/fedora/objects/freidok:7974/datastreams/FILE1/content</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Arbitrary, but the default p = a = b = 1 is not valid; the</span>
        <span class="c1"># distribution requires |b| &lt; a if p &gt;= 0.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># kve instead of kv works better for large values of p</span>
        <span class="c1"># and smaller values of sqrt(a^2  - b^2)</span>
        <span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
        <span class="k">def</span> <span class="nf">_logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">genhyperbolic_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># kve instead of kv works better for large values of p</span>
        <span class="c1"># and smaller values of sqrt(a^2  - b^2)</span>
        <span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
        <span class="k">def</span> <span class="nf">_pdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">genhyperbolic_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_pdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1"># np.vectorize isn&#39;t currently designed to be used as a decorator,</span>
    <span class="c1"># so use a lambda instead.  This allows us to decorate the function</span>
    <span class="c1"># with `np.vectorize` and still provide the `otypes` parameter.</span>
    <span class="c1"># The first argument to `vectorize` is `func.__get__(object)` for</span>
    <span class="c1"># compatibility with Python 3.9.  In Python 3.10, this can be</span>
    <span class="c1"># simplified to just `func`.</span>
    <span class="nd">@lambda</span> <span class="n">func</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="fm">__get__</span><span class="p">(</span><span class="nb">object</span><span class="p">),</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_integrate_pdf</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrate the pdf of the genhyberbolic distribution from x0 to x1.</span>
<span class="sd">        This is a private function used by _cdf() and _sf() only; either x0</span>
<span class="sd">        will be -inf or x1 will be inf.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
        <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="s1">&#39;_genhyperbolic_pdf&#39;</span><span class="p">,</span>
                                           <span class="n">user_data</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">))</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">d</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">epsrel</span> <span class="o">=</span> <span class="mf">1e-10</span>
        <span class="n">epsabs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="o">&lt;</span> <span class="n">mean</span> <span class="o">&lt;</span> <span class="n">x1</span><span class="p">:</span>
            <span class="c1"># If the interval includes the mean, integrate over the two</span>
            <span class="c1"># intervals [x0, mean] and [mean, x1] and add. If we try to do</span>
            <span class="c1"># the integral in one call of quad and the non-infinite endpoint</span>
            <span class="c1"># is far in the tail, quad might return an incorrect result</span>
            <span class="c1"># because it does not &quot;see&quot; the peak of the PDF.</span>
            <span class="n">intgrl</span> <span class="o">=</span> <span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span>
                                     <span class="n">epsrel</span><span class="o">=</span><span class="n">epsrel</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">epsabs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                      <span class="o">+</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span>
                                       <span class="n">epsrel</span><span class="o">=</span><span class="n">epsrel</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">epsabs</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">intgrl</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span>
                                    <span class="n">epsrel</span><span class="o">=</span><span class="n">epsrel</span><span class="p">,</span> <span class="n">epsabs</span><span class="o">=</span><span class="n">epsabs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">intgrl</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Infinite values encountered in scipy.special.kve. &quot;</span>
                   <span class="s2">&quot;Values replaced by NaN to avoid incorrect results.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">intgrl</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_pdf</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_integrate_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># note: X = b * V + sqrt(V) * X  has a</span>
        <span class="c1"># generalized hyperbolic distribution</span>
        <span class="c1"># if X is standard normal and V is</span>
        <span class="c1"># geninvgauss(p = p, b = t2, loc = loc, scale = t3)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="c1"># b in the GIG</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="c1"># scale in the GIG</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">gig</span> <span class="o">=</span> <span class="n">geninvgauss</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="n">t2</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">t3</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
            <span class="p">)</span>
        <span class="n">normst</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="n">gig</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gig</span><span class="p">)</span> <span class="o">*</span> <span class="n">normst</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># https://mpra.ub.uni-muenchen.de/19081/1/MPRA_paper_19081.pdf</span>
        <span class="c1"># https://freidok.uni-freiburg.de/fedora/objects/freidok:7974/datastreams/FILE1/content</span>
        <span class="c1"># standardized moments</span>
        <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">integers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1"># make integers perpendicular to existing dimensions</span>
        <span class="n">integers</span> <span class="o">=</span> <span class="n">integers</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">integers</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
        <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">kv</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">integers</span><span class="p">,</span> <span class="n">t1</span><span class="p">)</span>
        <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">r3</span><span class="p">,</span> <span class="n">r4</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">/</span> <span class="n">b0</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">))</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">t2</span> <span class="o">*</span> <span class="n">r1</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">t2</span> <span class="o">*</span> <span class="n">r1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">m3e</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r3</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span>
            <span class="mi">3</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r2</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">m3e</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">m4e</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="n">r4</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b3</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="mi">6</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span>
             <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span> <span class="o">+</span>
            <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span>
            <span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">r3</span> <span class="o">-</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="o">+</span>
            <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">r2</span>
        <span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">m4e</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span>

        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span>


<span class="n">genhyperbolic</span> <span class="o">=</span> <span class="n">genhyperbolic_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;genhyperbolic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gompertz_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gompertz (or truncated Gumbel) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gompertz` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c \exp(x) \exp(-c (e^x-1))</span>

<span class="sd">    for :math:`x \ge 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `gompertz` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># gompertz.pdf(x, c) = c * exp(x) * exp(-c*(exp(x)-1))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">_ufuncs</span><span class="o">.</span><span class="n">_scaled_exp1</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="n">c</span>


<span class="n">gompertz</span> <span class="o">=</span> <span class="n">gompertz_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gompertz&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_average_with_log_weights</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">logweights</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">logweights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">logweights</span><span class="p">)</span>
    <span class="n">maxlogw</span> <span class="o">=</span> <span class="n">logweights</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logweights</span> <span class="o">-</span> <span class="n">maxlogw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gumbel_r_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A right-skewed Gumbel continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gumbel_l, gompertz, genextreme</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gumbel_r` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(-(x + e^{-x}))</span>

<span class="sd">    The Gumbel distribution is sometimes referred to as a type I Fisher-Tippett</span>
<span class="sd">    distribution.  It is also related to the extreme value distribution,</span>
<span class="sd">    log-Weibull and Gompertz distributions.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># gumbel_r.pdf(x) = exp(-(x + exp(-x)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span> <span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">_ZETA3</span><span class="p">,</span> <span class="mf">12.0</span><span class="o">/</span><span class="mi">5</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># https://en.wikipedia.org/wiki/Gumbel_distribution</span>
        <span class="k">return</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mf">1.</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># By the method of maximum likelihood, the estimators of the</span>
        <span class="c1"># location and scale are the roots of the equations defined in</span>
        <span class="c1"># `func` and the value of the expression for `loc` that follows.</span>
        <span class="c1"># The first `func` is a first order derivative of the log-likelihood</span>
        <span class="c1"># equation and the second is from Source: Statistical Distributions,</span>
        <span class="c1"># 3rd Edition. Evans, Hastings, and Peacock (2000), Page 101.</span>

        <span class="k">def</span> <span class="nf">get_loc_from_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">scale</span> <span class="o">*</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">logsumexp</span><span class="p">(</span><span class="o">-</span><span class="n">data</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if the scale is fixed, the location can be analytically</span>
            <span class="c1"># determined.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">get_loc_from_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># A different function is solved depending on whether the location</span>
            <span class="c1"># is fixed.</span>
            <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>

                <span class="c1"># equation to use if the location is fixed.</span>
                <span class="c1"># note that one cannot use the equation in Evans, Hastings,</span>
                <span class="c1"># and Peacock (2000) (since it assumes that the derivative</span>
                <span class="c1"># w.r.t. the log-likelihood is zero). however, it is easy to</span>
                <span class="c1"># derive the MLE condition directly if loc is fixed</span>
                <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
                    <span class="n">term1</span> <span class="o">=</span> <span class="p">(</span><span class="n">loc</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">loc</span> <span class="o">-</span> <span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span>
                    <span class="n">term2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">loc</span> <span class="o">+</span> <span class="n">scale</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">term1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">term2</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="c1"># equation to use if both location and scale are free</span>
                <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
                    <span class="n">sdata</span> <span class="o">=</span> <span class="o">-</span><span class="n">data</span> <span class="o">/</span> <span class="n">scale</span>
                    <span class="n">wavg</span> <span class="o">=</span> <span class="n">_average_with_log_weights</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">logweights</span><span class="o">=</span><span class="n">sdata</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">wavg</span> <span class="o">-</span> <span class="n">scale</span>

            <span class="c1"># set brackets for `root_scalar` to use when optimizing over the</span>
            <span class="c1"># scale such that a root is likely between them. Use user supplied</span>
            <span class="c1"># guess or default 1.</span>
            <span class="n">brack_start</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span> <span class="o">=</span> <span class="n">brack_start</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">brack_start</span> <span class="o">*</span> <span class="mi">2</span>

            <span class="c1"># if a root is not between the brackets, iteratively expand them</span>
            <span class="c1"># until they include a sign change, checking after each bracket is</span>
            <span class="c1"># modified.</span>
            <span class="k">def</span> <span class="nf">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">):</span>
                <span class="c1"># return true if the signs disagree.</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">lbrack</span><span class="p">))</span> <span class="o">!=</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)))</span>
            <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">)</span>
                   <span class="ow">and</span> <span class="p">(</span><span class="n">lbrack</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">rbrack</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)):</span>
                <span class="n">lbrack</span> <span class="o">/=</span> <span class="mi">2</span>
                <span class="n">rbrack</span> <span class="o">*=</span> <span class="mi">2</span>

            <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">),</span>
                                       <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-14</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span> <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">get_loc_from_scale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">gumbel_r</span> <span class="o">=</span> <span class="n">gumbel_r_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;gumbel_r&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gumbel_l_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A left-skewed Gumbel continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gumbel_r, gompertz, genextreme</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gumbel_l` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(x - e^x)</span>

<span class="sd">    The Gumbel distribution is sometimes referred to as a type I Fisher-Tippett</span>
<span class="sd">    distribution.  It is also related to the extreme value distribution,</span>
<span class="sd">    log-Weibull and Gompertz distributions.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># gumbel_l.pdf(x) = exp(x - exp(x))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_EULER</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span><span class="p">,</span> \
               <span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="n">_ZETA3</span><span class="p">,</span> <span class="mf">12.0</span><span class="o">/</span><span class="mi">5</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mf">1.</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1"># The fit method of `gumbel_r` can be used for this distribution with</span>
        <span class="c1"># small modifications. The process to do this is</span>
        <span class="c1"># 1. pass the sign negated data into `gumbel_r.fit`</span>
        <span class="c1">#    - if the location is fixed, it should also be negated.</span>
        <span class="c1"># 2. negate the sign of the resulting location, leaving the scale</span>
        <span class="c1">#    unmodified.</span>
        <span class="c1"># `gumbel_r.fit` holds necessary input checks.</span>

        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;floc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kwds</span><span class="p">[</span><span class="s1">&#39;floc&#39;</span><span class="p">]</span>
        <span class="n">loc_r</span><span class="p">,</span> <span class="n">scale_r</span><span class="p">,</span> <span class="o">=</span> <span class="n">gumbel_r</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">loc_r</span><span class="p">,</span> <span class="n">scale_r</span>


<span class="n">gumbel_l</span> <span class="o">=</span> <span class="n">gumbel_l_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;gumbel_l&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halfcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Half-Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halfcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{2}{\pi (1 + x^2)}</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># halfcauchy.pdf(x) = 2 / (pi * (1 + x**2))</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># location is independent from the scale</span>
        <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="n">floc</span><span class="p">:</span>
                <span class="c1"># There are values that are less than the specified loc.</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;halfcauchy&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if not provided, location MLE is the minimal data point</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data_min</span>

        <span class="c1"># find scale</span>
        <span class="k">def</span> <span class="nf">find_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
            <span class="n">shifted_data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">loc</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span>
            <span class="n">shifted_data_squared</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">shifted_data</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">fun_to_solve</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
                <span class="n">denominator</span> <span class="o">=</span> <span class="n">scale</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">shifted_data_squared</span>
                <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">shifted_data_squared</span><span class="o">/</span><span class="n">denominator</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span>

            <span class="n">small</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="o">**</span><span class="mf">0.5</span>  <span class="c1"># avoid underflow</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">fun_to_solve</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">shifted_data</span><span class="p">)))</span>
            <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">find_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">halfcauchy</span> <span class="o">=</span> <span class="n">halfcauchy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halfcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halflogistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A half-logistic continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halflogistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{ 2 e^{-x} }{ (1+e^{-x})^2 }</span>
<span class="sd">             = \frac{1}{2} \text{sech}(x/2)^2</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Asgharzadeh et al (2011). &quot;Comparisons of Methods of Estimation for the</span>
<span class="sd">           Half-Logistic Distribution&quot;. Selcuk J. Appl. Math. 93-108.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># halflogistic.pdf(x) = 2 * exp(-x) / (1+exp(-x))**2</span>
        <span class="c1">#                     = 1/2 * sech(x/2)**2</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">q</span><span class="p">),</span>
                          <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">9</span><span class="o">*</span><span class="n">_ZETA3</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mf">15.0</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="p">))</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">find_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
            <span class="c1"># scale is solution to a fix point problem ([1] 2.6)</span>
            <span class="c1"># use approximate MLE as starting point ([1] 3.1)</span>
            <span class="n">n_observations</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_observations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">n_observations</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">q</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p</span>
            <span class="n">pp1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">p</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">p</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">pp1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">pp1</span> <span class="o">/</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="n">pp1</span>
            <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">sorted_data</span> <span class="o">-</span> <span class="n">loc</span>
            <span class="n">B</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">sorted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="n">C</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">sorted_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="c1"># starting guess</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="p">((</span><span class="n">B</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">B</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">n_observations</span> <span class="o">*</span> <span class="n">C</span><span class="p">))</span>
                    <span class="o">/</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n_observations</span><span class="p">))</span>

            <span class="c1"># relative tolerance of fix point iterator</span>
            <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1e-8</span>
            <span class="n">relative_residual</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">shifted_mean</span> <span class="o">=</span> <span class="n">sorted_data</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># y_mean - y_min</span>

            <span class="c1"># find fix point by repeated application of eq. (2.6)</span>
            <span class="c1"># simplify as</span>
            <span class="c1"># exp(-x) / (1 + exp(-x)) = 1 / (1 + exp(x))</span>
            <span class="c1">#                         = expit(-x))</span>
            <span class="k">while</span> <span class="n">relative_residual</span> <span class="o">&gt;</span> <span class="n">rtol</span><span class="p">:</span>
                <span class="n">sum_term</span> <span class="o">=</span> <span class="n">sorted_data</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="o">-</span><span class="n">sorted_data</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">scale_new</span> <span class="o">=</span> <span class="n">shifted_mean</span> <span class="o">-</span> <span class="mi">2</span><span class="o">/</span><span class="n">n_observations</span> <span class="o">*</span> <span class="n">sum_term</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="n">relative_residual</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">((</span><span class="n">scale</span> <span class="o">-</span> <span class="n">scale_new</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">scale_new</span>
            <span class="k">return</span> <span class="n">scale</span>

        <span class="c1"># location is independent from the scale</span>
        <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="n">floc</span><span class="p">:</span>
                <span class="c1"># There are values that are less than the specified loc.</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;halflogistic&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if not provided, location MLE is the minimal data point</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data_min</span>

        <span class="c1"># scale depends on location</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span> <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">find_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">halflogistic</span> <span class="o">=</span> <span class="n">halflogistic_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halflogistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halfnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A half-normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halfnorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \sqrt{2/\pi} \exp(-x^2 / 2)</span>

<span class="sd">    for :math:`x &gt;= 0`.</span>

<span class="sd">    `halfnorm` is a special case of `chi` with ``df=1``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># halfnorm.pdf(x) = sqrt(2/pi) * exp(-x**2/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_ppf</span><span class="p">((</span><span class="mi">1</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_isf</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="mi">1</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="mi">8</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data_min</span> <span class="o">&lt;</span> <span class="n">floc</span><span class="p">:</span>
                <span class="c1"># There are values that are less than the specified loc.</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;halfnorm&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data_min</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">moment</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">loc</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>

        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">halfnorm</span> <span class="o">=</span> <span class="n">halfnorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halfnorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">hypsecant_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A hyperbolic secant continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `hypsecant` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi} \text{sech}(x)</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># hypsecant.pdf(x) = 1/pi * sech(x)</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>


<span class="n">hypsecant</span> <span class="o">=</span> <span class="n">hypsecant_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;hypsecant&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gausshyper_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gauss hypergeometric continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gausshyper` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b, c, z) = C x^{a-1} (1-x)^{b-1} (1+zx)^{-c}</span>

<span class="sd">    for :math:`0 \le x \le 1`, :math:`a,b &gt; 0`, :math:`c` a real number,</span>
<span class="sd">    :math:`z &gt; -1`, and :math:`C = \frac{1}{B(a, b) F[2, 1](c, a; a+b; -z)}`.</span>
<span class="sd">    :math:`F[2, 1]` is the Gauss hypergeometric function</span>
<span class="sd">    `scipy.special.hyp2f1`.</span>

<span class="sd">    `gausshyper` takes :math:`a`, :math:`b`, :math:`c` and :math:`z` as shape</span>
<span class="sd">    parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Armero, C., and M. J. Bayarri. &quot;Prior Assessments for Prediction in</span>
<span class="sd">           Queues.&quot; *Journal of the Royal Statistical Society*. Series D (The</span>
<span class="sd">           Statistician) 43, no. 1 (1994): 139-53. doi:10.2307/2348939</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="c1"># z &gt; -1 per gh-10134</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">c</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">z</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">iz</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">,</span> <span class="n">ic</span><span class="p">,</span> <span class="n">iz</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">normalization_constant</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">hyp2f1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">normalization_constant</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">hyp2f1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">n</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>
        <span class="n">den</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">hyp2f1</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">z</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fac</span><span class="o">*</span><span class="n">num</span> <span class="o">/</span> <span class="n">den</span>


<span class="n">gausshyper</span> <span class="o">=</span> <span class="n">gausshyper_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gausshyper&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">invgamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An inverted gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `invgamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = \frac{x^{-a-1}}{\Gamma(a)} \exp(-\frac{1}{x})</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`a &gt; 0`. :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    `invgamma` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    `invgamma` is a special case of `gengamma` with ``c=-1``, and it is a</span>
<span class="sd">    different parameterization of the scaled inverse chi-squared distribution.</span>
<span class="sd">    Specifically, if the scaled inverse chi-squared distribution is</span>
<span class="sd">    parameterized with degrees of freedom :math:`\nu` and scaling parameter</span>
<span class="sd">    :math:`\tau^2`, then it can be modeled using `invgamma` with</span>
<span class="sd">    ``a=`` :math:`\nu/2` and ``scale=`` :math:`\nu \tau^2/2`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># invgamma.pdf(x, a) = x**(-a-1) / gamma(a) * exp(-1/x)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">):</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
                <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">4.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span>
                <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span>
                <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">6.</span> <span class="o">*</span> <span class="p">(</span><span class="mf">5.</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">11.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">regular</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">psi</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h</span>

        <span class="k">def</span> <span class="nf">asymptotic</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="c1"># gammaln(a) ~ a * ln(a) - a - 0.5 * ln(a) + 0.5 * ln(2 * pi)</span>
            <span class="c1"># psi(a) ~ ln(a) - 1 / (2 * a)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">/</span><span class="mi">2</span>
                 <span class="o">+</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">a</span><span class="o">**-</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">a</span><span class="o">**-</span><span class="mf">2.</span><span class="o">/</span><span class="mi">12</span> <span class="o">-</span> <span class="n">a</span><span class="o">**-</span><span class="mf">3.</span><span class="o">/</span><span class="mi">90</span> <span class="o">-</span> <span class="n">a</span><span class="o">**-</span><span class="mf">4.</span><span class="o">/</span><span class="mi">120</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">2e2</span><span class="p">,</span> <span class="p">(</span><span class="n">a</span><span class="p">,),</span> <span class="n">f</span><span class="o">=</span><span class="n">asymptotic</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">regular</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span>


<span class="n">invgamma</span> <span class="o">=</span> <span class="n">invgamma_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invgamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">invgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `invgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x; \mu) = \frac{1}{\sqrt{2 \pi x^3}}</span>
<span class="sd">                    \exp\left(-\frac{(x-\mu)^2}{2 \mu^2 x}\right)</span>

<span class="sd">    for :math:`x \ge 0` and :math:`\mu &gt; 0`.</span>

<span class="sd">    `invgauss` takes ``mu`` as a shape parameter for :math:`\mu`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    A common shape-scale parameterization of the inverse Gaussian distribution</span>
<span class="sd">    has density</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x; \nu, \lambda) = \sqrt{\frac{\lambda}{2 \pi x^3}}</span>
<span class="sd">                    \exp\left( -\frac{\lambda(x-\nu)^2}{2 \nu^2 x}\right)</span>

<span class="sd">    Using ``nu`` for :math:`\nu` and ``lam`` for :math:`\lambda`, this</span>
<span class="sd">    parameterization is equivalent to the one above with ``mu = nu/lam``,</span>
<span class="sd">    ``loc = 0``, and ``scale = lam``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">wald</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="c1"># invgauss.pdf(x, mu) =</span>
        <span class="c1">#                  1 / sqrt(2*pi*x**3) * exp(-(x-mu)**2/(2*x*mu**2))</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mf">3.0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># approach adapted from equations in</span>
    <span class="c1"># https://journal.r-project.org/archive/2016-1/giner-smyth.pdf,</span>
    <span class="c1"># not R code. see gh-13616</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">fac</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">fac</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">fac</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">b</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">fac</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
            <span class="n">ppf</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_invgauss_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">i_wt</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span>  <span class="c1"># &quot;wrong tail&quot; - sometimes too inaccurate</span>
            <span class="n">ppf</span><span class="p">[</span><span class="n">i_wt</span><span class="p">]</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_invgauss_isf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i_wt</span><span class="p">],</span> <span class="n">mu</span><span class="p">[</span><span class="n">i_wt</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">i_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ppf</span><span class="p">)</span>
            <span class="n">ppf</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i_nan</span><span class="p">],</span> <span class="n">mu</span><span class="p">[</span><span class="n">i_nan</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">ppf</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">)</span>
            <span class="n">isf</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_invgauss_isf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">i_wt</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.5</span>  <span class="c1"># &quot;wrong tail&quot; - sometimes too inaccurate</span>
            <span class="n">isf</span><span class="p">[</span><span class="n">i_wt</span><span class="p">]</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_invgauss_ppf</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i_wt</span><span class="p">],</span> <span class="n">mu</span><span class="p">[</span><span class="n">i_wt</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">i_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">isf</span><span class="p">)</span>
            <span class="n">isf</span><span class="p">[</span><span class="n">i_nan</span><span class="p">]</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_isf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i_nan</span><span class="p">],</span> <span class="n">mu</span><span class="p">[</span><span class="n">i_nan</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">isf</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu</span><span class="o">**</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mu</span><span class="p">),</span> <span class="mi">15</span><span class="o">*</span><span class="n">mu</span>

    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;method&#39;</span><span class="p">,</span> <span class="s1">&#39;mle&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="n">wald_gen</span>
                <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">fshape_s</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                                   <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Source: Statistical Distributions, 3rd Edition. Evans, Hastings,</span>
<span class="sd">        and Peacock (2000), Page 121. Their shape parameter is equivalent to</span>
<span class="sd">        SciPy&#39;s with the conversion `fshape_s = fshape / scale`.</span>

<span class="sd">        MLE formulas are not used in 3 conditions:</span>
<span class="sd">        - `loc` is not fixed</span>
<span class="sd">        - `mu` is fixed</span>
<span class="sd">        These cases fall back on the superclass fit method.</span>
<span class="sd">        - `loc` is fixed but translation results in negative data raises</span>
<span class="sd">          a `FitDataError`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fshape_s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;invgauss&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">floc</span>
            <span class="n">fshape_n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fscale</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">data</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">fshape_n</span> <span class="o">**</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">fshape_s</span> <span class="o">=</span> <span class="n">fshape_n</span> <span class="o">/</span> <span class="n">fscale</span>
        <span class="k">return</span> <span class="n">fshape_s</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ref.: https://moser-isi.ethz.ch/docs/papers/smos-2012-10.pdf (eq. 9)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># a = log(2*pi*e*mu**3)</span>
        <span class="c1">#   = 1 + log(2*pi) + 3 * log(mu)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="c1"># b = exp(2/mu) * exp1(2/mu)</span>
        <span class="c1">#   = _scaled_exp1(2/mu) / (2/mu)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mi">2</span><span class="o">/</span><span class="n">mu</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">_ufuncs</span><span class="o">.</span><span class="n">_scaled_exp1</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="n">r</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">a</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">b</span>


<span class="n">invgauss</span> <span class="o">=</span> <span class="n">invgauss_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invgauss&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">geninvgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Generalized Inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `geninvgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, p, b) = x^{p-1} \exp(-b (x + 1/x) / 2) / (2 K_p(b))</span>

<span class="sd">    where `x &gt; 0`, `p` is a real number and `b &gt; 0`\([1]_).</span>
<span class="sd">    :math:`K_p` is the modified Bessel function of second kind of order `p`</span>
<span class="sd">    (`scipy.special.kv`).</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The inverse Gaussian distribution `stats.invgauss(mu)` is a special case of</span>
<span class="sd">    `geninvgauss` with `p = -1/2`, `b = 1 / mu` and `scale = mu`.</span>

<span class="sd">    Generating random variates is challenging for this distribution. The</span>
<span class="sd">    implementation is based on [2]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] O. Barndorff-Nielsen, P. Blaesild, C. Halgreen, &quot;First hitting time</span>
<span class="sd">       models for the generalized inverse gaussian distribution&quot;,</span>
<span class="sd">       Stochastic Processes and their Applications 7, pp. 49--54, 1978.</span>

<span class="sd">    .. [2] W. Hoermann and J. Leydold, &quot;Generating generalized inverse Gaussian</span>
<span class="sd">       random variates&quot;, Statistics and Computing, 24(4), p. 547--557, 2014.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">p</span> <span class="o">==</span> <span class="n">p</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ip</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ip</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># kve instead of kv works better for large values of b</span>
        <span class="c1"># warn if kve produces infinite values and replace by nan</span>
        <span class="c1"># otherwise c = -inf and the results are often incorrect</span>
        <span class="k">def</span> <span class="nf">logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">geninvgauss_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="n">logpdf_single</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">logpdf_single</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span>

        <span class="n">z</span> <span class="o">=</span> <span class="n">logpdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Infinite values encountered in scipy.special.kve(p, b). &quot;</span>
                   <span class="s2">&quot;Values replaced by NaN to avoid incorrect results.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">z</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># relying on logpdf avoids overflow of x**(p-1) for large x and p</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_support</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_cdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">p</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">args</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="s1">&#39;_geninvgauss_pdf&#39;</span><span class="p">,</span>
                                               <span class="n">user_data</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">_a</span><span class="p">,</span> <span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">_cdf_single</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">_cdf_single</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">_cdf_single</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logquasipdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># log of the quasi-density (w/o normalizing constant) used in _rvs</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                          <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># if p and b are scalar, use _rvs_scalar, otherwise need to create</span>
        <span class="c1"># output by iterating over parameters</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">p</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">b</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># When this method is called, size will be a (possibly empty)</span>
            <span class="c1"># tuple of integers.  It will not be None; if `size=None` is passed</span>
            <span class="c1"># to `rvs()`, size will be the empty tuple ().</span>

            <span class="n">p</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="c1"># p and b now have the same shape.</span>

            <span class="c1"># `shp` is the shape of the blocks of random variates that are</span>
            <span class="c1"># generated for each combination of parameters associated with</span>
            <span class="c1"># broadcasting p and b.</span>
            <span class="c1"># bc is a tuple the same length as size.  The values</span>
            <span class="c1"># in bc are bools.  If bc[j] is True, it means that</span>
            <span class="c1"># entire axis is filled in for a given combination of the</span>
            <span class="c1"># broadcast arguments.</span>
            <span class="n">shp</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">_check_shape</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

            <span class="c1"># `numsamples` is the total number of variates to be generated</span>
            <span class="c1"># for each combination of the input arguments.</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shp</span><span class="p">))</span>

            <span class="c1"># `out` is the array to be returned.  It is filled in the</span>
            <span class="c1"># loop below.</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

            <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">],</span>
                           <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;multi_index&#39;</span><span class="p">],</span>
                           <span class="n">op_flags</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;readonly&#39;</span><span class="p">]])</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">it</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="c1"># Convert the iterator&#39;s multi_index into an index into the</span>
                <span class="c1"># `out` array where the call to _rvs_scalar() will be stored.</span>
                <span class="c1"># Where bc is True, we use a full slice; otherwise we use the</span>
                <span class="c1"># index value from it.multi_index.  len(it.multi_index) might</span>
                <span class="c1"># be less than len(bc), and in that case we want to align these</span>
                <span class="c1"># two sequences to the right, so the loop variable j runs from</span>
                <span class="c1"># -len(size) to 0.  This doesn&#39;t cause an IndexError, as</span>
                <span class="c1"># bc[j] will be True in those cases where it.multi_index[j]</span>
                <span class="c1"># would cause an IndexError.</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">it</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">numsamples</span><span class="p">,</span>
                                            <span class="n">random_state</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
                <span class="n">it</span><span class="o">.</span><span class="n">iternext</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_rvs_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">numsamples</span><span class="p">,</span> <span class="n">random_state</span><span class="p">):</span>
        <span class="c1"># following [2], the quasi-pdf is used instead of the pdf for the</span>
        <span class="c1"># generation of rvs</span>
        <span class="n">invert_res</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">numsamples</span><span class="p">:</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># note: if X is geninvgauss(p, b), then 1/X is geninvgauss(-p, b)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span>
            <span class="n">invert_res</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mode</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="c1"># determine method to be used following [2]</span>
        <span class="n">ratio_unif</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># ratio of uniforms with mode shift below</span>
            <span class="n">mode_shift</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">):</span>
            <span class="c1"># ratio of uniforms without mode shift below</span>
            <span class="n">mode_shift</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># new algorithm in [2]</span>
            <span class="n">ratio_unif</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># prepare sampling of rvs</span>
        <span class="n">size1d</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">numsamples</span><span class="p">))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size1d</span><span class="p">)</span>  <span class="c1"># number of rvs needed, reshape upon return</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">simulated</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">ratio_unif</span><span class="p">:</span>
            <span class="c1"># use ratio of uniforms method</span>
            <span class="k">if</span> <span class="n">mode_shift</span><span class="p">:</span>
                <span class="n">a2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span> <span class="o">-</span> <span class="n">m</span>
                <span class="n">a1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="c1"># find roots of x**3 + a2*x**2 + a1*x + m (Cardano&#39;s formula)</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">a1</span> <span class="o">-</span> <span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="n">q1</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a2</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">27</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">m</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="o">-</span><span class="n">q1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">27</span> <span class="o">/</span> <span class="n">p1</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span> <span class="o">*</span> <span class="n">p1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">root1</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="n">root2</span> <span class="o">=</span> <span class="o">-</span><span class="n">s1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">/</span> <span class="mi">3</span>
                <span class="c1"># root3 = s1 * np.cos(phi / 3 - np.pi / 3) - a2 / 3</span>

                <span class="c1"># if g is the quasipdf, rescale: g(x) / g(m) which we can write</span>
                <span class="c1"># as exp(log(g(x)) - log(g(m))). This is important</span>
                <span class="c1"># since for large values of p and b, g cannot be evaluated.</span>
                <span class="c1"># denote the rescaled quasipdf by h</span>
                <span class="n">lm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
                <span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">root1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">lm</span>
                <span class="n">d2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">root2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">lm</span>
                <span class="c1"># compute the bounding rectangle w.r.t. h. Note that</span>
                <span class="c1"># np.exp(0.5*d1) = np.sqrt(g(root1)/g(m)) = np.sqrt(h(root1))</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="p">(</span><span class="n">root1</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">d1</span><span class="p">)</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="p">(</span><span class="n">root2</span> <span class="o">-</span> <span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">d2</span><span class="p">)</span>
                <span class="n">umax</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># umax = sqrt(h(m)) = 1</span>

                <span class="k">def</span> <span class="nf">logqpdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">lm</span>

                <span class="n">c</span> <span class="o">=</span> <span class="n">m</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># ratio of uniforms without mode shift</span>
                <span class="c1"># compute np.sqrt(quasipdf(m))</span>
                <span class="n">umax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">xplus</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">b</span>
                <span class="n">vmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># compute xplus * np.sqrt(quasipdf(xplus))</span>
                <span class="n">vmax</span> <span class="o">=</span> <span class="n">xplus</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">xplus</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">def</span> <span class="nf">logqpdf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">vmin</span> <span class="o">&gt;=</span> <span class="n">vmax</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;vmin must be smaller than vmax.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">umax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;umax must be positive.&quot;</span><span class="p">)</span>

            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="c1"># simulate uniform rvs on [0, umax] and [vmin, vmax]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">umax</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">vmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span> <span class="o">*</span> <span class="n">v</span>
                <span class="n">rvs</span> <span class="o">=</span> <span class="n">v</span> <span class="o">/</span> <span class="n">u</span> <span class="o">+</span> <span class="n">c</span>
                <span class="c1"># rewrite acceptance condition u**2 &lt;= pdf(rvs) by taking logs</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">logqpdf</span><span class="p">(</span><span class="n">rvs</span><span class="p">))</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span><span class="p">[</span><span class="n">accept</span><span class="p">]</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">simulated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">N</span> <span class="o">&gt;=</span> <span class="mi">50000</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Not a single random variate could be generated &quot;</span>
                           <span class="sa">f</span><span class="s2">&quot;in </span><span class="si">{</span><span class="n">i</span><span class="o">*</span><span class="n">N</span><span class="si">}</span><span class="s2"> attempts. Sampling does not appear to &quot;</span>
                           <span class="s2">&quot;work for the provided parameters.&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># use new algorithm in [2]</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
            <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="p">))</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">*</span> <span class="n">x0</span>
            <span class="k">if</span> <span class="n">x0</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">k2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">A2</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">*</span> <span class="p">((</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="n">p</span> <span class="o">-</span> <span class="n">x0</span><span class="o">**</span><span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">p</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">A2</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">k2</span><span class="p">,</span> <span class="n">A2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="n">k3</span> <span class="o">=</span> <span class="n">xs</span><span class="o">**</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xs</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">+</span> <span class="n">A3</span>

            <span class="c1"># [2]: rejection constant is &lt; 2.73; so expected runtime is finite</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">h</span><span class="p">,</span> <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="c1"># simulate uniform rvs on [x1, x2] and [0, y2]</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">cond1</span> <span class="o">=</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="n">A1</span>
                <span class="n">cond2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">cond1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">v</span> <span class="o">&lt;=</span> <span class="n">A1</span> <span class="o">+</span> <span class="n">A2</span><span class="p">)</span>
                <span class="n">cond3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">cond1</span> <span class="o">|</span> <span class="n">cond2</span><span class="p">)</span>
                <span class="c1"># subdomain (0, x0)</span>
                <span class="n">rvs</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">v</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">/</span> <span class="n">A1</span>
                <span class="n">h</span><span class="p">[</span><span class="n">cond1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k1</span>
                <span class="c1"># subdomain (x0, 2 / b)</span>
                <span class="k">if</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rvs</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="o">**</span><span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">-</span> <span class="n">A1</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span> <span class="o">/</span> <span class="n">k2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">rvs</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">v</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">-</span> <span class="n">A1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
                <span class="n">h</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span> <span class="o">=</span> <span class="n">k2</span> <span class="o">*</span> <span class="n">rvs</span><span class="p">[</span><span class="n">cond2</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="c1"># subdomain (xs, infinity)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xs</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">-</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">A2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">k3</span><span class="p">)</span>
                <span class="n">rvs</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="n">h</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">=</span> <span class="n">k3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">rvs</span><span class="p">[</span><span class="n">cond3</span><span class="p">]</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="c1"># apply rejection method</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_logquasipdf</span><span class="p">(</span><span class="n">rvs</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span><span class="p">[</span><span class="n">accept</span><span class="p">]</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>

        <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">size1d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">invert_res</span><span class="p">:</span>
            <span class="n">rvs</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rvs</span>
        <span class="k">return</span> <span class="n">rvs</span>

    <span class="k">def</span> <span class="nf">_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># distinguish cases to avoid catastrophic cancellation (see [2])</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p</span><span class="p">))</span> <span class="o">/</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">num</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">kve</span><span class="p">(</span><span class="n">p</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">kve</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">inf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">denom</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">inf_vals</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Infinite values encountered in the moment calculation &quot;</span>
                   <span class="s2">&quot;involving scipy.special.kve. Values replaced by NaN to &quot;</span>
                   <span class="s2">&quot;avoid incorrect results.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">m</span><span class="p">[</span><span class="o">~</span><span class="n">inf_vals</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="p">[</span><span class="o">~</span><span class="n">inf_vals</span><span class="p">]</span> <span class="o">/</span> <span class="n">denom</span><span class="p">[</span><span class="o">~</span><span class="n">inf_vals</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">num</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="k">return</span> <span class="n">m</span>


<span class="n">geninvgauss</span> <span class="o">=</span> <span class="n">geninvgauss_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;geninvgauss&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">norminvgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Normal Inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `norminvgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{a \, K_1(a \sqrt{1 + x^2})}{\pi \sqrt{1 + x^2}} \,</span>
<span class="sd">                     \exp(\sqrt{a^2 - b^2} + b x)</span>

<span class="sd">    where :math:`x` is a real number, the parameter :math:`a` is the tail</span>
<span class="sd">    heaviness and :math:`b` is the asymmetry parameter satisfying</span>
<span class="sd">    :math:`a &gt; 0` and :math:`|b| &lt;= a`.</span>
<span class="sd">    :math:`K_1` is the modified Bessel function of second kind</span>
<span class="sd">    (`scipy.special.k1`).</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    A normal inverse Gaussian random variable `Y` with parameters `a` and `b`</span>
<span class="sd">    can be expressed as a normal mean-variance mixture:</span>
<span class="sd">    `Y = b * V + sqrt(V) * X` where `X` is `norm(0,1)` and `V` is</span>
<span class="sd">    `invgauss(mu=1/sqrt(a**2 - b**2))`. This representation is used</span>
<span class="sd">    to generate random variates.</span>

<span class="sd">    Another common parametrization of the distribution (see Equation 2.1 in</span>
<span class="sd">    [2]_) is given by the following expression of the pdf:</span>

<span class="sd">    .. math::</span>

<span class="sd">        g(x, \alpha, \beta, \delta, \mu) =</span>
<span class="sd">        \frac{\alpha\delta K_1\left(\alpha\sqrt{\delta^2 + (x - \mu)^2}\right)}</span>
<span class="sd">        {\pi \sqrt{\delta^2 + (x - \mu)^2}} \,</span>
<span class="sd">        e^{\delta \sqrt{\alpha^2 - \beta^2} + \beta (x - \mu)}</span>

<span class="sd">    In SciPy, this corresponds to</span>
<span class="sd">    `a = alpha * delta, b = beta * delta, loc = mu, scale=delta`.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] O. Barndorff-Nielsen, &quot;Hyperbolic Distributions and Distributions on</span>
<span class="sd">           Hyperbolae&quot;, Scandinavian Journal of Statistics, Vol. 5(3),</span>
<span class="sd">           pp. 151-157, 1978.</span>

<span class="sd">    .. [2] O. Barndorff-Nielsen, &quot;Normal Inverse Gaussian Distributions and</span>
<span class="sd">           Stochastic Volatility Modelling&quot;, Scandinavian Journal of</span>
<span class="sd">           Statistics, Vol. 24, pp. 1-13, 1997.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Arbitrary, but the default a = b = 1 is not valid; the distribution</span>
        <span class="c1"># requires |b| &lt; a.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fac1</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">sq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>  <span class="c1"># reduce overflows</span>
        <span class="k">return</span> <span class="n">fac1</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">k1e</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">sq</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">a</span><span class="o">*</span><span class="n">sq</span> <span class="o">+</span> <span class="n">gamma</span><span class="p">)</span> <span class="o">/</span> <span class="n">sq</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="c1"># If x is a scalar, then so are a and b.</span>
            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
                                             <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">))[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_isf_scalar</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>

            <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
                <span class="c1"># Solve eq(x, a, b, q) = 0 to obtain isf(x, a, b) = q.</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span>

            <span class="c1"># Find a bracketing interval for the root.</span>
            <span class="c1"># Start at the mean, and grow the length of the interval</span>
            <span class="c1"># by 2 each iteration until there is a sign change in eq.</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">eq</span><span class="p">(</span><span class="n">xm</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">em</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Unlikely, but might as well check.</span>
                <span class="k">return</span> <span class="n">xm</span>
            <span class="k">if</span> <span class="n">em</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">xm</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">xm</span> <span class="o">+</span> <span class="n">delta</span>
                <span class="k">while</span> <span class="n">eq</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">delta</span>
                    <span class="n">right</span> <span class="o">=</span> <span class="n">xm</span> <span class="o">+</span> <span class="n">delta</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># em &lt; 0</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">right</span> <span class="o">=</span> <span class="n">xm</span>
                <span class="n">left</span> <span class="o">=</span> <span class="n">xm</span> <span class="o">-</span> <span class="n">delta</span>
                <span class="k">while</span> <span class="n">eq</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">delta</span>
                    <span class="n">left</span> <span class="o">=</span> <span class="n">xm</span> <span class="o">-</span> <span class="n">delta</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">brentq</span><span class="p">(</span><span class="n">eq</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span>
                                     <span class="n">xtol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">xtol</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_isf_scalar</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">q0</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_isf_scalar</span><span class="p">(</span><span class="n">q0</span><span class="p">,</span> <span class="n">a0</span><span class="p">,</span> <span class="n">b0</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># note: X = b * V + sqrt(V) * X is norminvgaus(a,b) if X is standard</span>
        <span class="c1"># normal and V is invgauss(mu=1/sqrt(a**2 - b**2))</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ig</span> <span class="o">=</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">gamma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="n">ig</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ig</span><span class="p">)</span> <span class="o">*</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                               <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">b</span> <span class="o">/</span> <span class="n">gamma</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">gamma</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">skewness</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma</span><span class="p">))</span>
        <span class="n">kurtosis</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">gamma</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">variance</span><span class="p">,</span> <span class="n">skewness</span><span class="p">,</span> <span class="n">kurtosis</span>


<span class="n">norminvgauss</span> <span class="o">=</span> <span class="n">norminvgauss_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;norminvgauss&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">invweibull_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An inverted Weibull continuous random variable.</span>

<span class="sd">    This distribution is also known as the Fréchet distribution or the</span>
<span class="sd">    type II extreme value distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `invweibull` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c x^{-c-1} \\exp(-x^{-c})</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `invweibull` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    F.R.S. de Gusmao, E.M.M Ortega and G.M. Cordeiro, &quot;The generalized inverse</span>
<span class="sd">    Weibull distribution&quot;, Stat. Papers, vol. 52, pp. 591-619, 2011.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># invweibull.pdf(x, c) = c * x**(-c-1) * exp(-x**(-c))</span>
        <span class="n">xc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="n">xc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="n">xc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xc2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">xc1</span> <span class="o">*</span> <span class="n">xc2</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">xc1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xc1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**-</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">p</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="n">_EULER</span> <span class="o">+</span> <span class="n">_EULER</span> <span class="o">/</span> <span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># invweibull requires c &gt; 1 for the first moment to exist, so use 2.0</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,)</span> <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">args</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>


<span class="n">invweibull</span> <span class="o">=</span> <span class="n">invweibull_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invweibull&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">jf_skew_t_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Jones and Faddy skew-t distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `jf_skew_t` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x; a, b) = C_{a,b}^{-1}</span>
<span class="sd">                    \left(1+\frac{x}{\left(a+b+x^2\right)^{1/2}}\right)^{a+1/2}</span>
<span class="sd">                    \left(1-\frac{x}{\left(a+b+x^2\right)^{1/2}}\right)^{b+1/2}</span>

<span class="sd">    for real numbers :math:`a&gt;0` and :math:`b&gt;0`, where</span>
<span class="sd">    :math:`C_{a,b} = 2^{a+b-1}B(a,b)(a+b)^{1/2}`, and :math:`B` denotes the</span>
<span class="sd">    beta function (`scipy.special.beta`).</span>

<span class="sd">    When :math:`a&lt;b`, the distribution is negatively skewed, and when</span>
<span class="sd">    :math:`a&gt;b`, the distribution is positively skewed. If :math:`a=b`, then</span>
<span class="sd">    we recover the `t` distribution with :math:`2a` degrees of freedom.</span>

<span class="sd">    `jf_skew_t` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] M.C. Jones and M.J. Faddy. &quot;A skew extension of the t distribution,</span>
<span class="sd">           with applications&quot; *Journal of the Royal Statistical Society*.</span>
<span class="sd">           Series B (Statistical Methodology) 65, no. 1 (2003): 159-174.</span>
<span class="sd">           :doi:`10.1111/1467-9868.00378`</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d1</span> <span class="o">*</span> <span class="n">d2</span> <span class="o">/</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">d3</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">d2</span> <span class="o">/</span> <span class="n">d3</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">0.5</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">betainc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="n">beta</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">d3</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d1</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">d2</span> <span class="o">/</span> <span class="n">d3</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the n-th moment(s) where all the following hold:</span>

<span class="sd">        - n &gt;= 0</span>
<span class="sd">        - a &gt; n / 2</span>
<span class="sd">        - b &gt; n / 2</span>

<span class="sd">        The result is np.nan in all other cases.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">nth_moment</span><span class="p">(</span><span class="n">n_k</span><span class="p">,</span> <span class="n">a_k</span><span class="p">,</span> <span class="n">b_k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Computes E[T^(n_k)] where T is skew-t distributed with</span>
<span class="sd">            parameters a_k and b_k.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">num</span> <span class="o">=</span> <span class="p">(</span><span class="n">a_k</span> <span class="o">+</span> <span class="n">b_k</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">n_k</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">n_k</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a_k</span><span class="p">,</span> <span class="n">b_k</span><span class="p">)</span>

            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">sgn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">indices</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">a_k</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">n_k</span> <span class="o">-</span> <span class="n">indices</span><span class="p">,</span> <span class="n">b_k</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">n_k</span> <span class="o">+</span> <span class="n">indices</span><span class="p">)</span>
            <span class="n">sum_terms</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">comb</span><span class="p">(</span><span class="n">n_k</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="o">*</span> <span class="n">sgn</span> <span class="o">*</span> <span class="n">d</span>

            <span class="k">return</span> <span class="n">num</span> <span class="o">/</span> <span class="n">denom</span> <span class="o">*</span> <span class="n">sum_terms</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">nth_moment_valid</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">nth_moment_valid</span><span class="p">,</span>
            <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">nth_moment</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="p">)</span>


<span class="n">jf_skew_t</span> <span class="o">=</span> <span class="n">jf_skew_t_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;jf_skew_t&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">johnsonsb_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Johnson SB continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    johnsonsu</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `johnsonsb` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{b}{x(1-x)}  \phi(a + b \log \frac{x}{1-x} )</span>

<span class="sd">    where :math:`x`, :math:`a`, and :math:`b` are real scalars; :math:`b &gt; 0`</span>
<span class="sd">    and :math:`x \in [0,1]`.  :math:`\phi` is the pdf of the normal</span>
<span class="sd">    distribution.</span>

<span class="sd">    `johnsonsb` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># johnsonsb.pdf(x, a, b) = b / (x*(1-x)) * phi(a + b * log(x/(1-x)))</span>
        <span class="n">trm</span> <span class="o">=</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">*</span><span class="n">trm</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">_norm_isf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">))</span>


<span class="n">johnsonsb</span> <span class="o">=</span> <span class="n">johnsonsb_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;johnsonsb&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">johnsonsu_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Johnson SU continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    johnsonsb</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `johnsonsu` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{b}{\sqrt{x^2 + 1}}</span>
<span class="sd">                     \phi(a + b \log(x + \sqrt{x^2 + 1}))</span>

<span class="sd">    where :math:`x`, :math:`a`, and :math:`b` are real scalars; :math:`b &gt; 0`.</span>
<span class="sd">    :math:`\phi` is the pdf of the normal distribution.</span>

<span class="sd">    `johnsonsu` takes :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    The first four central moments are calculated according to the formulas</span>
<span class="sd">    in [1]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Taylor Enterprises. &quot;Johnson Family of Distributions&quot;.</span>
<span class="sd">       https://variation.com/wp-content/distribution_analyzer_help/hs126.htm</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># johnsonsu.pdf(x, a, b) = b / sqrt(x**2 + 1) *</span>
        <span class="c1">#                          phi(a + b * log(x + sqrt(x**2 + 1)))</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="n">trm</span> <span class="o">=</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x2</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">*</span><span class="n">trm</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">((</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">((</span><span class="n">_norm_isf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="c1"># Naive implementation of first and second moment to address gh-18071.</span>
        <span class="c1"># https://variation.com/wp-content/distribution_analyzer_help/hs126.htm</span>
        <span class="c1"># Numerical improvements left to future enhancements.</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">bn2</span> <span class="o">=</span> <span class="n">b</span><span class="o">**-</span><span class="mf">2.</span>
        <span class="n">expbn2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bn2</span><span class="p">)</span>
        <span class="n">a_b</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>

        <span class="k">if</span> <span class="s1">&#39;m&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="o">-</span><span class="n">expbn2</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a_b</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mu2</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">bn2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">expbn2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a_b</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">expbn2</span><span class="o">**</span><span class="mf">.5</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">bn2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a_b</span><span class="p">)</span>
            <span class="n">t3</span> <span class="o">=</span> <span class="n">expbn2</span> <span class="o">*</span> <span class="p">(</span><span class="n">expbn2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">a_b</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">expbn2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a_b</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="o">-</span><span class="n">t1</span> <span class="o">*</span> <span class="p">(</span><span class="n">t2</span> <span class="o">+</span> <span class="n">t3</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="n">expbn2</span>
            <span class="n">t2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">expbn2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">expbn2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a_b</span><span class="p">)</span>
            <span class="n">t3</span> <span class="o">=</span> <span class="n">expbn2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a_b</span><span class="p">)</span>
            <span class="n">t4</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">expbn2</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">expbn2</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="n">expbn2</span><span class="o">**</span><span class="mi">4</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">expbn2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">a_b</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span> <span class="o">+</span> <span class="n">t2</span> <span class="o">+</span> <span class="n">t3</span><span class="o">*</span><span class="n">t4</span><span class="p">)</span> <span class="o">/</span> <span class="n">denom</span> <span class="o">-</span> <span class="mi">3</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">johnsonsu</span> <span class="o">=</span> <span class="n">johnsonsu_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;johnsonsu&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">laplace_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Laplace continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `laplace` is</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{2} \exp(-|x|)</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">laplace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># laplace.pdf(x) = 1/2 * exp(-abs(x))</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">),</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># By symmetry...</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="c1"># By symmetry...</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@replace_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        This function uses explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the Laplace distribution parameters, so the keyword</span>
<span class="s2">        arguments `loc`, `scale`, and `optimizer` are ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># Source: Statistical Distributions, 3rd Edition. Evans, Hastings,</span>
        <span class="c1"># and Peacock (2000), Page 124</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">floc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fscale</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span><span class="p">)))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>


<span class="n">laplace</span> <span class="o">=</span> <span class="n">laplace_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;laplace&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">laplace_asymmetric_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An asymmetric Laplace continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    laplace : Laplace distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `laplace_asymmetric` is</span>

<span class="sd">    .. math::</span>

<span class="sd">       f(x, \kappa) &amp;= \frac{1}{\kappa+\kappa^{-1}}\exp(-x\kappa),\quad x\ge0\\</span>
<span class="sd">                    &amp;= \frac{1}{\kappa+\kappa^{-1}}\exp(x/\kappa),\quad x&lt;0\\</span>

<span class="sd">    for :math:`-\infty &lt; x &lt; \infty`, :math:`\kappa &gt; 0`.</span>

<span class="sd">    `laplace_asymmetric` takes ``kappa`` as a shape parameter for</span>
<span class="sd">    :math:`\kappa`. For :math:`\kappa = 1`, it is identical to a</span>
<span class="sd">    Laplace distribution.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    Note that the scale parameter of some references is the reciprocal of</span>
<span class="sd">    SciPy&#39;s ``scale``. For example, :math:`\lambda = 1/2` in the</span>
<span class="sd">    parameterization of [1]_ is equivalent to ``scale = 2`` with</span>
<span class="sd">    `laplace_asymmetric`.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Asymmetric Laplace distribution&quot;, Wikipedia</span>
<span class="sd">            https://en.wikipedia.org/wiki/Asymmetric_Laplace_distribution</span>

<span class="sd">    .. [2] Kozubowski TJ and Podgórski K. A Multivariate and</span>
<span class="sd">           Asymmetric Generalization of Laplace Distribution,</span>
<span class="sd">           Computational Statistics 15, 531--540 (2000).</span>
<span class="sd">           :doi:`10.1007/PL00022717`</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">lPx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">kappa</span><span class="p">,</span> <span class="n">kapinv</span><span class="p">)</span>
        <span class="n">lPx</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lPx</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kapinv</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">kapinv</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kapinv</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">),</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">kapinv</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">kappa</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;=</span> <span class="n">kappa</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">,</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kapinv</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">/</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">kappkapinv</span> <span class="o">=</span> <span class="n">kappa</span><span class="o">+</span><span class="n">kapinv</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;=</span> <span class="n">kapinv</span><span class="o">/</span><span class="n">kappkapinv</span><span class="p">,</span>
                        <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kapinv</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span><span class="o">*</span><span class="n">kappkapinv</span><span class="o">/</span><span class="n">kappa</span><span class="p">)</span><span class="o">*</span><span class="n">kappa</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="n">kapinv</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">kappa</span>
        <span class="n">mn</span> <span class="o">=</span> <span class="n">kapinv</span> <span class="o">-</span> <span class="n">kappa</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">kapinv</span><span class="o">*</span><span class="n">kapinv</span> <span class="o">+</span> <span class="n">kappa</span><span class="o">*</span><span class="n">kappa</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">6.0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mn</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">kappa</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">kappa</span><span class="p">)</span>


<span class="n">laplace_asymmetric</span> <span class="o">=</span> <span class="n">laplace_asymmetric_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;laplace_asymmetric&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_fit_input_parameters</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="n">num_shapes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span> <span class="k">if</span> <span class="n">dist</span><span class="o">.</span><span class="n">shapes</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">fshape_keys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fshapes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># user has many options for fixing the shape, so here we standardize it</span>
    <span class="c1"># into &#39;f&#39; + the number of the shape.</span>
    <span class="c1"># Adapted from `_reduce_func` in `_distn_infrastructure.py`:</span>
    <span class="k">if</span> <span class="n">dist</span><span class="o">.</span><span class="n">shapes</span><span class="p">:</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">shapes</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">shapes</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="s1">&#39;f&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">,</span> <span class="s1">&#39;fix_&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">_get_fixed_fit_value</span><span class="p">(</span><span class="n">kwds</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
            <span class="n">fshape_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="n">fshapes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">kwds</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="c1"># determine if there are any unknown arguments in kwds</span>
    <span class="n">known_keys</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="s1">&#39;optimizer&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">fshape_keys</span><span class="p">}</span>
    <span class="n">unknown_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">known_keys</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">unknown_keys</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown keyword arguments: </span><span class="si">{</span><span class="n">unknown_keys</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">num_shapes</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many positional arguments.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span><span class="p">,</span> <span class="o">*</span><span class="n">fshapes</span><span class="p">}:</span>
        <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
        <span class="c1"># Without this check, this function would just return the</span>
        <span class="c1"># parameters that were given.</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                           <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

    <span class="n">uncensored</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">)</span> <span class="k">else</span> <span class="n">data</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">uncensored</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">fshapes</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">levy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Levy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    levy_stable, levy_l</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `levy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\sqrt{2\pi x^3}} \exp\left(-\frac{1}{2x}\right)</span>

<span class="sd">    for :math:`x &gt; 0`.</span>

<span class="sd">    This is the same as the Levy-stable distribution with :math:`a=1/2` and</span>
<span class="sd">    :math:`b=1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from scipy.stats import levy</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>

<span class="sd">    Calculate the first four moments:</span>

<span class="sd">    &gt;&gt;&gt; mean, var, skew, kurt = levy.stats(moments=&#39;mvsk&#39;)</span>

<span class="sd">    Display the probability density function (``pdf``):</span>

<span class="sd">    &gt;&gt;&gt; # `levy` is very heavy-tailed.</span>
<span class="sd">    &gt;&gt;&gt; # To show a nice plot, let&#39;s cut off the upper 40 percent.</span>
<span class="sd">    &gt;&gt;&gt; a, b = levy.ppf(0), levy.ppf(0.6)</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(a, b, 100)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, levy.pdf(x),</span>
<span class="sd">    ...        &#39;r-&#39;, lw=5, alpha=0.6, label=&#39;levy pdf&#39;)</span>

<span class="sd">    Alternatively, the distribution object can be called (as a function)</span>
<span class="sd">    to fix the shape, location and scale parameters. This returns a &quot;frozen&quot;</span>
<span class="sd">    RV object holding the given parameters fixed.</span>

<span class="sd">    Freeze the distribution and display the frozen ``pdf``:</span>

<span class="sd">    &gt;&gt;&gt; rv = levy()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, rv.pdf(x), &#39;k-&#39;, lw=2, label=&#39;frozen pdf&#39;)</span>

<span class="sd">    Check accuracy of ``cdf`` and ``ppf``:</span>

<span class="sd">    &gt;&gt;&gt; vals = levy.ppf([0.001, 0.5, 0.999])</span>
<span class="sd">    &gt;&gt;&gt; np.allclose([0.001, 0.5, 0.999], levy.cdf(vals))</span>
<span class="sd">    True</span>

<span class="sd">    Generate random numbers:</span>

<span class="sd">    &gt;&gt;&gt; r = levy.rvs(size=1000)</span>

<span class="sd">    And compare the histogram:</span>

<span class="sd">    &gt;&gt;&gt; # manual binning to ignore the tail</span>
<span class="sd">    &gt;&gt;&gt; bins = np.concatenate((np.linspace(a, b, 20), [np.max(r)]))</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(r, bins=bins, density=True, histtype=&#39;stepfilled&#39;, alpha=0.2)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlim([x[0], x[-1]])</span>
<span class="sd">    &gt;&gt;&gt; ax.legend(loc=&#39;best&#39;, frameon=False)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># levy.pdf(x) = 1 / (x * sqrt(2*pi*x)) * exp(-1/(2*x))</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># Equivalent to 2*norm.sf(np.sqrt(1/x))</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="c1"># Equivalent to 1.0/(norm.isf(q/2)**2) or 0.5/(erfcinv(q)**2)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">_norm_isf</span><span class="p">(</span><span class="n">q</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">erfinv</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="n">levy</span> <span class="o">=</span> <span class="n">levy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;levy&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">levy_l_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A left-skewed Levy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    levy, levy_stable</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `levy_l` is:</span>

<span class="sd">    .. math::</span>
<span class="sd">        f(x) = \frac{1}{|x| \sqrt{2\pi |x|}} \exp{ \left(-\frac{1}{2|x|} \right)}</span>

<span class="sd">    for :math:`x &lt; 0`.</span>

<span class="sd">    This is the same as the Levy-stable distribution with :math:`a=1/2` and</span>
<span class="sd">    :math:`b=-1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from scipy.stats import levy_l</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>

<span class="sd">    Calculate the first four moments:</span>

<span class="sd">    &gt;&gt;&gt; mean, var, skew, kurt = levy_l.stats(moments=&#39;mvsk&#39;)</span>

<span class="sd">    Display the probability density function (``pdf``):</span>

<span class="sd">    &gt;&gt;&gt; # `levy_l` is very heavy-tailed.</span>
<span class="sd">    &gt;&gt;&gt; # To show a nice plot, let&#39;s cut off the lower 40 percent.</span>
<span class="sd">    &gt;&gt;&gt; a, b = levy_l.ppf(0.4), levy_l.ppf(1)</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(a, b, 100)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, levy_l.pdf(x),</span>
<span class="sd">    ...        &#39;r-&#39;, lw=5, alpha=0.6, label=&#39;levy_l pdf&#39;)</span>

<span class="sd">    Alternatively, the distribution object can be called (as a function)</span>
<span class="sd">    to fix the shape, location and scale parameters. This returns a &quot;frozen&quot;</span>
<span class="sd">    RV object holding the given parameters fixed.</span>

<span class="sd">    Freeze the distribution and display the frozen ``pdf``:</span>

<span class="sd">    &gt;&gt;&gt; rv = levy_l()</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, rv.pdf(x), &#39;k-&#39;, lw=2, label=&#39;frozen pdf&#39;)</span>

<span class="sd">    Check accuracy of ``cdf`` and ``ppf``:</span>

<span class="sd">    &gt;&gt;&gt; vals = levy_l.ppf([0.001, 0.5, 0.999])</span>
<span class="sd">    &gt;&gt;&gt; np.allclose([0.001, 0.5, 0.999], levy_l.cdf(vals))</span>
<span class="sd">    True</span>

<span class="sd">    Generate random numbers:</span>

<span class="sd">    &gt;&gt;&gt; r = levy_l.rvs(size=1000)</span>

<span class="sd">    And compare the histogram:</span>

<span class="sd">    &gt;&gt;&gt; # manual binning to ignore the tail</span>
<span class="sd">    &gt;&gt;&gt; bins = np.concatenate(([np.min(r)], np.linspace(a, b, 20)))</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(r, bins=bins, density=True, histtype=&#39;stepfilled&#39;, alpha=0.2)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlim([x[0], x[-1]])</span>
<span class="sd">    &gt;&gt;&gt; ax.legend(loc=&#39;best&#39;, frameon=False)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># levy_l.pdf(x) = 1 / (abs(x) * sqrt(2*pi*abs(x))) * exp(-1/(2*abs(x)))</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ax</span><span class="p">)</span><span class="o">/</span><span class="n">ax</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">ax</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">ax</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">_norm_ppf</span><span class="p">((</span><span class="n">q</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">_norm_isf</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="n">levy_l</span> <span class="o">=</span> <span class="n">levy_l_gen</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;levy_l&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">logistic_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A logistic (or Sech-squared) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `logistic` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{\exp(-x)}</span>
<span class="sd">                    {(1+\exp(-x))^2}</span>

<span class="sd">    `logistic` is a special case of `genlogistic` with ``c=1``.</span>

<span class="sd">    Remark that the survival function (``logistic.sf``) is equal to the</span>
<span class="sd">    Fermi-Dirac distribution describing fermionic statistics.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">logistic</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># logistic.pdf(x) = exp(-x) / (1+exp(-x))**2</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">-</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log_expit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log_expit</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">logit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">6.0</span><span class="o">/</span><span class="mf">5.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># https://en.wikipedia.org/wiki/Logistic_distribution</span>
        <span class="k">return</span> <span class="mf">2.0</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># rv_continuous provided guesses</span>
        <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># these are trumped by user-provided guesses</span>
        <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="n">loc</span><span class="p">),</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

        <span class="c1"># the maximum likelihood estimators `a` and `b` of the location and</span>
        <span class="c1"># scale parameters are roots of the two equations described in `func`.</span>
        <span class="c1"># Source: Statistical Distributions, 3rd Edition. Evans, Hastings, and</span>
        <span class="c1"># Peacock (2000), Page 130</span>

        <span class="k">def</span> <span class="nf">dl_dloc</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">fscale</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">expit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="o">-</span> <span class="n">n</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">def</span> <span class="nf">dl_dscale</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">floc</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">n</span>

        <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
            <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">return</span> <span class="n">dl_dloc</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">),</span> <span class="n">dl_dscale</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">dl_dloc</span><span class="p">,</span> <span class="p">(</span><span class="n">loc</span><span class="p">,))</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>
        <span class="k">elif</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">dl_dscale</span><span class="p">,</span> <span class="p">(</span><span class="n">scale</span><span class="p">,))</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">))</span>
            <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>

        <span class="c1"># Note: gh-18176 reported data for which the reported MLE had</span>
        <span class="c1"># `scale &lt; 0`. To fix the bug, we return abs(scale). This is OK because</span>
        <span class="c1"># `dl_dscale` and `dl_dloc` are even and odd functions of `scale`,</span>
        <span class="c1"># respectively, so if `-scale` is a solution, so is `scale`.</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span> <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span>
                <span class="k">else</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">))</span>


<span class="n">logistic</span> <span class="o">=</span> <span class="n">logistic_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logistic&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">loggamma_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A log gamma continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `loggamma` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{\exp(c x - \exp(x))}</span>
<span class="sd">                       {\Gamma(c)}</span>

<span class="sd">    for all :math:`x, c &gt; 0`. Here, :math:`\Gamma` is the</span>
<span class="sd">    gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `loggamma` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># Use the property of the gamma distribution Gamma(c)</span>
        <span class="c1">#    Gamma(c) ~ Gamma(c + 1)*U**(1/c),</span>
        <span class="c1"># where U is uniform on [0, 1]. (See, e.g.,</span>
        <span class="c1"># G. Marsaglia and W.W. Tsang, &quot;A simple method for generating gamma</span>
        <span class="c1"># variables&quot;, https://doi.org/10.1145/358407.358414)</span>
        <span class="c1"># So</span>
        <span class="c1">#    log(Gamma(c)) ~ log(Gamma(c + 1)) + log(U)/c</span>
        <span class="c1"># Generating a sample with this formulation is a bit slower</span>
        <span class="c1"># than the more obvious log(Gamma(c)), but it avoids loss</span>
        <span class="c1"># of precision when c &lt;&lt; 1.</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
                <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># loggamma.pdf(x, c) = exp(c*x-exp(x)) / gamma(c)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># This function is gammainc(c, exp(x)), where gammainc(c, z) is</span>
        <span class="c1"># the regularized incomplete gamma function.</span>
        <span class="c1"># The first term in a series expansion of gamminc(c, z) is</span>
        <span class="c1"># z**c/Gamma(c+1); see 6.5.29 of Abramowitz &amp; Stegun (and refer</span>
        <span class="c1"># back to 6.5.1, 6.5.2 and 6.5.4 for the relevant notation).</span>
        <span class="c1"># This can also be found in the wikipedia article</span>
        <span class="c1"># https://en.wikipedia.org/wiki/Incomplete_gamma_function.</span>
        <span class="c1"># Here we use that formula when x is sufficiently negative that</span>
        <span class="c1"># exp(x) will result in subnormal numbers and lose precision.</span>
        <span class="c1"># We evaluate the log of the expression first to allow the possible</span>
        <span class="c1"># cancellation of the terms in the division, and then exponentiate.</span>
        <span class="c1"># That is,</span>
        <span class="c1">#     exp(x)**c/Gamma(c+1) = exp(log(exp(x)**c/Gamma(c+1)))</span>
        <span class="c1">#                          = exp(c*x - gammaln(c+1))</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">_LOGXMIN</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span>
                          <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># The expression used when g &lt; _XMIN inverts the one term expansion</span>
        <span class="c1"># given in the comments of _cdf().</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">g</span> <span class="o">&lt;</span> <span class="n">_XMIN</span><span class="p">,</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">g</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">,</span>
                          <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">g</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># See the comments for _cdf() for how x &lt; _LOGXMIN is handled.</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">_LOGXMIN</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span>
                          <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># The expression used when g &lt; _XMIN inverts the complement of</span>
        <span class="c1"># the one term expansion given in the comments of _cdf().</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">g</span> <span class="o">&lt;</span> <span class="n">_XMIN</span><span class="p">,</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">g</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="n">c</span><span class="p">,</span>
                          <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">g</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># See, for example, &quot;A Statistical Study of Log-Gamma Distribution&quot;, by</span>
        <span class="c1"># Ping Shing Chan (thesis, McMaster University, 1993).</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="n">skewness</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">excess_kurtosis</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">polygamma</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">var</span><span class="o">*</span><span class="n">var</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">skewness</span><span class="p">,</span> <span class="n">excess_kurtosis</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">regular</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span>
            <span class="k">return</span> <span class="n">h</span>

        <span class="k">def</span> <span class="nf">asymptotic</span><span class="p">(</span><span class="n">c</span><span class="p">):</span>
            <span class="c1"># using asymptotic expansions for gammaln and psi (see gh-18093)</span>
            <span class="n">term</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">c</span><span class="o">**-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">6</span> <span class="o">-</span> <span class="n">c</span><span class="o">**-</span><span class="mf">3.</span><span class="o">/</span><span class="mi">90</span> <span class="o">+</span> <span class="n">c</span><span class="o">**-</span><span class="mf">5.</span><span class="o">/</span><span class="mi">210</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">_entropy</span><span class="p">()</span> <span class="o">+</span> <span class="n">term</span>
            <span class="k">return</span> <span class="n">h</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">45</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">asymptotic</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">regular</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span>


<span class="n">loggamma</span> <span class="o">=</span> <span class="n">loggamma_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;loggamma&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">loglaplace_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A log-Laplace continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `loglaplace` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \begin{cases}\frac{c}{2} x^{ c-1}  &amp;\text{for } 0 &lt; x &lt; 1\\</span>
<span class="sd">                               \frac{c}{2} x^{-c-1}  &amp;\text{for } x \ge 1</span>
<span class="sd">                  \end{cases}</span>

<span class="sd">    for :math:`c &gt; 0`.</span>

<span class="sd">    `loglaplace` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    Suppose a random variable ``X`` follows the Laplace distribution with</span>
<span class="sd">    location ``a`` and scale ``b``.  Then ``Y = exp(X)`` follows the</span>
<span class="sd">    log-Laplace distribution with ``c = 1 / b`` and ``scale = exp(a)``.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    T.J. Kozubowski and K. Podgorski, &quot;A log-Laplace growth rate model&quot;,</span>
<span class="sd">    The Mathematical Scientist, vol. 28, pp. 49-60, 2003.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># loglaplace.pdf(x, c) = c / 2 * x**(c-1),   for 0 &lt; x &lt; 1</span>
        <span class="c1">#                      = c / 2 * x**(-c-1),  for x &gt;= 1</span>
        <span class="n">cd2</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cd2</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="n">c</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">c2</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">n2</span> <span class="o">&lt;</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c2</span> <span class="o">/</span> <span class="p">(</span><span class="n">c2</span> <span class="o">-</span> <span class="n">n2</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">fc</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                             <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># Specialize MLE only when location is known.</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># Raise an error if any observation has zero likelihood.</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">&lt;=</span> <span class="n">floc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;loglaplace&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">floc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="c1"># Remove location from data.</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">floc</span>

        <span class="c1"># When location is zero, the log-Laplace distribution is related to</span>
        <span class="c1"># the Laplace distribution in that if X ~ Laplace(loc=a, scale=b),</span>
        <span class="c1"># then Y = exp(X) ~ LogLaplace(c=1/b, loc=0, scale=exp(a)).  It can</span>
        <span class="c1"># be shown that the MLE for Y is the same as the MLE for X = ln(Y).</span>
        <span class="c1"># Therefore, we reuse the formulas from laplace.fit() and transform</span>
        <span class="c1"># the result back into log-laplace&#39;s parameter space.</span>
        <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">laplace</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                           <span class="n">floc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fscale</span><span class="p">)</span> <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">fscale</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">fc</span> <span class="k">if</span> <span class="n">fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mle&#39;</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">fscale</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">b</span> <span class="k">if</span> <span class="n">fc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">fc</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

<span class="n">loglaplace</span> <span class="o">=</span> <span class="n">loglaplace_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;loglaplace&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_lognorm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span>
                      <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                    <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))),</span>
                      <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">lognorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A lognormal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `lognorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, s) = \frac{1}{s x \sqrt{2\pi}}</span>
<span class="sd">                  \exp\left(-\frac{\log^2(x)}{2s^2}\right)</span>

<span class="sd">    for :math:`x &gt; 0`, :math:`s &gt; 0`.</span>

<span class="sd">    `lognorm` takes ``s`` as a shape parameter for :math:`s`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    Suppose a normally distributed random variable ``X`` has  mean ``mu`` and</span>
<span class="sd">    standard deviation ``sigma``. Then ``Y = exp(X)`` is lognormally</span>
<span class="sd">    distributed with ``s = sigma`` and ``scale = exp(mu)``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    The logarithm of a log-normally distributed random variable is</span>
<span class="sd">    normally distributed:</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; from scipy import stats</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>
<span class="sd">    &gt;&gt;&gt; mu, sigma = 2, 0.5</span>
<span class="sd">    &gt;&gt;&gt; X = stats.norm(loc=mu, scale=sigma)</span>
<span class="sd">    &gt;&gt;&gt; Y = stats.lognorm(s=sigma, scale=np.exp(mu))</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(*X.interval(0.999))</span>
<span class="sd">    &gt;&gt;&gt; y = Y.rvs(size=10000)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, X.pdf(x), label=&#39;X (pdf)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(np.log(y), density=True, bins=x, label=&#39;log(Y) (histogram)&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend()</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># lognorm.pdf(x, s) = 1 / (s*x*sqrt(2*pi)) * exp(-1/2*(log(x)/s)**2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lognorm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logsf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span> <span class="o">*</span> <span class="n">_norm_isf</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">s</span><span class="o">*</span><span class="n">s</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        When `method=&#39;MLE&#39;` and</span>
<span class="s2">        the location parameter is fixed by using the `floc` argument,</span>
<span class="s2">        this function uses explicit formulas for the maximum likelihood</span>
<span class="s2">        estimation of the log-normal shape and scale parameters, so the</span>
<span class="s2">        `optimizer`, `loc` and `scale` keyword arguments are ignored.</span>
<span class="s2">        If the location is free, a likelihood maximum is found by</span>
<span class="s2">        setting its partial derivative wrt to location to 0, and</span>
<span class="s2">        solving by substituting the analytical expressions of shape</span>
<span class="s2">        and scale (or provided parameters).</span>
<span class="s2">        See, e.g., equation 3.1 in</span>
<span class="s2">        A. Clifford Cohen &amp; Betty Jones Whitten (1980)</span>
<span class="s2">        Estimation in the Three-Parameter Lognormal Distribution,</span>
<span class="s2">        Journal of the American Statistical Association, 75:370, 399-404</span>
<span class="s2">        https://doi.org/10.2307/2287466</span>
<span class="s2">        </span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_shape_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="c1"># Calculate maximum likelihood scale and shape with analytical</span>
            <span class="c1"># formulas unless provided by the user</span>
            <span class="k">if</span> <span class="n">fshape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">lndata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">lndata</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">lndata</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span>

        <span class="k">def</span> <span class="nf">dL_dLoc</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="c1"># Derivative of (positive) LL w.r.t. loc</span>
            <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">get_shape_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="n">shifted</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">loc</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">shifted</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span><span class="o">/</span><span class="n">shape</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">shifted</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">ll</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="c1"># (Positive) log-likelihood</span>
            <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">get_shape_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">nnlf</span><span class="p">((</span><span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The location must be less than the minimum of the data.</span>
            <span class="c1"># Back off a bit to avoid numerical issues.</span>
            <span class="n">spacing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">spacing</span><span class="p">(</span><span class="n">data_min</span><span class="p">)</span>
            <span class="n">rbrack</span> <span class="o">=</span> <span class="n">data_min</span> <span class="o">-</span> <span class="n">spacing</span>

            <span class="c1"># Find the right end of the bracket by successive doubling of the</span>
            <span class="c1"># distance to data_min. We&#39;re interested in a maximum LL, so the</span>
            <span class="c1"># slope dL_dLoc_rbrack should be negative at the right end.</span>
            <span class="c1"># optimization for later: share shape, scale</span>
            <span class="n">dL_dLoc_rbrack</span> <span class="o">=</span> <span class="n">dL_dLoc</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)</span>
            <span class="n">ll_rbrack</span> <span class="o">=</span> <span class="n">ll</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">spacing</span>  <span class="c1"># 2 * (data_min - rbrack)</span>
            <span class="k">while</span> <span class="n">dL_dLoc_rbrack</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mf">1e-6</span><span class="p">:</span>
                <span class="n">rbrack</span> <span class="o">=</span> <span class="n">data_min</span> <span class="o">-</span> <span class="n">delta</span>
                <span class="n">dL_dLoc_rbrack</span> <span class="o">=</span> <span class="n">dL_dLoc</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">*=</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dL_dLoc_rbrack</span><span class="p">):</span>
                <span class="c1"># If we never find a negative slope, either we missed it or the</span>
                <span class="c1"># slope is always positive. It&#39;s usually the latter,</span>
                <span class="c1"># which means</span>
                <span class="c1"># loc = data_min - spacing</span>
                <span class="c1"># But sometimes when shape and/or scale are fixed there are</span>
                <span class="c1"># other issues, so be cautious.</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

            <span class="c1"># Now find the left end of the bracket. Guess is `rbrack-1`</span>
            <span class="c1"># unless that is too small of a difference to resolve. Double</span>
            <span class="c1"># the size of the interval until the left end is found.</span>
            <span class="n">lbrack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">rbrack</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="n">rbrack</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dL_dLoc_lbrack</span> <span class="o">=</span> <span class="n">dL_dLoc</span><span class="p">(</span><span class="n">lbrack</span><span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">rbrack</span> <span class="o">-</span> <span class="n">lbrack</span><span class="p">)</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lbrack</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dL_dLoc_lbrack</span><span class="p">)</span>
                   <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dL_dLoc_lbrack</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">dL_dLoc_rbrack</span><span class="p">)):</span>
                <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="n">delta</span>
                <span class="n">dL_dLoc_lbrack</span> <span class="o">=</span> <span class="n">dL_dLoc</span><span class="p">(</span><span class="n">lbrack</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">*=</span> <span class="mi">2</span>

            <span class="c1"># I don&#39;t recall observing this, but just in case...</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lbrack</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">dL_dLoc_lbrack</span><span class="p">):</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

            <span class="c1"># If we have a valid bracket, find the root</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">dL_dLoc</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

            <span class="c1"># If the slope was positive near the minimum of the data,</span>
            <span class="c1"># the maximum LL could be there instead of at the root. Compare</span>
            <span class="c1"># the LL of the two points to decide.</span>
            <span class="n">ll_root</span> <span class="o">=</span> <span class="n">ll</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span> <span class="k">if</span> <span class="n">ll_root</span> <span class="o">&gt;</span> <span class="n">ll_rbrack</span> <span class="k">else</span> <span class="n">data_min</span><span class="o">-</span><span class="n">spacing</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">floc</span> <span class="o">&gt;=</span> <span class="n">data_min</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;lognorm&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>

        <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">get_shape_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_argcheck</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="ow">and</span> <span class="n">scale</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">lognorm</span> <span class="o">=</span> <span class="n">lognorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;lognorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gibrat_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gibrat continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gibrat` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{x \sqrt{2\pi}} \exp(-\frac{1}{2} (\log(x))^2)</span>

<span class="sd">    `gibrat` is a special case of `lognorm` with ``s=1``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># gibrat.pdf(x) = 1/(x*sqrt(2*pi)) * exp(-1/2*(log(x))**2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lognorm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_norm_isf</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.0</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span>


<span class="n">gibrat</span> <span class="o">=</span> <span class="n">gibrat_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;gibrat&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">maxwell_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Maxwell continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A special case of a `chi` distribution,  with ``df=3``, ``loc=0.0``,</span>
<span class="sd">    and given ``scale = a``, where ``a`` is the parameter used in the</span>
<span class="sd">    Mathworld description [1]_.</span>

<span class="sd">    The probability density function for `maxwell` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \sqrt{2/\pi}x^2 \exp(-x^2/2)</span>

<span class="sd">    for :math:`x &gt;= 0`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] http://mathworld.wolfram.com/MaxwellDistribution.html</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">chi</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># maxwell.pdf(x) = sqrt(2/pi)x**2 * exp(-x**2/2)</span>
        <span class="k">return</span> <span class="n">_SQRT_2_OVER_PI</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># Allow x=0 without &#39;divide by zero&#39; warnings</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">_LOG_SQRT_2_OVER_PI</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">8</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span>
                <span class="mi">3</span><span class="o">-</span><span class="mi">8</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="p">(</span><span class="o">-</span><span class="mi">12</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">+</span> <span class="mi">160</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mi">384</span><span class="p">)</span> <span class="o">/</span> <span class="n">val</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span>


<span class="n">maxwell</span> <span class="o">=</span> <span class="n">maxwell_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;maxwell&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">mielke_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Mielke Beta-Kappa / Dagum continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `mielke` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k, s) = \frac{k x^{k-1}}{(1+x^s)^{1+k/s}}</span>

<span class="sd">    for :math:`x &gt; 0` and :math:`k, s &gt; 0`. The distribution is sometimes</span>
<span class="sd">    called Dagum distribution ([2]_). It was already defined in [3]_, called</span>
<span class="sd">    a Burr Type III distribution (`burr` with parameters ``c=s`` and</span>
<span class="sd">    ``d=k/s``).</span>

<span class="sd">    `mielke` takes ``k`` and ``s`` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Mielke, P.W., 1973 &quot;Another Family of Distributions for Describing</span>
<span class="sd">           and Analyzing Precipitation Data.&quot; J. Appl. Meteor., 12, 275-280</span>
<span class="sd">    .. [2] Dagum, C., 1977 &quot;A new model for personal income distribution.&quot;</span>
<span class="sd">           Economie Appliquee, 33, 327-367.</span>
<span class="sd">    .. [3] Burr, I. W. &quot;Cumulative frequency functions&quot;, Annals of</span>
<span class="sd">           Mathematical Statistics, 13(2), pp 215-232 (1942).</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ik</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">i_s</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">i_s</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="c1"># Allow x=0 without &#39;divide by zero&#39; warnings.</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">k</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="n">qsk</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">s</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">qsk</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">qsk</span><span class="p">),</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">nth_moment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
            <span class="c1"># n-th moment is defined for -k &lt; n &lt; s</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">((</span><span class="n">k</span><span class="o">+</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">n</span><span class="o">/</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">s</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">nth_moment</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="n">mielke</span> <span class="o">=</span> <span class="n">mielke_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mielke&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kappa4_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kappa 4 parameter distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for kappa4 is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, h, k) = (1 - k x)^{1/k - 1} (1 - h (1 - k x)^{1/k})^{1/h-1}</span>

<span class="sd">    if :math:`h` and :math:`k` are not equal to 0.</span>

<span class="sd">    If :math:`h` or :math:`k` are zero then the pdf can be simplified:</span>

<span class="sd">    h = 0 and k != 0::</span>

<span class="sd">        kappa4.pdf(x, h, k) = (1.0 - k*x)**(1.0/k - 1.0)*</span>
<span class="sd">                              exp(-(1.0 - k*x)**(1.0/k))</span>

<span class="sd">    h != 0 and k = 0::</span>

<span class="sd">        kappa4.pdf(x, h, k) = exp(-x)*(1.0 - h*exp(-x))**(1.0/h - 1.0)</span>

<span class="sd">    h = 0 and k = 0::</span>

<span class="sd">        kappa4.pdf(x, h, k) = exp(-x)*exp(-exp(-x))</span>

<span class="sd">    kappa4 takes :math:`h` and :math:`k` as shape parameters.</span>

<span class="sd">    The kappa4 distribution returns other distributions when certain</span>
<span class="sd">    :math:`h` and :math:`k` values are used.</span>

<span class="sd">    +------+-------------+----------------+------------------+</span>
<span class="sd">    | h    | k=0.0       | k=1.0          | -inf&lt;=k&lt;=inf     |</span>
<span class="sd">    +======+=============+================+==================+</span>
<span class="sd">    | -1.0 | Logistic    |                | Generalized      |</span>
<span class="sd">    |      |             |                | Logistic(1)      |</span>
<span class="sd">    |      |             |                |                  |</span>
<span class="sd">    |      | logistic(x) |                |                  |</span>
<span class="sd">    +------+-------------+----------------+------------------+</span>
<span class="sd">    |  0.0 | Gumbel      | Reverse        | Generalized      |</span>
<span class="sd">    |      |             | Exponential(2) | Extreme Value    |</span>
<span class="sd">    |      |             |                |                  |</span>
<span class="sd">    |      | gumbel_r(x) |                | genextreme(x, k) |</span>
<span class="sd">    +------+-------------+----------------+------------------+</span>
<span class="sd">    |  1.0 | Exponential | Uniform        | Generalized      |</span>
<span class="sd">    |      |             |                | Pareto           |</span>
<span class="sd">    |      |             |                |                  |</span>
<span class="sd">    |      | expon(x)    | uniform(x)     | genpareto(x, -k) |</span>
<span class="sd">    +------+-------------+----------------+------------------+</span>

<span class="sd">    (1) There are at least five generalized logistic distributions.</span>
<span class="sd">        Four are described here:</span>
<span class="sd">        https://en.wikipedia.org/wiki/Generalized_logistic_distribution</span>
<span class="sd">        The &quot;fifth&quot; one is the one kappa4 should match which currently</span>
<span class="sd">        isn&#39;t implemented in scipy:</span>
<span class="sd">        https://en.wikipedia.org/wiki/Talk:Generalized_logistic_distribution</span>
<span class="sd">        https://www.mathwave.com/help/easyfit/html/analyses/distributions/gen_logistic.html</span>
<span class="sd">    (2) This distribution is currently not in scipy.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    J.C. Finney, &quot;Optimization of a Skewed Logistic Distribution With Respect</span>
<span class="sd">    to the Kolmogorov-Smirnov Test&quot;, A Dissertation Submitted to the Graduate</span>
<span class="sd">    Faculty of the Louisiana State University and Agricultural and Mechanical</span>
<span class="sd">    College, (August, 2004),</span>
<span class="sd">    https://digitalcommons.lsu.edu/gradschool_dissertations/3672</span>

<span class="sd">    J.R.M. Hosking, &quot;The four-parameter kappa distribution&quot;. IBM J. Res.</span>
<span class="sd">    Develop. 38 (3), 25 1-258 (1994).</span>

<span class="sd">    B. Kumphon, A. Kaew-Man, P. Seenoi, &quot;A Rainfall Distribution for the Lampao</span>
<span class="sd">    Site in the Chi River Basin, Thailand&quot;, Journal of Water Resource and</span>
<span class="sd">    Protection, vol. 4, 866-869, (2012).</span>
<span class="sd">    :doi:`10.4236/jwarp.2012.410101`</span>

<span class="sd">    C. Winchester, &quot;On Estimation of the Four-Parameter Kappa Distribution&quot;, A</span>
<span class="sd">    Thesis Submitted to Dalhousie University, Halifax, Nova Scotia, (March</span>
<span class="sd">    2000).</span>
<span class="sd">    http://www.nlc-bnc.ca/obj/s4/f2/dsk2/ftp01/MQ57336.pdf</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ih</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ik</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ih</span><span class="p">,</span> <span class="n">ik</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">float_power</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="p">))</span><span class="o">/</span><span class="n">k</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
            <span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="n">a</span>

        <span class="k">def</span> <span class="nf">f5</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span>

        <span class="n">_a</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                         <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f5</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                         <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
            <span class="n">a</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="k">return</span> <span class="n">a</span>

        <span class="n">_b</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                         <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f1</span><span class="p">],</span>
                         <span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                         <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="c1"># kappa4.pdf(x, h, k) = (1.0 - k*x)**(1.0/k - 1.0)*</span>
        <span class="c1">#                       (1.0 - h*(1.0 - k*x)**(1.0/k))**(1.0/h-1)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;pdf = (1.0 - k*x)**(1.0/k - 1.0)*(</span>
<span class="sd">                      1.0 - h*(1.0 - k*x)**(1.0/k))**(1.0/h-1.0)</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;pdf = (1.0 - k*x)**(1.0/k - 1.0)*np.exp(-(</span>
<span class="sd">                      1.0 - k*x)**(1.0/k))</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;pdf = np.exp(-x)*(1.0 - h*np.exp(-x))**(1.0/h - 1.0)</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;pdf = np.exp(-x-np.exp(-x))</span>
<span class="sd">               logpdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;cdf = (1.0 - h*(1.0 - k*x)**(1.0/k))**(1.0/h)</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;cdf = np.exp(-(1.0 - k*x)**(1.0/k))</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;cdf = (1.0 - h*np.exp(-x))**(1.0/h)</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;cdf = np.exp(-np.exp(-x))</span>
<span class="sd">               logcdf = ...</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="n">h</span><span class="p">))</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;ppf = -np.log((1.0 - (q**h))/h)</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="n">h</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f3</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">],</span>
                           <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span>
                           <span class="n">default</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_stats_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">h</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span>
            <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">f0</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span> <span class="p">[</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">],</span> <span class="p">[</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">maxr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stats_info</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">maxr</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">outputs</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">_mom1_sc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">maxr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_stats_info</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">&gt;=</span> <span class="n">maxr</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mom_integ1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,)</span><span class="o">+</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">kappa4</span> <span class="o">=</span> <span class="n">kappa4_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;kappa4&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">kappa3_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Kappa 3 parameter distribution.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `kappa3` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = a (a + x^a)^{-(a + 1)/a}</span>

<span class="sd">    for :math:`x &gt; 0` and :math:`a &gt; 0`.</span>

<span class="sd">    `kappa3` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    P.W. Mielke and E.S. Johnson, &quot;Three-Parameter Kappa Distribution Maximum</span>
<span class="sd">    Likelihood and Likelihood Ratio Tests&quot;, Methods in Weather Research,</span>
<span class="sd">    701-707, (September, 1973),</span>
<span class="sd">    :doi:`10.1175/1520-0493(1973)101&lt;0701:TKDMLE&gt;2.3.CO;2`</span>

<span class="sd">    B. Kumphon, &quot;Maximum Entropy and Maximum Likelihood Estimation for the</span>
<span class="sd">    Three-Parameter Kappa Distribution&quot;, Open Journal of Statistics, vol 2,</span>
<span class="sd">    415-419 (2012), :doi:`10.4236/ojs.2012.24050`</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># kappa3.pdf(x, a) = a*(a + x**a)**(-(a + 1)/a),     for x &gt; 0</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>  <span class="c1"># some code paths pass scalars</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

        <span class="c1"># When the SF is small, another formulation is typically more accurate.</span>
        <span class="c1"># However, it blows up for large `a`, so use it only if it also returns</span>
        <span class="c1"># a small value of the SF.</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">sf</span> <span class="o">&lt;</span> <span class="n">cutoff</span>
        <span class="n">sf2</span> <span class="o">=</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">**-</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="n">sf2</span> <span class="o">&gt;</span> <span class="n">cutoff</span>
        <span class="n">sf2</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span>  <span class="c1"># replace bad values with original values</span>

        <span class="n">sf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf2</span>
        <span class="k">return</span> <span class="n">sf</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">q</span><span class="o">**-</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">lg</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlog1py</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">q</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="n">lg</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">outputs</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">_mom1_sc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mom_integ1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">m</span><span class="p">,)</span><span class="o">+</span><span class="n">args</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">kappa3</span> <span class="o">=</span> <span class="n">kappa3_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;kappa3&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">moyal_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Moyal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `moyal` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \exp(-(x + \exp(-x))/2) / \sqrt{2\pi}</span>

<span class="sd">    for a real number :math:`x`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    This distribution has utility in high-energy physics and radiation</span>
<span class="sd">    detection. It describes the energy loss of a charged relativistic</span>
<span class="sd">    particle due to ionization of the medium [1]_. It also provides an</span>
<span class="sd">    approximation for the Landau distribution. For an in depth description</span>
<span class="sd">    see [2]_. For additional description, see [3]_.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] J.E. Moyal, &quot;XXX. Theory of ionization fluctuations&quot;,</span>
<span class="sd">           The London, Edinburgh, and Dublin Philosophical Magazine</span>
<span class="sd">           and Journal of Science, vol 46, 263-280, (1955).</span>
<span class="sd">           :doi:`10.1080/14786440308521076` (gated)</span>
<span class="sd">    .. [2] G. Cordeiro et al., &quot;The beta Moyal: a useful skew distribution&quot;,</span>
<span class="sd">           International Journal of Research and Reviews in Applied Sciences,</span>
<span class="sd">           vol 10, 171-192, (2012).</span>
<span class="sd">           http://www.arpapress.com/Volumes/Vol10Issue2/IJRRAS_10_2_02.pdf</span>
<span class="sd">    .. [3] C. Walck, &quot;Handbook on Statistical Distributions for</span>
<span class="sd">           Experimentalists; International Report SUF-PFY/96-01&quot;, Chapter 26,</span>
<span class="sd">           University of Stockholm: Stockholm, Sweden, (2007).</span>
<span class="sd">           http://www.stat.rice.edu/~dobelman/textfiles/DistributionsHandbook.pdf</span>

<span class="sd">    .. versionadded:: 1.1.0</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                       <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erfc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">erf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">erfcinv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="mi">28</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">3</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="mf">4.</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">:</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>
            <span class="n">tmp3</span> <span class="o">=</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="n">tmp3</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">14</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">zeta</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">tmp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">euler_gamma</span><span class="p">)</span><span class="o">**</span><span class="mi">4</span>
            <span class="n">tmp4</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span>
            <span class="k">return</span> <span class="n">tmp1</span> <span class="o">+</span> <span class="n">tmp2</span> <span class="o">+</span> <span class="n">tmp3</span> <span class="o">+</span> <span class="n">tmp4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return generic for higher moments</span>
            <span class="c1"># return rv_continuous._mom1_sc(self, n, b)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mom1_sc</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


<span class="n">moyal</span> <span class="o">=</span> <span class="n">moyal_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;moyal&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">nakagami_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Nakagami continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `nakagami` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \nu) = \frac{2 \nu^\nu}{\Gamma(\nu)} x^{2\nu-1} \exp(-\nu x^2)</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`\nu &gt; 0`. The distribution was introduced in</span>
<span class="sd">    [2]_, see also [1]_ for further information.</span>

<span class="sd">    `nakagami` takes ``nu`` as a shape parameter for :math:`\nu`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Nakagami distribution&quot;, Wikipedia</span>
<span class="sd">           https://en.wikipedia.org/wiki/Nakagami_distribution</span>
<span class="sd">    .. [2] M. Nakagami, &quot;The m-distribution - A general formula of intensity</span>
<span class="sd">           distribution of rapid fading&quot;, Statistical methods in radio wave</span>
<span class="sd">           propagation, Pergamon Press, 1960, 3-36.</span>
<span class="sd">           :doi:`10.1016/B978-0-08-009306-2.50005-4`</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="c1"># nakagami.pdf(x, nu) = 2 * nu**nu / gamma(nu) *</span>
        <span class="c1">#                       x**(2*nu-1) * exp(-nu*x**2)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">nu</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">nu</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">nu</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">nu</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">nu</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">poch</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">mu</span><span class="o">*</span><span class="n">mu</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">nu</span><span class="o">*</span><span class="n">mu2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">nu</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">nu</span> <span class="o">+</span> <span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="n">nu</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">nu</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">g2</span> <span class="o">/=</span> <span class="n">nu</span><span class="o">*</span><span class="n">mu2</span><span class="o">**</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nu</span><span class="p">):</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="c1"># because somehow this isn&#39;t taken care of by the infrastructure...</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">-</span> <span class="p">(</span><span class="n">nu</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nu</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span> <span class="o">+</span> <span class="n">C</span>
        <span class="c1"># This is the asymptotic sum of A and B (see gh-17868)</span>
        <span class="n">norm_entropy</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">_entropy</span><span class="p">()</span>
        <span class="c1"># Above, this is lost to rounding error for large nu, so use the</span>
        <span class="c1"># asymptotic sum when the approximation becomes accurate</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">&gt;</span> <span class="mf">5e4</span>  <span class="c1"># roundoff error ~ approximation error</span>
        <span class="c1"># -1 / (12 * nu) is the O(1/nu) term; see gh-17929</span>
        <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">norm_entropy</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">12</span><span class="o">*</span><span class="n">nu</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">h</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)[()]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># this relationship can be found in [1] or by a direct calculation</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="o">/</span> <span class="n">nu</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">numargs</span>
        <span class="c1"># Analytical justified estimates</span>
        <span class="c1"># see: https://docs.scipy.org/doc/scipy/reference/tutorial/stats/continuous_nakagami.html</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">args</span> <span class="o">+</span> <span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>


<span class="n">nakagami</span> <span class="o">=</span> <span class="n">nakagami_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;nakagami&quot;</span><span class="p">)</span>


<span class="c1"># The function name ncx2 is an abbreviation for noncentral chi squared.</span>
<span class="k">def</span> <span class="nf">_ncx2_log_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
    <span class="c1"># We use (xs**2 + ns**2)/2 = (xs - ns)**2/2  + xs*ns, and include the</span>
    <span class="c1"># factor of exp(-xs*ns) into the ive function to improve numerical</span>
    <span class="c1"># stability at large values of xs. See also `rice.pdf`.</span>
    <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">-</span> <span class="mf">1.0</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">ns</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nc</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">df2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">x</span><span class="o">/</span><span class="n">nc</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xs</span> <span class="o">-</span> <span class="n">ns</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">corr</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">xs</span><span class="o">*</span><span class="n">ns</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="c1"># Return res + np.log(corr) avoiding np.log(0)</span>
    <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
        <span class="n">corr</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
        <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">corr</span><span class="p">),</span>
        <span class="n">f</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">r</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>
        <span class="n">fillvalue</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ncx2_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A non-central chi-squared continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `ncx2` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, k, \lambda) = \frac{1}{2} \exp(-(\lambda+x)/2)</span>
<span class="sd">            (x/\lambda)^{(k-2)/4}  I_{(k-2)/2}(\sqrt{\lambda x})</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`k &gt; 0` and :math:`\lambda \ge 0`.</span>
<span class="sd">    :math:`k` specifies the degrees of freedom (denoted ``df`` in the</span>
<span class="sd">    implementation) and :math:`\lambda` is the non-centrality parameter</span>
<span class="sd">    (denoted ``nc`` in the implementation). :math:`I_\nu` denotes the</span>
<span class="sd">    modified Bessel function of first order of degree :math:`\nu`</span>
<span class="sd">    (`scipy.special.iv`).</span>

<span class="sd">    `ncx2` takes ``df`` and ``nc`` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idf</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;nc&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idf</span><span class="p">,</span> <span class="n">inc</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">noncentral_chisquare</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_ncx2_log_pdf</span><span class="p">,</span>
                          <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_pdf</span><span class="p">,</span>
                              <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_cdf</span><span class="p">,</span>
                              <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_ppf</span><span class="p">,</span>
                              <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_sf</span><span class="p">,</span>
                              <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">cond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">cond</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_isf</span><span class="p">,</span>
                              <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">chi2</span><span class="o">.</span><span class="n">_isf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_mean</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_variance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_skewness</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span>
            <span class="n">_boost</span><span class="o">.</span><span class="n">_ncx2_kurtosis_excess</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span>
        <span class="p">)</span>


<span class="n">ncx2</span> <span class="o">=</span> <span class="n">ncx2_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ncx2&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ncf_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A non-central F distribution continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    scipy.stats.f : Fisher distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `ncf` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, n_1, n_2, \lambda) =</span>
<span class="sd">            \exp\left(\frac{\lambda}{2} +</span>
<span class="sd">                      \lambda n_1 \frac{x}{2(n_1 x + n_2)}</span>
<span class="sd">                \right)</span>
<span class="sd">            n_1^{n_1/2} n_2^{n_2/2} x^{n_1/2 - 1} \\</span>
<span class="sd">            (n_2 + n_1 x)^{-(n_1 + n_2)/2}</span>
<span class="sd">            \gamma(n_1/2) \gamma(1 + n_2/2) \\</span>
<span class="sd">            \frac{L^{\frac{n_1}{2}-1}_{n_2/2}</span>
<span class="sd">                \left(-\lambda n_1 \frac{x}{2(n_1 x + n_2)}\right)}</span>
<span class="sd">            {B(n_1/2, n_2/2)</span>
<span class="sd">                \gamma\left(\frac{n_1 + n_2}{2}\right)}</span>

<span class="sd">    for :math:`n_1, n_2 &gt; 0`, :math:`\lambda \ge 0`.  Here :math:`n_1` is the</span>
<span class="sd">    degrees of freedom in the numerator, :math:`n_2` the degrees of freedom in</span>
<span class="sd">    the denominator, :math:`\lambda` the non-centrality parameter,</span>
<span class="sd">    :math:`\gamma` is the logarithm of the Gamma function, :math:`L_n^k` is a</span>
<span class="sd">    generalized Laguerre polynomial and :math:`B` is the beta function.</span>

<span class="sd">    `ncf` takes ``df1``, ``df2`` and ``nc`` as shape parameters. If ``nc=0``,</span>
<span class="sd">    the distribution becomes equivalent to the Fisher distribution.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idf1</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df1&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">idf2</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df2&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;nc&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idf1</span><span class="p">,</span> <span class="n">idf2</span><span class="p">,</span> <span class="n">inc</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">noncentral_f</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="c1"># ncf.pdf(x, df1, df2, nc) = exp(nc/2 + nc*df1*x/(2*(df1*x+df2))) *</span>
        <span class="c1">#             df1**(df1/2) * df2**(df2/2) * x**(df1/2-1) *</span>
        <span class="c1">#             (df2+df1*x)**(-(df1+df2)/2) *</span>
        <span class="c1">#             gamma(df1/2)*gamma(1+df2/2) *</span>
        <span class="c1">#             L^{v1/2-1}^{v2/2}(-nc*v1*x/(2*(v1*x+v2))) /</span>
        <span class="c1">#             (B(v1/2, v2/2) * gamma((v1+v2)/2))</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_isf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">dfn</span> <span class="o">*</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">dfd</span><span class="p">)</span><span class="o">**</span><span class="n">n</span>
        <span class="n">term</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dfn</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dfd</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">dfd</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">nc</span> <span class="o">/</span> <span class="mf">2.0</span><span class="o">+</span><span class="n">term</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">*=</span> <span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dfn</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dfn</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">nc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_mean</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_variance</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_skewness</span><span class="p">(</span><span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_ncf_kurtosis_excess</span><span class="p">(</span>
            <span class="n">dfn</span><span class="p">,</span> <span class="n">dfd</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">ncf</span> <span class="o">=</span> <span class="n">ncf_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ncf&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">t_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Student&#39;s t continuous random variable.</span>

<span class="sd">    For the noncentral t distribution, see `nct`.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    nct</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `t` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \nu) = \frac{\Gamma((\nu+1)/2)}</span>
<span class="sd">                        {\sqrt{\pi \nu} \Gamma(\nu/2)}</span>
<span class="sd">                    (1+x^2/\nu)^{-(\nu+1)/2}</span>

<span class="sd">    where :math:`x` is a real number and the degrees of freedom parameter</span>
<span class="sd">    :math:`\nu` (denoted ``df`` in the implementation) satisfies</span>
<span class="sd">    :math:`\nu &gt; 0`. :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">df</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">),</span>
            <span class="n">f</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="n">norm</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">:</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">))</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">t_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">poch</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">df</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
                    <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
                    <span class="o">-</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="o">/</span><span class="n">df</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">norm</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">df</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">norm_logpdf</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">t_logpdf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">stdtr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">stdtr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">stdtrit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">stdtrit</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="c1"># infinite df -&gt; normal distribution (0.0, 1.0, 0.0, 0.0)</span>
        <span class="n">infinite_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isposinf</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">condlist</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
                    <span class="n">infinite_df</span><span class="p">)</span>
        <span class="n">choicelist</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                      <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">2.0</span><span class="p">),</span>
                      <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span> <span class="n">choicelist</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="n">condlist</span> <span class="o">=</span> <span class="p">((</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">),</span>
                    <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
                    <span class="n">infinite_df</span><span class="p">)</span>
        <span class="n">choicelist</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
                      <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mf">6.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="o">-</span><span class="mf">4.0</span><span class="p">),</span>
                      <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span> <span class="n">choicelist</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">df</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">norm</span><span class="o">.</span><span class="n">_entropy</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">regular</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="n">half</span> <span class="o">=</span> <span class="n">df</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">half1</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">half1</span><span class="o">*</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">half1</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">digamma</span><span class="p">(</span><span class="n">half</span><span class="p">))</span>
                    <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">half</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">asymptotic</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="c1"># Formula from Wolfram Alpha:</span>
            <span class="c1"># &quot;asymptotic expansion (d+1)/2 * (digamma((d+1)/2) - digamma(d/2))</span>
            <span class="c1">#  + log(sqrt(d) * beta(d/2, 1/2))&quot;</span>
            <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">norm</span><span class="o">.</span><span class="n">_entropy</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">df</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mf">3.</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span>
                 <span class="o">-</span> <span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mf">4.</span><span class="p">)</span><span class="o">/</span><span class="mi">8</span> <span class="o">+</span> <span class="mi">3</span><span class="o">/</span><span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mf">5.</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">df</span><span class="o">**-</span><span class="mf">6.</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">h</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">df</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">asymptotic</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">regular</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">h</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">t_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">nct_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A non-central Student&#39;s t continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    If :math:`Y` is a standard normal random variable and :math:`V` is</span>
<span class="sd">    an independent chi-square random variable (`chi2`) with :math:`k` degrees</span>
<span class="sd">    of freedom, then</span>

<span class="sd">    .. math::</span>

<span class="sd">        X = \frac{Y + c}{\sqrt{V/k}}</span>

<span class="sd">    has a non-central Student&#39;s t distribution on the real line.</span>
<span class="sd">    The degrees of freedom parameter :math:`k` (denoted ``df`` in the</span>
<span class="sd">    implementation) satisfies :math:`k &gt; 0` and the noncentrality parameter</span>
<span class="sd">    :math:`c` (denoted ``nc`` in the implementation) is a real number.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">nc</span> <span class="o">==</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">idf</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;nc&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">idf</span><span class="p">,</span> <span class="n">inc</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">nc</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="c1"># Boost version has accuracy issues in left tail; see gh-16591</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">df</span><span class="o">*</span><span class="mf">1.0</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">nc</span><span class="o">*</span><span class="mf">1.0</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
        <span class="n">ncx2</span> <span class="o">=</span> <span class="n">nc</span><span class="o">*</span><span class="n">nc</span><span class="o">*</span><span class="n">x2</span>
        <span class="n">fac1</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="n">x2</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="o">-</span> <span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">nc</span><span class="o">*</span><span class="n">nc</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">fac1</span><span class="p">)</span>
                   <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">trm1</span><span class="p">)</span>
        <span class="n">valF</span> <span class="o">=</span> <span class="n">ncx2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">fac1</span><span class="p">)</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">nc</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">valF</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">fac1</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">trm2</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">valF</span><span class="p">)</span>
                <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fac1</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
        <span class="n">Px</span> <span class="o">*=</span> <span class="n">trm1</span><span class="o">+</span><span class="n">trm2</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_boost</span><span class="o">.</span><span class="n">_nct_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_nct_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">_boost</span><span class="o">.</span><span class="n">_nct_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>  <span class="c1"># see gh-17432</span>
            <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_nct_isf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_nct_mean</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_nct_variance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_nct_skewness</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">g2</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_nct_kurtosis_excess</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nc</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>


<span class="n">nct</span> <span class="o">=</span> <span class="n">nct_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;nct&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pareto_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Pareto continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `pareto` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = \frac{b}{x^{b+1}}</span>

<span class="sd">    for :math:`x \ge 1`, :math:`b &gt; 0`.</span>

<span class="sd">    `pareto` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># pareto.pdf(x, b) = b / x**(b+1)</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s1">&#39;m&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">1</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bt</span> <span class="o">/</span> <span class="p">(</span><span class="n">bt</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">2</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bt</span> <span class="o">/</span> <span class="p">(</span><span class="n">bt</span><span class="o">-</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bt</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">3</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">bt</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bt</span> <span class="o">-</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">bt</span> <span class="o">-</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bt</span><span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">g1</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&gt;</span> <span class="mi">4</span>
            <span class="n">bt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">bt</span><span class="p">)</span> <span class="o">/</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.0</span><span class="p">,</span> <span class="mf">12.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> <span class="n">bt</span><span class="p">))</span>
            <span class="n">np</span><span class="o">.</span><span class="n">place</span><span class="p">(</span><span class="n">g2</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">c</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">parameters</span>

        <span class="c1"># ensure that any fixed parameters don&#39;t violate constraints of the</span>
        <span class="c1"># distribution before continuing.</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">floc</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">fscale</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;pareto&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="n">ndata</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
            <span class="c1"># The first-order necessary condition on `shape` can be solved in</span>
            <span class="c1"># closed form</span>
            <span class="k">return</span> <span class="n">ndata</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">location</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The support of the distribution is `(x - loc)/scale &gt; 0`.</span>
            <span class="c1"># The method of Lagrange multipliers turns this constraint</span>
            <span class="c1"># into an equation that can be solved numerically.</span>
            <span class="c1"># See gh-12545 for details.</span>

            <span class="k">def</span> <span class="nf">dL_dScale</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
                <span class="c1"># The partial derivative of the log-likelihood function w.r.t.</span>
                <span class="c1"># the scale.</span>
                <span class="k">return</span> <span class="n">ndata</span> <span class="o">*</span> <span class="n">shape</span> <span class="o">/</span> <span class="n">scale</span>

            <span class="k">def</span> <span class="nf">dL_dLocation</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
                <span class="c1"># The partial derivative of the log-likelihood function w.r.t.</span>
                <span class="c1"># the location.</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">shape</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">location</span><span class="p">))</span>

            <span class="k">def</span> <span class="nf">fun_to_solve</span><span class="p">(</span><span class="n">scale</span><span class="p">):</span>
                <span class="c1"># optimize the scale by setting the partial derivatives</span>
                <span class="c1"># w.r.t. to location and scale equal and solving.</span>
                <span class="n">location</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">scale</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">dL_dLocation</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span> <span class="o">-</span> <span class="n">dL_dScale</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

            <span class="k">def</span> <span class="nf">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">):</span>
                <span class="c1"># return true if the signs disagree.</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">fun_to_solve</span><span class="p">(</span><span class="n">lbrack</span><span class="p">))</span> <span class="o">!=</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">fun_to_solve</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)))</span>

            <span class="c1"># set brackets for `root_scalar` to use when optimizing over the</span>
            <span class="c1"># scale such that a root is likely between them. Use user supplied</span>
            <span class="c1"># guess or default 1.</span>
            <span class="n">brack_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span> <span class="o">=</span> <span class="n">brack_start</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">brack_start</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="c1"># if a root is not between the brackets, iteratively expand them</span>
            <span class="c1"># until they include a sign change, checking after each bracket is</span>
            <span class="c1"># modified.</span>
            <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">)</span>
                   <span class="ow">and</span> <span class="p">(</span><span class="n">lbrack</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">rbrack</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)):</span>
                <span class="n">lbrack</span> <span class="o">/=</span> <span class="mi">2</span>
                <span class="n">rbrack</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">fun_to_solve</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">[</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">scale</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>

                <span class="c1"># The Pareto distribution requires that its parameters satisfy</span>
                <span class="c1"># the condition `fscale + floc &lt;= min(data)`. However, to</span>
                <span class="c1"># avoid numerical issues, we require that `fscale + floc`</span>
                <span class="c1"># is strictly less than `min(data)`. If this condition</span>
                <span class="c1"># is not satisfied, reduce the scale with `np.nextafter` to</span>
                <span class="c1"># ensure that data does not fall outside of the support.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">scale</span> <span class="o">+</span> <span class="n">loc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">loc</span>
                    <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">fscale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
        <span class="c1"># Source: Evans, Hastings, and Peacock (2000), Statistical</span>
        <span class="c1"># Distributions, 3rd. Ed., John Wiley and Sons. Page 149.</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">loc</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">pareto</span> <span class="o">=</span> <span class="n">pareto_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pareto&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">lomax_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Lomax (Pareto of the second kind) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `lomax` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{c}{(1+x)^{c+1}}</span>

<span class="sd">    for :math:`x \ge 0`, :math:`c &gt; 0`.</span>

<span class="sd">    `lomax` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    `lomax` is a special case of `pareto` with ``loc=-1.0``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># lomax.pdf(x, c) = c / (1+x)**(c+1)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span> <span class="o">=</span> <span class="n">pareto</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">+</span><span class="mf">1.0</span><span class="o">/</span><span class="n">c</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>


<span class="n">lomax</span> <span class="o">=</span> <span class="n">lomax_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;lomax&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pearson3_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A pearson type III continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `pearson3` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \kappa) = \frac{|\beta|}{\Gamma(\alpha)}</span>
<span class="sd">                       (\beta (x - \zeta))^{\alpha - 1}</span>
<span class="sd">                       \exp(-\beta (x - \zeta))</span>

<span class="sd">    where:</span>

<span class="sd">    .. math::</span>

<span class="sd">            \beta = \frac{2}{\kappa}</span>

<span class="sd">            \alpha = \beta^2 = \frac{4}{\kappa^2}</span>

<span class="sd">            \zeta = -\frac{\alpha}{\beta} = -\beta</span>

<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>
<span class="sd">    Pass the skew :math:`\kappa` into `pearson3` as the shape parameter</span>
<span class="sd">    ``skew``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    R.W. Vogel and D.E. McMartin, &quot;Probability Plot Goodness-of-Fit and</span>
<span class="sd">    Skewness Estimation Procedures for the Pearson Type 3 Distribution&quot;, Water</span>
<span class="sd">    Resources Research, Vol.27, 3149-3158 (1991).</span>

<span class="sd">    L.R. Salvosa, &quot;Tables of Pearson&#39;s Type III Function&quot;, Ann. Math. Statist.,</span>
<span class="sd">    Vol.1, 191-198 (1930).</span>

<span class="sd">    &quot;Using Modern Computing Tools to Fit the Pearson Type III Distribution to</span>
<span class="sd">    Aviation Loads Data&quot;, Office of Aviation Research (2003).</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1"># The real &#39;loc&#39; and &#39;scale&#39; are handled in the calling pdf(...). The</span>
        <span class="c1"># local variables &#39;loc&#39; and &#39;scale&#39; within pearson3._pdf are set to</span>
        <span class="c1"># the defaults just to keep them as part of the equations for</span>
        <span class="c1"># documentation.</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># If skew is small, return _norm_pdf. The divide between pearson3</span>
        <span class="c1"># and norm was found by brute force and is approximately a skew of</span>
        <span class="c1"># 0.000016.  No one, I hope, would actually use a skew value even</span>
        <span class="c1"># close to this small.</span>
        <span class="n">norm2pearson_transition</span> <span class="o">=</span> <span class="mf">0.000016</span>

        <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># mask is True where skew is small enough to use the normal approx.</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">norm2pearson_transition</span>
        <span class="n">invmask</span> <span class="o">=</span> <span class="o">~</span><span class="n">mask</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="n">beta</span>

        <span class="n">transx</span> <span class="o">=</span> <span class="n">beta</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transx</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zeta</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1"># The _argcheck function in rv_continuous only allows positive</span>
        <span class="c1"># arguments.  The skew argument for pearson3 can be zero (which I want</span>
        <span class="c1"># to handle inside pearson3._pdf) or negative.  So just return True</span>
        <span class="c1"># for all skew args.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;skew&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">v</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">skew</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">skew</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">k</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1"># pearson3.pdf(x, skew) = abs(beta) / gamma(alpha) *</span>
        <span class="c1">#     (beta * (x - zeta))**(alpha - 1) * exp(-beta*(x - zeta))</span>
        <span class="c1"># Do the calculation in _logpdf since helps to limit</span>
        <span class="c1"># overflow/underflow problems</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ans</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ans</span><span class="p">):</span>
                <span class="k">return</span> <span class="mf">0.0</span>
            <span class="k">return</span> <span class="n">ans</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ans</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="c1">#   PEARSON3 logpdf                           GAMMA logpdf</span>
        <span class="c1">#   np.log(abs(beta))</span>
        <span class="c1"># + (alpha - 1)*np.log(beta*(x - zeta))          + (a - 1)*np.log(x)</span>
        <span class="c1"># - beta*(x - zeta)                           - x</span>
        <span class="c1"># - sc.gammalnalpha)                              - sc.gammalna)</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transx</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>

        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]))</span>
        <span class="c1"># use logpdf instead of _logpdf to fix issue mentioned in gh-12640</span>
        <span class="c1"># (_logpdf does not return correct result for alpha = 1)</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">transx</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transx</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>

        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

        <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">skew</span><span class="p">,</span> <span class="n">invmask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">invmask1a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">invmask</span><span class="p">,</span> <span class="n">skew</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">invmask1b</span> <span class="o">=</span> <span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="c1"># use cdf instead of _cdf to fix issue mentioned in gh-12640</span>
        <span class="c1"># (_cdf produces NaNs for inputs outside support)</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask1a</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">transx</span><span class="p">[</span><span class="n">invmask1b</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">invmask1b</span><span class="p">])</span>

        <span class="c1"># The gamma._cdf approach wasn&#39;t working with negative skew.</span>
        <span class="c1"># Note that multiplying the skew by -1 reflects about x=0.</span>
        <span class="c1"># So instead of evaluating the CDF with negative skew at x,</span>
        <span class="c1"># evaluate the SF with positive skew at -x.</span>
        <span class="n">invmask2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">invmask</span><span class="p">,</span> <span class="n">skew</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">invmask2b</span> <span class="o">=</span> <span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="c1"># gamma._sf produces NaNs when transx &lt; 0, so use gamma.sf</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask2a</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">transx</span><span class="p">[</span><span class="n">invmask2b</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">invmask2b</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">transx</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>

        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">_norm_sf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

        <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">skew</span><span class="p">,</span> <span class="n">invmask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">invmask1a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">invmask</span><span class="p">,</span> <span class="n">skew</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">invmask1b</span> <span class="o">=</span> <span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask1a</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">transx</span><span class="p">[</span><span class="n">invmask1b</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">invmask1b</span><span class="p">])</span>

        <span class="n">invmask2a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">invmask</span><span class="p">,</span> <span class="n">skew</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">invmask2b</span> <span class="o">=</span> <span class="n">skew</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask2a</span><span class="p">]</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">transx</span><span class="p">[</span><span class="n">invmask2b</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">invmask2b</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skew</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">skew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">skew</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">skew</span><span class="p">))</span>

        <span class="n">nsmall</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">nbig</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="n">nsmall</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">nsmall</span><span class="p">)</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">nbig</span><span class="p">)</span><span class="o">/</span><span class="n">beta</span> <span class="o">+</span> <span class="n">zeta</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">skew</span><span class="p">):</span>
        <span class="n">ans</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">invmask</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zeta</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">skew</span><span class="p">))</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span>
        <span class="n">q</span><span class="p">[</span><span class="n">beta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">[</span><span class="n">beta</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># for negative skew; see gh-17050</span>
        <span class="n">ans</span><span class="p">[</span><span class="n">invmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span><span class="o">/</span><span class="n">beta</span> <span class="o">+</span> <span class="n">zeta</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        Note that method of moments (`method=&#39;MM&#39;`) is not</span>
<span class="s2">        available for this distribution.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;MM&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Fit `method=&#39;MM&#39;` is not available for &quot;</span>
                                      <span class="s2">&quot;the Pearson3 distribution. Please try &quot;</span>
                                      <span class="s2">&quot;the default `method=&#39;MLE&#39;`.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">pearson3</span> <span class="o">=</span> <span class="n">pearson3_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;pearson3&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">powerlaw_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A power-function continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    pareto</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `powerlaw` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a) = a x^{a-1}</span>

<span class="sd">    for :math:`0 \le x \le 1`, :math:`a &gt; 0`.</span>

<span class="sd">    `powerlaw` takes ``a`` as a shape parameter for :math:`a`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    For example, the support of `powerlaw` can be adjusted from the default</span>
<span class="sd">    interval ``[0, 1]`` to the interval ``[c, c+d]`` by setting ``loc=c`` and</span>
<span class="sd">    ``scale=d``. For a power-law distribution with infinite support, see</span>
<span class="sd">    `pareto`.</span>

<span class="sd">    `powerlaw` is a special case of `beta` with ``b=1``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># powerlaw.pdf(x, a) = a * x**(a-1)</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">xlogy</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">powm1</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># The following expression is correct for all real n (provided a &gt; 0).</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">),</span>
                <span class="n">a</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span>
                <span class="o">-</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">((</span><span class="n">a</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">3.0</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">a</span> <span class="o">+</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span><span class="p">),</span>
                <span class="mi">6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">a</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_support_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_support_mask</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
                <span class="o">&amp;</span> <span class="p">((</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)))</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        Notes specifically for ``powerlaw.fit``: If the location is a free</span>
<span class="s2">        parameter and the value returned for the shape parameter is less than</span>
<span class="s2">        one, the true maximum likelihood approaches infinity. This causes</span>
<span class="s2">        numerical difficulties, and the resulting estimates are approximate.</span>
<span class="s2">        </span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1"># Summary of the strategy:</span>
        <span class="c1">#</span>
        <span class="c1"># 1) If the scale and location are fixed, return the shape according</span>
        <span class="c1">#    to a formula.</span>
        <span class="c1">#</span>
        <span class="c1"># 2) If the scale is fixed, there are two possibilities for the other</span>
        <span class="c1">#    parameters - one corresponding with shape less than one, and</span>
        <span class="c1">#    another with shape greater than one. Calculate both, and return</span>
        <span class="c1">#    whichever has the better log-likelihood.</span>
        <span class="c1">#</span>
        <span class="c1"># At this point, the scale is known to be free.</span>
        <span class="c1">#</span>
        <span class="c1"># 3) If the location is fixed, return the scale and shape according to</span>
        <span class="c1">#    formulas (or, if the shape is fixed, the fixed shape).</span>
        <span class="c1">#</span>
        <span class="c1"># At this point, the location and scale are both free. There are</span>
        <span class="c1"># separate equations depending on whether the shape is less than one or</span>
        <span class="c1"># greater than one.</span>
        <span class="c1">#</span>
        <span class="c1"># 4a) If the shape is less than one, there are formulas for shape,</span>
        <span class="c1">#     location, and scale.</span>
        <span class="c1"># 4b) If the shape is greater than one, there are formulas for shape</span>
        <span class="c1">#     and scale, but there is a condition for location to be solved</span>
        <span class="c1">#     numerically.</span>
        <span class="c1">#</span>
        <span class="c1"># If the shape is fixed and less than one, we use 4a.</span>
        <span class="c1"># If the shape is fixed and greater than one, we use 4b.</span>
        <span class="c1"># If the shape is also free, we calculate fits using both 4a and 4b</span>
        <span class="c1"># and choose the one that results a better log-likelihood.</span>
        <span class="c1">#</span>
        <span class="c1"># In many cases, the use of `np.nextafter` is used to avoid numerical</span>
        <span class="c1"># issues.</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                                 <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">penalized_nllf_args</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">),)]</span>
        <span class="n">penalized_nllf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reduce_func</span><span class="p">(</span><span class="n">penalized_nllf_args</span><span class="p">,</span> <span class="p">{})[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># ensure that any fixed parameters don&#39;t violate constraints of the</span>
        <span class="c1"># distribution before continuing. The support of the distribution</span>
        <span class="c1"># is `0 &lt; (x - loc)/scale &lt; 1`.</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">floc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s1">&#39;powerlaw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">floc</span> <span class="o">+</span> <span class="n">fscale</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s1">&#39;powerlaw&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fscale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Negative or zero `fscale` is outside the &quot;</span>
                                 <span class="s2">&quot;range allowed by the distribution.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fscale</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;`fscale` must be greater than the range of data.&quot;</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="c1"># The first-order necessary condition on `shape` can be solved in</span>
            <span class="c1"># closed form. It can be used no matter the assumption of the</span>
            <span class="c1"># value of the shape.</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span> <span class="n">N</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">))</span> <span class="o">-</span> <span class="n">N</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">scale</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">get_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
            <span class="c1"># analytical solution for `scale` based on the location.</span>
            <span class="c1"># It can be used no matter the assumption of the value of the</span>
            <span class="c1"># shape.</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">loc</span>

        <span class="c1"># 1) The location and scale are both fixed. Analytically determine the</span>
        <span class="c1"># shape.</span>
        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span><span class="p">),</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span>

        <span class="c1"># 2) The scale is fixed. There are two possibilities for the other</span>
        <span class="c1"># parameters. Choose the option with better log-likelihood.</span>
        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># using `data.min()` as the optimal location</span>
            <span class="n">loc_lt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">shape_lt1</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc_lt1</span><span class="p">,</span> <span class="n">fscale</span><span class="p">)</span>
            <span class="n">ll_lt1</span> <span class="o">=</span> <span class="n">penalized_nllf</span><span class="p">((</span><span class="n">shape_lt1</span><span class="p">,</span> <span class="n">loc_lt1</span><span class="p">,</span> <span class="n">fscale</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>

            <span class="c1"># using `data.max() - scale` as the optimal location</span>
            <span class="n">loc_gt1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">fscale</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">shape_gt1</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc_gt1</span><span class="p">,</span> <span class="n">fscale</span><span class="p">)</span>
            <span class="n">ll_gt1</span> <span class="o">=</span> <span class="n">penalized_nllf</span><span class="p">((</span><span class="n">shape_gt1</span><span class="p">,</span> <span class="n">loc_gt1</span><span class="p">,</span> <span class="n">fscale</span><span class="p">),</span> <span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ll_lt1</span> <span class="o">&lt;</span> <span class="n">ll_gt1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">shape_lt1</span><span class="p">,</span> <span class="n">loc_lt1</span><span class="p">,</span> <span class="n">fscale</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">shape_gt1</span><span class="p">,</span> <span class="n">loc_gt1</span><span class="p">,</span> <span class="n">fscale</span>

        <span class="c1"># 3) The location is fixed. Return the analytical scale and the</span>
        <span class="c1"># analytical (or fixed) shape.</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">scale</span>

        <span class="c1"># 4) Location and scale are both free</span>
        <span class="c1"># 4a) Use formulas that assume `shape &lt;= 1`.</span>

        <span class="k">def</span> <span class="nf">fit_loc_scale_w_shape_lt_1</span><span class="p">():</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">get_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

        <span class="c1"># 4b) Fit under the assumption that `shape &gt; 1`. The support</span>
        <span class="c1"># of the distribution is `(x - loc)/scale &lt;= 1`. The method of Lagrange</span>
        <span class="c1"># multipliers turns this constraint into the condition that</span>
        <span class="c1"># dL_dScale - dL_dLocation must be zero, which is solved numerically.</span>
        <span class="c1"># (Alternatively, substitute the constraint into the objective</span>
        <span class="c1"># function before deriving the likelihood equation for location.)</span>

        <span class="k">def</span> <span class="nf">dL_dScale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="c1"># The partial derivative of the log-likelihood function w.r.t.</span>
            <span class="c1"># the scale.</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">shape</span> <span class="o">/</span> <span class="n">scale</span>

        <span class="k">def</span> <span class="nf">dL_dLocation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
            <span class="c1"># The partial derivative of the log-likelihood function w.r.t.</span>
            <span class="c1"># the location.</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">shape</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">loc</span> <span class="o">-</span> <span class="n">data</span><span class="p">))</span>  <span class="c1"># -1/(data-loc)</span>

        <span class="k">def</span> <span class="nf">dL_dLocation_star</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="c1"># The derivative of the log-likelihood function w.r.t.</span>
            <span class="c1"># the location, given optimal shape and scale</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">get_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dL_dLocation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">fun_to_solve</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="c1"># optimize the location by setting the partial derivatives</span>
            <span class="c1"># w.r.t. to location and scale equal and solving.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">get_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">dL_dScale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
                    <span class="o">-</span> <span class="n">dL_dLocation</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">fit_loc_scale_w_shape_gt_1</span><span class="p">():</span>
            <span class="c1"># set brackets for `root_scalar` to use when optimizing over the</span>
            <span class="c1"># location such that a root is likely between them.</span>
            <span class="n">rbrack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

            <span class="c1"># if the sign of `dL_dLocation_star` is positive at rbrack,</span>
            <span class="c1"># we&#39;re not going to find the root we&#39;re looking for</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">rbrack</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">dL_dLocation_star</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rbrack</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">delta</span>
                <span class="n">delta</span> <span class="o">*=</span> <span class="mi">2</span>

            <span class="k">def</span> <span class="nf">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">):</span>
                <span class="c1"># Check if the interval (lbrack, rbrack) contains the root.</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">fun_to_solve</span><span class="p">(</span><span class="n">lbrack</span><span class="p">))</span>
                        <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">fun_to_solve</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)))</span>

            <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="mi">1</span>

            <span class="c1"># if the sign doesn&#39;t change between the brackets, move the left</span>
            <span class="c1"># bracket until it does. (The right bracket remains fixed at the</span>
            <span class="c1"># maximum permissible value.)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">interval_contains_root</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">)</span>
                   <span class="ow">and</span> <span class="n">lbrack</span> <span class="o">!=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">):</span>
                <span class="n">lbrack</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">*=</span> <span class="mi">2</span>

            <span class="n">root</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">fun_to_solve</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">))</span>

            <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">get_scale</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="ow">or</span> <span class="n">get_shape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

        <span class="c1"># Shape is fixed - choose 4a or 4b accordingly.</span>
        <span class="k">if</span> <span class="n">fshape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fshape</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fit_loc_scale_w_shape_lt_1</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">fshape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fshape</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fit_loc_scale_w_shape_gt_1</span><span class="p">()</span>

        <span class="c1"># Shape is free</span>
        <span class="n">fit_shape_lt1</span> <span class="o">=</span> <span class="n">fit_loc_scale_w_shape_lt_1</span><span class="p">()</span>
        <span class="n">ll_lt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnlf</span><span class="p">(</span><span class="n">fit_shape_lt1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="n">fit_shape_gt1</span> <span class="o">=</span> <span class="n">fit_loc_scale_w_shape_gt_1</span><span class="p">()</span>
        <span class="n">ll_gt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnlf</span><span class="p">(</span><span class="n">fit_shape_gt1</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ll_lt1</span> <span class="o">&lt;=</span> <span class="n">ll_gt1</span> <span class="ow">and</span> <span class="n">fit_shape_lt1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fit_shape_lt1</span>
        <span class="k">elif</span> <span class="n">ll_lt1</span> <span class="o">&gt;</span> <span class="n">ll_gt1</span> <span class="ow">and</span> <span class="n">fit_shape_gt1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fit_shape_gt1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">powerlaw</span> <span class="o">=</span> <span class="n">powerlaw_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;powerlaw&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">powerlognorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A power log-normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `powerlognorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c, s) = \frac{c}{x s} \phi(\log(x)/s)</span>
<span class="sd">                     (\Phi(-\log(x)/s))^{c-1}</span>

<span class="sd">    where :math:`\phi` is the normal pdf, and :math:`\Phi` is the normal cdf,</span>
<span class="sd">    and :math:`x &gt; 0`, :math:`s, c &gt; 0`.</span>

<span class="sd">    `powerlognorm` takes :math:`c` and :math:`s` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">i_s</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="n">i_s</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">q</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">))</span> <span class="o">*</span> <span class="n">s</span><span class="p">)</span>


<span class="n">powerlognorm</span> <span class="o">=</span> <span class="n">powerlognorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;powerlognorm&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">powernorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A power normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `powernorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = c \phi(x) (\Phi(-x))^{c-1}</span>

<span class="sd">    where :math:`\phi` is the normal pdf, :math:`\Phi` is the normal cdf,</span>
<span class="sd">    :math:`x` is any real, and :math:`c &gt; 0` [1]_.</span>

<span class="sd">    `powernorm` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] NIST Engineering Statistics Handbook, Section 1.3.6.6.13,</span>
<span class="sd">           https://www.itl.nist.gov/div898/handbook//eda/section3/eda366d.htm</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># powernorm.pdf(x, c) = c * phi(x) * (Phi(-x))**(c-1)</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">*</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">q</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">_norm_ppf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">/</span> <span class="n">c</span><span class="p">))</span>


<span class="n">powernorm</span> <span class="o">=</span> <span class="n">powernorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;powernorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rdist_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An R-distributed (symmetric beta) continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `rdist` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{(1-x^2)^{c/2-1}}{B(1/2, c/2)}</span>

<span class="sd">    for :math:`-1 \le x \le 1`, :math:`c &gt; 0`. `rdist` is also called the</span>
<span class="sd">    symmetric beta distribution: if B has a `beta` distribution with</span>
<span class="sd">    parameters (c/2, c/2), then X = 2*B - 1 follows a R-distribution with</span>
<span class="sd">    parameter c.</span>

<span class="sd">    `rdist` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    This distribution includes the following distribution kernels as</span>
<span class="sd">    special cases::</span>

<span class="sd">        c = 2:  uniform</span>
<span class="sd">        c = 3:  `semicircular`</span>
<span class="sd">        c = 4:  Epanechnikov (parabolic)</span>
<span class="sd">        c = 6:  quartic (biweight)</span>
<span class="sd">        c = 8:  triweight</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="c1"># use relation to the beta distribution for pdf, cdf, etc</span>
    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">beta</span><span class="o">.</span><span class="n">_cdf</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">beta</span><span class="o">.</span><span class="n">_sf</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">beta</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">numerator</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">((</span><span class="n">n</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">beta</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">c</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>


<span class="n">rdist</span> <span class="o">=</span> <span class="n">rdist_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rdist&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rayleigh_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Rayleigh continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `rayleigh` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = x \exp(-x^2/2)</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    `rayleigh` is a special case of `chi` with ``df=2``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">chi</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="c1"># rayleigh.pdf(r) = r * exp(-r**2/2)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span>
                <span class="n">val</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mf">1.5</span><span class="p">,</span>
                <span class="mi">6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">val</span><span class="o">-</span><span class="mi">16</span><span class="o">/</span><span class="n">val</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_EULER</span><span class="o">/</span><span class="mf">2.0</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        Notes specifically for ``rayleigh.fit``: If the location is fixed with</span>
<span class="s2">        the `floc` parameter, this method uses an analytical formula to find</span>
<span class="s2">        the scale.  Otherwise, this function uses a numerical root finder on</span>
<span class="s2">        the first order conditions of the log-likelihood function to find the</span>
<span class="s2">        MLE.  Only the (optional) `loc` parameter is used as the initial guess</span>
<span class="s2">        for the root finder; the `scale` parameter and any other parameters</span>
<span class="s2">        for the optimizer are ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                         <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">scale_mle</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="c1"># Source: Statistical Distributions, 3rd Edition. Evans, Hastings,</span>
            <span class="c1"># and Peacock (2000), Page 175</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span> <span class="o">**</span> <span class="mf">.5</span>

        <span class="k">def</span> <span class="nf">loc_mle</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="c1"># This implicit equation for `loc` is used when</span>
            <span class="c1"># both `loc` and `scale` are free.</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">loc</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">xm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">xm</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">s3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">xm</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">*</span><span class="n">s3</span>

        <span class="k">def</span> <span class="nf">loc_mle_scale_fixed</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">fscale</span><span class="p">):</span>
            <span class="c1"># This implicit equation for `loc` is used when</span>
            <span class="c1"># `scale` is fixed but `loc` is not.</span>
            <span class="n">xm</span> <span class="o">=</span> <span class="n">data</span> <span class="o">-</span> <span class="n">loc</span>
            <span class="k">return</span> <span class="n">xm</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">-</span> <span class="n">scale</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">xm</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># `loc` is fixed, analytically determine `scale`.</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">floc</span><span class="p">,</span> <span class="n">scale_mle</span><span class="p">(</span><span class="n">floc</span><span class="p">)</span>

        <span class="c1"># Account for user provided guess of `loc`.</span>
        <span class="n">loc0</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">loc0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Use _fitstart to estimate loc; ignore the returned scale.</span>
            <span class="n">loc0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">fun</span> <span class="o">=</span> <span class="n">loc_mle</span> <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">loc_mle_scale_fixed</span>
        <span class="n">rbrack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
        <span class="n">lbrack</span> <span class="o">=</span> <span class="n">_get_left_bracket</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">optimize</span><span class="o">.</span><span class="n">root_scalar</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FitSolverError</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">flag</span><span class="p">)</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span> <span class="ow">or</span> <span class="n">scale_mle</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>


<span class="n">rayleigh</span> <span class="o">=</span> <span class="n">rayleigh_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">reciprocal_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A loguniform or reciprocal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for this class is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, a, b) = \frac{1}{x \log(b/a)}</span>

<span class="sd">    for :math:`a \le x \le b`, :math:`b &gt; a &gt; 0`. This class takes</span>
<span class="sd">    :math:`a` and :math:`b` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    This doesn&#39;t show the equal probability of ``0.01``, ``0.1`` and</span>
<span class="sd">    ``1``. This is best when the x-axis is log-scaled:</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(np.log10(r))</span>
<span class="sd">    &gt;&gt;&gt; ax.set_ylabel(&quot;Frequency&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlabel(&quot;Value of random variable&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.xaxis.set_major_locator(plt.FixedLocator([-2, -1, 0]))</span>
<span class="sd">    &gt;&gt;&gt; ticks = [&quot;$10^{{ {} }}$&quot;.format(i) for i in [-2, -1, 0]]</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xticklabels(ticks)  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    This random variable will be log-uniform regardless of the base chosen for</span>
<span class="sd">    ``a`` and ``b``. Let&#39;s specify with base ``2`` instead:</span>

<span class="sd">    &gt;&gt;&gt; rvs = %(name)s(2**-2, 2**0).rvs(size=1000)</span>

<span class="sd">    Values of ``1/4``, ``1/2`` and ``1`` are equally likely with this random</span>
<span class="sd">    variable.  Here&#39;s the histogram:</span>

<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(np.log2(rvs))</span>
<span class="sd">    &gt;&gt;&gt; ax.set_ylabel(&quot;Frequency&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlabel(&quot;Value of random variable&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.xaxis.set_major_locator(plt.FixedLocator([-2, -1, 0]))</span>
<span class="sd">    &gt;&gt;&gt; ticks = [&quot;$2^{{ {} }}$&quot;.format(i) for i in [-2, -1, 0]]</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xticklabels(ticks)  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="c1"># Reasonable, since support is [a, b]</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># reciprocal.pdf(x, a, b) = 1 / (x*(log(b) - log(a)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="n">n</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">_log_diff</span><span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">n</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))))</span>
        <span class="k">return</span> <span class="n">t1</span> <span class="o">*</span> <span class="n">t2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="n">fit_note</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        `loguniform`/`reciprocal` is over-parameterized. `fit` automatically</span>
<span class="s2">         fixes `scale` to 1 unless `fscale` is provided by the user.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span>

    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="n">fit_note</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">fscale</span><span class="o">=</span><span class="n">fscale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="c1"># Details related to the decision of not defining</span>
    <span class="c1"># the survival function for this distribution can be</span>
    <span class="c1"># found in the PR: https://github.com/scipy/scipy/pull/18614</span>


<span class="n">loguniform</span> <span class="o">=</span> <span class="n">reciprocal_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;loguniform&quot;</span><span class="p">)</span>
<span class="n">reciprocal</span> <span class="o">=</span> <span class="n">reciprocal_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;reciprocal&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rice_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Rice continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `rice` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = x \exp(- \frac{x^2 + b^2}{2}) I_0(x b)</span>

<span class="sd">    for :math:`x &gt;= 0`, :math:`b &gt; 0`. :math:`I_0` is the modified Bessel</span>
<span class="sd">    function of order zero (`scipy.special.i0`).</span>

<span class="sd">    `rice` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The Rice distribution describes the length, :math:`r`, of a 2-D vector with</span>
<span class="sd">    components :math:`(U+u, V+v)`, where :math:`U, V` are constant, :math:`u,</span>
<span class="sd">    v` are independent Gaussian random variables with standard deviation</span>
<span class="sd">    :math:`s`.  Let :math:`R = \sqrt{U^2 + V^2}`. Then the pdf of :math:`r` is</span>
<span class="sd">    ``rice.pdf(x, R/s, scale=s)``.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># https://en.wikipedia.org/wiki/Rice_distribution</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">b</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,)</span> <span class="o">+</span> <span class="n">size</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">t</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">chndtr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">chndtrix</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># rice.pdf(x, b) = x * exp(-(x**2+b**2)/2) * I[0](x*b)</span>
        <span class="c1">#</span>
        <span class="c1"># We use (x**2 + b**2)/2 = ((x-b)**2)/2 + xb.</span>
        <span class="c1"># The factor of np.exp(-xb) is then included in the i0e function</span>
        <span class="c1"># in place of the modified Bessel function, i0, improving</span>
        <span class="c1"># numerical stability for large values of xb.</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">nd2</span> <span class="o">=</span> <span class="n">n</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">n1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">nd2</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="n">nd2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b2</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="o">*</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">hyp1f1</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">b2</span><span class="p">))</span>


<span class="n">rice</span> <span class="o">=</span> <span class="n">rice_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rice&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">recipinvgauss_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A reciprocal inverse Gaussian continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `recipinvgauss` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \mu) = \frac{1}{\sqrt{2\pi x}}</span>
<span class="sd">                    \exp\left(\frac{-(1-\mu x)^2}{2\mu^2x}\right)</span>

<span class="sd">    for :math:`x \ge 0`.</span>

<span class="sd">    `recipinvgauss` takes ``mu`` as a shape parameter for :math:`\mu`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;mu&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="c1"># recipinvgauss.pdf(x, mu) =</span>
        <span class="c1">#                     1/sqrt(2*pi*x) * exp(-(1-mu*x)**2/(2*x*mu**2))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">),</span>
                          <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">mu</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">mu</span><span class="o">**</span><span class="mf">2.0</span><span class="p">)</span>
                                         <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="p">)),</span>
                          <span class="n">fillvalue</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">trm2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">+</span> <span class="n">x</span>
        <span class="n">isqx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mu</span><span class="p">):</span>
        <span class="n">trm1</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">-</span> <span class="n">x</span>
        <span class="n">trm2</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">mu</span> <span class="o">+</span> <span class="n">x</span>
        <span class="n">isqx</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">isqx</span><span class="o">*</span><span class="n">trm2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">random_state</span><span class="o">.</span><span class="n">wald</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>


<span class="n">recipinvgauss</span> <span class="o">=</span> <span class="n">recipinvgauss_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;recipinvgauss&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">semicircular_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A semicircular continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    rdist</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `semicircular` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{2}{\pi} \sqrt{1-x^2}</span>

<span class="sd">    for :math:`-1 \le x \le 1`.</span>

<span class="sd">    The distribution is a special case of `rdist` with `c = 3`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Wigner semicircle distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Wigner_semicircle_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">+</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rdist</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># generate values uniformly distributed on the area under the pdf</span>
        <span class="c1"># (semi-circle) by randomly generating the radius and angle</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">*</span> <span class="n">a</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.64472988584940017414</span>


<span class="n">semicircular</span> <span class="o">=</span> <span class="n">semicircular_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;semicircular&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">skewcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A skewed Cauchy random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cauchy : Cauchy distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The probability density function for `skewcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\pi \left(\frac{x^2}{\left(a\, \text{sign}(x) + 1</span>
<span class="sd">                                                   \right)^2} + 1 \right)}</span>

<span class="sd">    for a real number :math:`x` and skewness parameter :math:`-1 &lt; a &lt; 1`.</span>

<span class="sd">    When :math:`a=0`, the distribution reduces to the usual Cauchy</span>
<span class="sd">    distribution.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Skewed generalized *t* distribution&quot;, Wikipedia</span>
<span class="sd">       https://en.wikipedia.org/wiki/Skewed_generalized_t_distribution#Skewed_Cauchy_distribution</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)),</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">i</span><span class="p">,</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Use 0 as the initial guess of the skewness shape parameter.</span>
        <span class="c1"># For the location and scale, estimate using the median and</span>
        <span class="c1"># quartiles.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="n">p25</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="n">p75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">])</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="p">(</span><span class="n">p75</span> <span class="o">-</span> <span class="n">p25</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>


<span class="n">skewcauchy</span> <span class="o">=</span> <span class="n">skewcauchy_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;skewcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">skewnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A skew-normal random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The pdf is::</span>

<span class="sd">        skewnorm.pdf(x, a) = 2 * norm.pdf(x) * norm.cdf(a*x)</span>

<span class="sd">    `skewnorm` takes a real number :math:`a` as a skewness parameter</span>
<span class="sd">    When ``a = 0`` the distribution is identical to a normal distribution</span>
<span class="sd">    (`norm`). `rvs` implements the method of [1]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] A. Azzalini and A. Capitanio (1999). Statistical applications of</span>
<span class="sd">        the multivariate skew-normal distribution. J. Roy. Statist. Soc.,</span>
<span class="sd">        B 61, 579-602. :arxiv:`0911.2093`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="mf">2.</span><span class="o">*</span><span class="n">_norm_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span>
            <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">),</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">f2</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">cdf</span> <span class="o">=</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_skewnorm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
        <span class="c1"># for some reason, a isn&#39;t broadcasted if some of x are invalid</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">cdf</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># Boost is not accurate in left tail when a &gt; 0</span>
        <span class="n">i_small_cdf</span> <span class="o">=</span> <span class="p">(</span><span class="n">cdf</span> <span class="o">&lt;</span> <span class="mf">1e-6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">cdf</span><span class="p">[</span><span class="n">i_small_cdf</span><span class="p">]</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i_small_cdf</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i_small_cdf</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cdf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_skewnorm_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="c1"># Boost&#39;s SF is implemented this way. Use whatever customizations</span>
        <span class="c1"># we made in the _cdf.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_boost</span><span class="o">.</span><span class="n">_skewnorm_isf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">u0</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u1</span> <span class="o">=</span> <span class="n">d</span><span class="o">*</span><span class="n">u0</span> <span class="o">+</span> <span class="n">v</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">u0</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="o">-</span><span class="n">u1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mvsk&#39;</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
        <span class="n">const</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">a</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;m&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">const</span>
        <span class="k">if</span> <span class="s1">&#39;v&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">const</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">if</span> <span class="s1">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">const</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">const</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span>
        <span class="k">if</span> <span class="s1">&#39;k&#39;</span> <span class="ow">in</span> <span class="n">moments</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">const</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">const</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span>

    <span class="c1"># For odd order, the each noncentral moment of the skew-normal distribution</span>
    <span class="c1"># with location 0 and scale 1 can be expressed as a polynomial in delta,</span>
    <span class="c1"># where delta = a/sqrt(1 + a**2) and `a` is the skew-normal shape</span>
    <span class="c1"># parameter.  The dictionary _skewnorm_odd_moments defines those</span>
    <span class="c1"># polynomials for orders up to 19.  The dict is implemented as a cached</span>
    <span class="c1"># property to reduce the impact of the creation of the dict on import time.</span>
    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_skewnorm_odd_moments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">skewnorm_odd_moments</span> <span class="o">=</span> <span class="p">{</span>
            <span class="mi">1</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span>
            <span class="mi">3</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
            <span class="mi">5</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span>
            <span class="mi">7</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">105</span><span class="p">,</span> <span class="o">-</span><span class="mi">105</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">]),</span>
            <span class="mi">9</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">945</span><span class="p">,</span> <span class="o">-</span><span class="mi">1260</span><span class="p">,</span> <span class="mi">1134</span><span class="p">,</span> <span class="o">-</span><span class="mi">540</span><span class="p">,</span> <span class="mi">105</span><span class="p">]),</span>
            <span class="mi">11</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">10395</span><span class="p">,</span> <span class="o">-</span><span class="mi">17325</span><span class="p">,</span> <span class="mi">20790</span><span class="p">,</span> <span class="o">-</span><span class="mi">14850</span><span class="p">,</span> <span class="mi">5775</span><span class="p">,</span> <span class="o">-</span><span class="mi">945</span><span class="p">]),</span>
            <span class="mi">13</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">135135</span><span class="p">,</span> <span class="o">-</span><span class="mi">270270</span><span class="p">,</span> <span class="mi">405405</span><span class="p">,</span> <span class="o">-</span><span class="mi">386100</span><span class="p">,</span> <span class="mi">225225</span><span class="p">,</span> <span class="o">-</span><span class="mi">73710</span><span class="p">,</span>
                            <span class="mi">10395</span><span class="p">]),</span>
            <span class="mi">15</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">2027025</span><span class="p">,</span> <span class="o">-</span><span class="mi">4729725</span><span class="p">,</span> <span class="mi">8513505</span><span class="p">,</span> <span class="o">-</span><span class="mi">10135125</span><span class="p">,</span> <span class="mi">7882875</span><span class="p">,</span>
                            <span class="o">-</span><span class="mi">3869775</span><span class="p">,</span> <span class="mi">1091475</span><span class="p">,</span> <span class="o">-</span><span class="mi">135135</span><span class="p">]),</span>
            <span class="mi">17</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">34459425</span><span class="p">,</span> <span class="o">-</span><span class="mi">91891800</span><span class="p">,</span> <span class="mi">192972780</span><span class="p">,</span> <span class="o">-</span><span class="mi">275675400</span><span class="p">,</span>
                            <span class="mi">268017750</span><span class="p">,</span> <span class="o">-</span><span class="mi">175429800</span><span class="p">,</span> <span class="mi">74220300</span><span class="p">,</span> <span class="o">-</span><span class="mi">18378360</span><span class="p">,</span>
                            <span class="mi">2027025</span><span class="p">]),</span>
            <span class="mi">19</span><span class="p">:</span> <span class="n">Polynomial</span><span class="p">([</span><span class="mi">654729075</span><span class="p">,</span> <span class="o">-</span><span class="mi">1964187225</span><span class="p">,</span> <span class="mi">4714049340</span><span class="p">,</span> <span class="o">-</span><span class="mi">7856748900</span><span class="p">,</span>
                            <span class="mi">9166207050</span><span class="p">,</span> <span class="o">-</span><span class="mi">7499623950</span><span class="p">,</span> <span class="mi">4230557100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1571349780</span><span class="p">,</span>
                            <span class="mi">346621275</span><span class="p">,</span> <span class="o">-</span><span class="mi">34459425</span><span class="p">]),</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">skewnorm_odd_moments</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">order</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">order</span> <span class="o">&gt;</span> <span class="mi">19</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;skewnorm noncentral moments not &quot;</span>
                                          <span class="s2">&quot;implemented for odd orders greater &quot;</span>
                                          <span class="s2">&quot;than 19.&quot;</span><span class="p">)</span>
            <span class="c1"># Use the precomputed polynomials that were derived from the</span>
            <span class="c1"># moment generating function.</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">a</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skewnorm_odd_moments</span><span class="p">[</span><span class="n">order</span><span class="p">](</span><span class="n">delta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                    <span class="o">*</span> <span class="n">_SQRT_2_OVER_PI</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># For even order, the moment is just (order-1)!!, where !! is the</span>
            <span class="c1"># notation for the double factorial; for an odd integer m, m!! is</span>
            <span class="c1"># m*(m-2)*...*3*1.</span>
            <span class="c1"># We could use special.factorial2, but we know the argument is odd,</span>
            <span class="c1"># so avoid the overhead of that function and compute the result</span>
            <span class="c1"># directly here.</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">((</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">order</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">_SQRT_PI</span>

    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        If ``method=&#39;mm&#39;``, parameters fixed by the user are respected, and the</span>
<span class="s2">        remaining parameters are used to match distribution and sample moments</span>
<span class="s2">        where possible. For example, if the user fixes the location with</span>
<span class="s2">        ``floc``, the parameters will only match the distribution skewness and</span>
<span class="s2">        variance to the sample skewness and variance; no attempt will be made</span>
<span class="s2">        to match the means or minimize a norm of the errors.</span>
<span class="s2">        Note that the maximum possible skewness magnitude of a</span>
<span class="s2">        `scipy.stats.skewnorm` distribution is approximately 0.9952717; if the</span>
<span class="s2">        magnitude of the data&#39;s sample skewness exceeds this, the returned</span>
<span class="s2">        shape parameter ``a`` will be infinite.</span>
<span class="s2">        </span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;superfit&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">num_censored</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># this extracts fixed shape, location, and scale however they</span>
        <span class="c1"># are specified, and also leaves them in `kwds`</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">fa</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                             <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">method</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">,</span> <span class="s2">&quot;mle&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="c1"># See https://en.wikipedia.org/wiki/Skew_normal_distribution for</span>
        <span class="c1"># moment formulas.</span>
        <span class="k">def</span> <span class="nf">skew_d</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>  <span class="c1"># skewness in terms of delta</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">4</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="p">((</span><span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span>
                                  <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">d_skew</span><span class="p">(</span><span class="n">skew</span><span class="p">):</span>  <span class="c1"># delta in terms of skewness</span>
            <span class="n">s_23</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">skew</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s_23</span> <span class="o">/</span> <span class="p">(</span><span class="n">s_23</span> <span class="o">+</span> <span class="p">((</span><span class="mi">4</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="c1"># If method is method of moments, we don&#39;t need the user&#39;s guesses.</span>
        <span class="c1"># Otherwise, extract the guesses from args and kwds.</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;mm&quot;</span><span class="p">:</span>
            <span class="n">a</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fa</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># not fixed and no guess: use MoM</span>
            <span class="c1"># Solve for a that matches sample distribution skewness to sample</span>
            <span class="c1"># skewness.</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">skew</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mle&#39;</span><span class="p">:</span>
                <span class="c1"># For MLE initial conditions, clip skewness to a large but</span>
                <span class="c1"># reasonable value in case the data skewness is out-of-range.</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">s_max</span> <span class="o">=</span> <span class="n">skew_d</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">-</span><span class="n">s_max</span><span class="p">,</span> <span class="n">s_max</span><span class="p">)</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">d_skew</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">fa</span> <span class="k">if</span> <span class="n">fa</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">a</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">loc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="n">scale</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>

        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># At this point, parameter &quot;guesses&quot; may equal the fixed parameters</span>
            <span class="c1"># in kwds. No harm in passing them as guesses, too.</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">skewnorm</span> <span class="o">=</span> <span class="n">skewnorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;skewnorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">trapezoid_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A trapezoidal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The trapezoidal distribution can be represented with an up-sloping line</span>
<span class="sd">    from ``loc`` to ``(loc + c*scale)``, then constant to ``(loc + d*scale)``</span>
<span class="sd">    and then downsloping from ``(loc + d*scale)`` to ``(loc+scale)``.  This</span>
<span class="sd">    defines the trapezoid base from ``loc`` to ``(loc+scale)`` and the flat</span>
<span class="sd">    top from ``c`` to ``d`` proportional to the position along the base</span>
<span class="sd">    with ``0 &lt;= c &lt;= d &lt;= 1``.  When ``c=d``, this is equivalent to `triang`</span>
<span class="sd">    with the same values for `loc`, `scale` and `c`.</span>
<span class="sd">    The method of [1]_ is used for computing moments.</span>

<span class="sd">    `trapezoid` takes :math:`c` and :math:`d` as shape parameters.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The standard form is in the range [0, 1] with c the mode.</span>
<span class="sd">    The location parameter shifts the start to `loc`.</span>
<span class="sd">    The scale parameter changes the width from 1 to `scale`.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Kacker, R.N. and Lawrence, J.F. (2007). Trapezoidal and triangular</span>
<span class="sd">       distributions for Type B evaluation of standard uncertainty.</span>
<span class="sd">       Metrologia 44, 117-127. :doi:`10.1088/0026-1394/44/2/003`</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ic</span><span class="p">,</span> <span class="nb">id</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">),</span>
                            <span class="n">x</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">],</span>
                           <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span><span class="p">,</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">d</span><span class="p">)],</span>
                           <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">u</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                            <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">),</span>
                            <span class="n">x</span> <span class="o">&gt;</span> <span class="n">d</span><span class="p">],</span>
                           <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">c</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span><span class="n">c</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">c</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                            <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="mi">1</span><span class="o">-</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
                                               <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">d</span><span class="p">))],</span>
                           <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">qc</span><span class="p">,</span> <span class="n">qd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">condlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span> <span class="o">&lt;</span> <span class="n">qc</span><span class="p">,</span> <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">qd</span><span class="p">,</span> <span class="n">q</span> <span class="o">&gt;</span> <span class="n">qd</span><span class="p">]</span>
        <span class="n">choicelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">q</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="n">c</span><span class="p">)),</span>
                      <span class="mf">0.5</span> <span class="o">*</span> <span class="n">q</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">d</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span>
                      <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">-</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">d</span><span class="p">))]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">condlist</span><span class="p">,</span> <span class="n">choicelist</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># Using the parameterization from Kacker, 2007, with</span>
        <span class="c1"># a=bottom left, c=top left, d=top right, b=bottom right, then</span>
        <span class="c1">#     E[X^n] = h/(n+1)/(n+2) [(b^{n+2}-d^{n+2})/(b-d)</span>
        <span class="c1">#                             - ((c^{n+2} - a^{n+2})/(c-a)]</span>
        <span class="c1"># with h = 2/((b-a) - (d-c)). The corresponding parameterization</span>
        <span class="c1"># in scipy, has a&#39;=loc, c&#39;=loc+c*scale, d&#39;=loc+d*scale, b&#39;=loc+scale,</span>
        <span class="c1"># which for standard form reduces to a&#39;=0, b&#39;=1, c&#39;=c, d&#39;=d.</span>
        <span class="c1"># Substituting into E[X^n] gives the bd&#39; term as (1 - d^{n+2})/(1 - d)</span>
        <span class="c1"># and the ac&#39; term as c^{n-1} for the standard form. The bd&#39; term has</span>
        <span class="c1"># numerical difficulties near d=1, so replace (1 - d^{n+2})/(1-d)</span>
        <span class="c1"># with expm1((n+2)*log(d))/(d-1).</span>
        <span class="c1"># Testing with n=18 for c=(1e-30,1-eps) shows that this is stable.</span>
        <span class="c1"># We still require an explicit test for d=1 to prevent divide by zero,</span>
        <span class="c1"># and now a test for d=0 to prevent log(0).</span>
        <span class="n">ab_term</span> <span class="o">=</span> <span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dc_term</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">(</span>
            <span class="p">[</span><span class="n">d</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">d</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">d</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">],</span>
            <span class="p">[</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
             <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="mf">1.0</span><span class="p">),</span>
             <span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
            <span class="p">[</span><span class="n">d</span><span class="p">])</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">dc_term</span> <span class="o">-</span> <span class="n">ab_term</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="c1"># Using the parameterization from Wikipedia (van Dorp, 2003)</span>
        <span class="c1"># with a=bottom left, c=top left, d=top right, b=bottom right</span>
        <span class="c1"># gives a&#39;=loc, b&#39;=loc+c*scale, c&#39;=loc+d*scale, d&#39;=loc+scale,</span>
        <span class="c1"># which for loc=0, scale=1 is a&#39;=0, b&#39;=c, c&#39;=d, d&#39;=1.</span>
        <span class="c1"># Substituting into the entropy formula from Wikipedia gives</span>
        <span class="c1"># the following result.</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">d</span><span class="o">+</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">d</span><span class="o">-</span><span class="n">c</span><span class="p">))</span>


<span class="n">trapezoid</span> <span class="o">=</span> <span class="n">trapezoid_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trapezoid&quot;</span><span class="p">)</span>
<span class="c1"># Note: alias kept for backwards compatibility. Rename was done</span>
<span class="c1"># because trapz is a slur in colloquial English (see gh-12924).</span>
<span class="n">trapz</span> <span class="o">=</span> <span class="n">trapezoid_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;trapz&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">trapz</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">:</span>
    <span class="n">trapz</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="s2">&quot;trapz is an alias for `trapezoid`&quot;</span>


<span class="k">class</span> <span class="nc">triang_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A triangular continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The triangular distribution can be represented with an up-sloping line from</span>
<span class="sd">    ``loc`` to ``(loc + c*scale)`` and then downsloping for ``(loc + c*scale)``</span>
<span class="sd">    to ``(loc + scale)``.</span>

<span class="sd">    `triang` takes ``c`` as a shape parameter for :math:`0 \le c \le 1`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    The standard form is in the range [0, 1] with c the mode.</span>
<span class="sd">    The location parameter shifts the start to `loc`.</span>
<span class="sd">    The scale parameter changes the width from 1 to `scale`.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">triangular</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># 0: edge case where c=0</span>
        <span class="c1"># 1: generalised case for x &lt; c, don&#39;t use x &lt;= c, as it doesn&#39;t cope</span>
        <span class="c1">#    with c = 0.</span>
        <span class="c1"># 2: generalised case for x &gt;= c, but doesn&#39;t cope with c = 1</span>
        <span class="c1"># 3: edge case where c=1</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                         <span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">_lazyselect</span><span class="p">([</span><span class="n">c</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                         <span class="n">x</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span>
                         <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="n">c</span> <span class="o">==</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">c</span><span class="p">,</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                         <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">],</span>
                        <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">c</span> <span class="o">*</span> <span class="n">q</span><span class="p">),</span> <span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">c</span><span class="o">+</span><span class="mf">1.0</span><span class="p">)</span><span class="o">/</span><span class="mf">3.0</span><span class="p">,</span>
                <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="mi">18</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">((</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">),</span> <span class="mf">1.5</span><span class="p">)),</span>
                <span class="o">-</span><span class="mf">3.0</span><span class="o">/</span><span class="mf">5.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>


<span class="n">triang</span> <span class="o">=</span> <span class="n">triang_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;triang&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">truncexpon_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A truncated exponential continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `truncexpon` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b) = \frac{\exp(-x)}{1 - \exp(-b)}</span>

<span class="sd">    for :math:`0 &lt;= x &lt;= b`.</span>

<span class="sd">    `truncexpon` takes ``b`` as a shape parameter for :math:`b`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># truncexpon.pdf(x, b) = exp(-x) / (1-exp(-b))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">q</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">q</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># wrong answer with formula, same as in continuous.pdf</span>
        <span class="c1"># return sc.gamman+1)-sc.gammainc1+n, b)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># return generic for higher moments</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_munp</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">eB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">eB</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">eB</span><span class="o">*</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="mf">1.0</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">eB</span><span class="p">)</span>


<span class="n">truncexpon</span> <span class="o">=</span> <span class="n">truncexpon_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;truncexpon&#39;</span><span class="p">)</span>


<span class="c1"># logsumexp trick for log(p + q) with only log(p) and log(q)</span>
<span class="k">def</span> <span class="nf">_log_sum</span><span class="p">(</span><span class="n">log_p</span><span class="p">,</span> <span class="n">log_q</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">logsumexp</span><span class="p">([</span><span class="n">log_p</span><span class="p">,</span> <span class="n">log_q</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># same as above, but using -exp(x) = exp(x + πi)</span>
<span class="k">def</span> <span class="nf">_log_diff</span><span class="p">(</span><span class="n">log_p</span><span class="p">,</span> <span class="n">log_q</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">logsumexp</span><span class="p">([</span><span class="n">log_p</span><span class="p">,</span> <span class="n">log_q</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Log of Gaussian probability mass within an interval&quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="c1"># Calculations in right tail are inaccurate, so we&#39;ll exploit the</span>
    <span class="c1"># symmetry and work only in the left tail</span>
    <span class="n">case_left</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&lt;=</span> <span class="mi">0</span>
    <span class="n">case_right</span> <span class="o">=</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="n">case_central</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">case_left</span> <span class="o">|</span> <span class="n">case_right</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mass_case_left</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_log_diff</span><span class="p">(</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">mass_case_right</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mass_case_left</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mass_case_central</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># Previously, this was implemented as:</span>
        <span class="c1"># left_mass = mass_case_left(a, 0)</span>
        <span class="c1"># right_mass = mass_case_right(0, b)</span>
        <span class="c1"># return _log_sum(left_mass, right_mass)</span>
        <span class="c1"># Catastrophic cancellation occurs as np.exp(log_mass) approaches 1.</span>
        <span class="c1"># Correct for this with an alternative formulation.</span>
        <span class="c1"># We&#39;re not concerned with underflow here: if only one term</span>
        <span class="c1"># underflows, it was insignificant; if both terms underflow,</span>
        <span class="c1"># the result can&#39;t accurately be represented in logspace anyway</span>
        <span class="c1"># because sc.log1p(x) ~ x for small x.</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">))</span>

    <span class="c1"># _lazyselect not working; don&#39;t care to debug it</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">case_left</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">case_left</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_case_left</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">case_left</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">case_left</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">case_right</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">case_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_case_right</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">case_right</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">case_right</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">case_central</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">case_central</span><span class="p">]</span> <span class="o">=</span> <span class="n">mass_case_central</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">case_central</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">case_central</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>  <span class="c1"># discard ~0j</span>


<span class="k">class</span> <span class="nc">truncnorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A truncated normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This distribution is the normal distribution centered on ``loc`` (default</span>
<span class="sd">    0), with standard deviation ``scale`` (default 1), and truncated at ``a``</span>
<span class="sd">    and ``b`` *standard deviations* from ``loc``. For arbitrary ``loc`` and</span>
<span class="sd">    ``scale``, ``a`` and ``b`` are *not* the abscissae at which the shifted</span>
<span class="sd">    and scaled distribution is truncated.</span>

<span class="sd">    .. note::</span>
<span class="sd">        If ``a_trunc`` and ``b_trunc`` are the abscissae at which we wish</span>
<span class="sd">        to truncate the distribution (as opposed to the number of standard</span>
<span class="sd">        deviations from ``loc``), then we can calculate the distribution</span>
<span class="sd">        parameters ``a`` and ``b`` as follows::</span>

<span class="sd">            a, b = (a_trunc - loc) / scale, (b_trunc - loc) / scale</span>

<span class="sd">        This is a common point of confusion. For additional clarification,</span>
<span class="sd">        please see the example below.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    In the examples above, ``loc=0`` and ``scale=1``, so the plot is truncated</span>
<span class="sd">    at ``a`` on the left and ``b`` on the right. However, suppose we were to</span>
<span class="sd">    produce the same histogram with ``loc = 1`` and ``scale=0.5``.</span>

<span class="sd">    &gt;&gt;&gt; loc, scale = 1, 0.5</span>
<span class="sd">    &gt;&gt;&gt; rv = truncnorm(a, b, loc=loc, scale=scale)</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(truncnorm.ppf(0.01, a, b),</span>
<span class="sd">    ...                 truncnorm.ppf(0.99, a, b), 100)</span>
<span class="sd">    &gt;&gt;&gt; r = rv.rvs(size=1000)</span>

<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, rv.pdf(x), &#39;k-&#39;, lw=2, label=&#39;frozen pdf&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(r, density=True, bins=&#39;auto&#39;, histtype=&#39;stepfilled&#39;, alpha=0.2)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlim(a, b)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend(loc=&#39;best&#39;, frameon=False)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    Note that the distribution is no longer appears to be truncated at</span>
<span class="sd">    abscissae ``a`` and ``b``. That is because the *standard* normal</span>
<span class="sd">    distribution is first truncated at ``a`` and ``b``, *then* the resulting</span>
<span class="sd">    distribution is scaled by ``scale`` and shifted by ``loc``. If we instead</span>
<span class="sd">    want the shifted and scaled distribution to be truncated at ``a`` and</span>
<span class="sd">    ``b``, we need to transform these values before passing them as the</span>
<span class="sd">    distribution parameters.</span>

<span class="sd">    &gt;&gt;&gt; a_transformed, b_transformed = (a - loc) / scale, (b - loc) / scale</span>
<span class="sd">    &gt;&gt;&gt; rv = truncnorm(a_transformed, b_transformed, loc=loc, scale=scale)</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(truncnorm.ppf(0.01, a, b),</span>
<span class="sd">    ...                 truncnorm.ppf(0.99, a, b), 100)</span>
<span class="sd">    &gt;&gt;&gt; r = rv.rvs(size=10000)</span>

<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, rv.pdf(x), &#39;k-&#39;, lw=2, label=&#39;frozen pdf&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(r, density=True, bins=&#39;auto&#39;, histtype=&#39;stepfilled&#39;, alpha=0.2)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_xlim(a-0.1, b+0.1)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend(loc=&#39;best&#39;, frameon=False)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ia</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ia</span><span class="p">,</span> <span class="n">ib</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Reasonable, since support is [a, b]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_norm_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">logcdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">logcdf</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.1</span>  <span class="c1"># avoid catastrophic cancellation</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">logcdf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">logcdf</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">logsf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">logsf</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.1</span>  <span class="c1"># avoid catastrophic cancellation</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">logsf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        <span class="k">return</span> <span class="n">logsf</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">B</span> <span class="o">-</span> <span class="n">A</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">e</span><span class="p">)</span> <span class="o">*</span> <span class="n">Z</span><span class="p">)</span>
        <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span> <span class="o">*</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Z</span><span class="p">)</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span>
        <span class="k">return</span> <span class="n">h</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="n">case_left</span> <span class="o">=</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="n">case_right</span> <span class="o">=</span> <span class="o">~</span><span class="n">case_left</span>

        <span class="k">def</span> <span class="nf">ppf_left</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="n">log_Phi_x</span> <span class="o">=</span> <span class="n">_log_sum</span><span class="p">(</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ndtri_exp</span><span class="p">(</span><span class="n">log_Phi_x</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">ppf_right</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="n">log_Phi_x</span> <span class="o">=</span> <span class="n">_log_sum</span><span class="p">(</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="p">),</span>
                                 <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">ndtri_exp</span><span class="p">(</span><span class="n">log_Phi_x</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

        <span class="n">q_left</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">case_left</span><span class="p">]</span>
        <span class="n">q_right</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">case_right</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">q_left</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">case_left</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppf_left</span><span class="p">(</span><span class="n">q_left</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">case_left</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">case_left</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">q_right</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">case_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">ppf_right</span><span class="p">(</span><span class="n">q_right</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">case_right</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">case_right</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="c1"># Mostly copy-paste of _ppf, but I think this is simpler than combining</span>
        <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="n">case_left</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="n">case_right</span> <span class="o">=</span> <span class="o">~</span><span class="n">case_left</span>

        <span class="k">def</span> <span class="nf">isf_left</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="n">log_Phi_x</span> <span class="o">=</span> <span class="n">_log_diff</span><span class="p">(</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="n">b</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">ndtri_exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">log_Phi_x</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">isf_right</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
            <span class="n">log_Phi_x</span> <span class="o">=</span> <span class="n">_log_diff</span><span class="p">(</span><span class="n">_norm_logcdf</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">),</span>
                                  <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="n">_log_gauss_mass</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">sc</span><span class="o">.</span><span class="n">ndtri_exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">log_Phi_x</span><span class="p">))</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

        <span class="n">q_left</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">case_left</span><span class="p">]</span>
        <span class="n">q_right</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">case_right</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">q_left</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">case_left</span><span class="p">]</span> <span class="o">=</span> <span class="n">isf_left</span><span class="p">(</span><span class="n">q_left</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">case_left</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">case_left</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">q_right</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[</span><span class="n">case_right</span><span class="p">]</span> <span class="o">=</span> <span class="n">isf_right</span><span class="p">(</span><span class="n">q_right</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">case_right</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">case_right</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">n_th_moment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns n-th moment. Defined only if n &gt;= 0.</span>
<span class="sd">            Function cannot broadcast due to the loop over n</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pA</span><span class="p">,</span> <span class="o">-</span><span class="n">pB</span><span class="p">]</span>
            <span class="n">moments</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># a or b might be infinite, and the corresponding pdf value</span>
                <span class="c1"># is 0 in that case, but nan is returned for the</span>
                <span class="c1"># multiplication.  However, as b-&gt;infinity,  pdf(b)*b**k -&gt; 0.</span>
                <span class="c1"># So it is safe to use _lazywhere to avoid the nan.</span>
                <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span>
                                  <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">mk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">moments</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">moments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mk</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">moments</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">((</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">n_th_moment</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]),</span>
                          <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">moments</span><span class="o">=</span><span class="s1">&#39;mv&#39;</span><span class="p">):</span>
        <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]),</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_truncnorm_stats_scalar</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">,</span> <span class="n">moments</span><span class="p">):</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">pA</span> <span class="o">-</span> <span class="n">pB</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">m1</span>
            <span class="c1"># use _lazywhere to avoid nan (See detailed comment in _munp)</span>
            <span class="n">probs</span> <span class="o">=</span> <span class="p">[</span><span class="n">pA</span><span class="p">,</span> <span class="o">-</span><span class="n">pB</span><span class="p">]</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">mu</span><span class="p">,</span> <span class="n">b</span><span class="o">-</span><span class="n">mu</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># mu2 = m2 - mu**2, but not as numerically stable as:</span>
            <span class="c1"># mu2 = (a-mu)*pA - (b-mu)*pB + 1</span>
            <span class="n">mu2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">m3</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">m1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">probs</span><span class="p">,</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]],</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">,</span>
                              <span class="n">fillvalue</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">m4</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">m2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>

            <span class="n">mu3</span> <span class="o">=</span> <span class="n">m3</span> <span class="o">+</span> <span class="n">m1</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">m2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">g1</span> <span class="o">=</span> <span class="n">mu3</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">mu2</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
            <span class="n">mu4</span> <span class="o">=</span> <span class="n">m4</span> <span class="o">+</span> <span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">m3</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">m1</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m2</span> <span class="o">-</span> <span class="n">m1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">g2</span> <span class="o">=</span> <span class="n">mu4</span> <span class="o">/</span> <span class="n">mu2</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">3</span>
            <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g2</span>

        <span class="n">_truncnorm_stats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">_truncnorm_stats_scalar</span><span class="p">,</span>
                                        <span class="n">excluded</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;moments&#39;</span><span class="p">,))</span>
        <span class="k">return</span> <span class="n">_truncnorm_stats</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">pA</span><span class="p">,</span> <span class="n">pB</span><span class="p">,</span> <span class="n">moments</span><span class="p">)</span>


<span class="n">truncnorm</span> <span class="o">=</span> <span class="n">truncnorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;truncnorm&#39;</span><span class="p">,</span> <span class="n">momtype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">truncpareto_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;An upper truncated Pareto continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    pareto : Pareto distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `truncpareto` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, b, c) = \frac{b}{1 - c^{-b}} \frac{1}{x^{b+1}}</span>

<span class="sd">    for :math:`b &gt; 0`, :math:`c &gt; 1` and :math:`1 \le x \le c`.</span>

<span class="sd">    `truncpareto` takes `b` and `c` as shape parameters for :math:`b` and</span>
<span class="sd">    :math:`c`.</span>

<span class="sd">    Notice that the upper truncation value :math:`c` is defined in</span>
<span class="sd">    standardized form so that random values of an unscaled, unshifted variable</span>
<span class="sd">    are within the range ``[1, c]``.</span>
<span class="sd">    If ``u_r`` is the upper bound to a scaled and/or shifted variable,</span>
<span class="sd">    then ``c = (u_r - loc) / scale``. In other words, the support of the</span>
<span class="sd">    distribution becomes ``(scale + loc) &lt;= x &lt;= (c*scale + loc)`` when</span>
<span class="sd">    `scale` and/or `loc` are provided.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Burroughs, S. M., and Tebbens S. F.</span>
<span class="sd">        &quot;Upper-truncated power laws in natural systems.&quot;</span>
<span class="sd">        Pure and Applied Geophysics 158.4 (2001): 741-757.</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ib</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ib</span><span class="p">,</span> <span class="n">ic</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_support</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b</span> <span class="o">*</span> <span class="n">x</span><span class="o">**-</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">expm1</span><span class="p">(</span><span class="o">-</span><span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**-</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**-</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="o">**-</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="o">**-</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">b</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">))</span>
                 <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">b</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="o">**</span><span class="n">b</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">b</span> <span class="o">/</span> <span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">pareto</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>
        <span class="k">return</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;superfit&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">log_mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">harm_mean</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">get_b</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">loc</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>
            <span class="n">harm_m</span> <span class="o">=</span> <span class="n">harm_mean</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">log_m</span> <span class="o">=</span> <span class="n">log_mean</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">quot</span> <span class="o">=</span> <span class="p">(</span><span class="n">harm_m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">log_m</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">quot</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">quot</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">c</span><span class="p">)</span><span class="o">*</span><span class="n">harm_m</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)))</span><span class="o">/</span><span class="n">log_m</span>

        <span class="k">def</span> <span class="nf">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>

        <span class="k">def</span> <span class="nf">get_loc</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">fscale</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fscale</span><span class="p">:</span>  <span class="c1"># (fscale and fc) or (fscale and not fc)</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">mn</span> <span class="o">-</span> <span class="n">fscale</span>
                <span class="k">return</span> <span class="n">loc</span>
            <span class="k">if</span> <span class="n">fc</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="p">(</span><span class="n">fc</span><span class="o">*</span><span class="n">mn</span> <span class="o">-</span> <span class="n">mx</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fc</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">loc</span>

        <span class="k">def</span> <span class="nf">get_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">mn</span> <span class="o">-</span> <span class="n">loc</span>

        <span class="c1"># Functions used for optimisation; partial derivatives of</span>
        <span class="c1"># the Lagrangian, set to equal 0.</span>

        <span class="k">def</span> <span class="nf">dL_dLoc</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">b_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="c1"># Partial derivative wrt location.</span>
            <span class="c1"># Optimised upon when no parameters, or only b, are fixed.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">get_b</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span> <span class="k">if</span> <span class="n">b_</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">b_</span>
            <span class="n">harm_m</span> <span class="o">=</span> <span class="n">harm_mean</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">harm_m</span>

        <span class="k">def</span> <span class="nf">dL_dB</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">logc</span><span class="p">,</span> <span class="n">logm</span><span class="p">):</span>
            <span class="c1"># Partial derivative wrt b.</span>
            <span class="c1"># Optimised upon whenever at least one parameter but b is fixed,</span>
            <span class="c1"># and b is free.</span>
            <span class="k">return</span> <span class="n">b</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">logc</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">logm</span><span class="p">))</span> <span class="o">/</span> <span class="n">logc</span>

        <span class="k">def</span> <span class="nf">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="c1"># Should any issue arise, default to the general fit method.</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">truncpareto_gen</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">parameters</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">fb</span><span class="p">,</span> <span class="n">fc</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">parameters</span>
        <span class="n">mn</span><span class="p">,</span> <span class="n">mx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">mn_inf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">fb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">fc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed.&quot;</span>
                             <span class="s2">&quot;There is nothing to optimize.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">fc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">cond_b</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
                    <span class="c1"># b is positive only if this function is positive</span>
                    <span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="n">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
                    <span class="n">harm_m</span> <span class="o">=</span> <span class="n">harm_mean</span><span class="p">((</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span><span class="p">)</span>
                    <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">harm_m</span> <span class="o">-</span> <span class="mi">1</span>

                <span class="c1"># This gives an upper bound on loc allowing for a positive b.</span>
                <span class="c1"># Iteratively look for a bracket for root_scalar.</span>
                <span class="n">mn_inf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">mn</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="n">rbrack</span> <span class="o">=</span> <span class="n">mn_inf</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">while</span> <span class="p">((</span><span class="n">lbrack</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                       <span class="ow">and</span> <span class="p">(</span><span class="n">cond_b</span><span class="p">(</span><span class="n">lbrack</span><span class="p">)</span><span class="o">*</span><span class="n">cond_b</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lbrack</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">cond_b</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

                <span class="c1"># Determine the MLE for loc.</span>
                <span class="c1"># Iteratively look for a bracket for root_scalar.</span>
                <span class="n">rbrack</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span> <span class="o">-</span> <span class="mf">1e-3</span>  <span class="c1"># grad_loc is numerically ill-behaved</span>
                <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="p">((</span><span class="n">lbrack</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                       <span class="ow">and</span> <span class="p">(</span><span class="n">dL_dLoc</span><span class="p">(</span><span class="n">lbrack</span><span class="p">)</span><span class="o">*</span><span class="n">dL_dLoc</span><span class="p">(</span><span class="n">rbrack</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mf">2.</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lbrack</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">dL_dLoc</span><span class="p">,</span> <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">get_b</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

                <span class="n">std_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>
                <span class="c1"># The expression of b relies on b being bounded above.</span>
                <span class="n">up_bound_b</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">log_mean</span><span class="p">(</span><span class="n">std_data</span><span class="p">),</span>
                                 <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">harm_mean</span><span class="p">(</span><span class="n">std_data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">up_bound_b</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># We know b is positive (or a FitError will be triggered)</span>
                <span class="c1"># so we let loc get close to min(data).</span>
                <span class="n">rbrack</span> <span class="o">=</span> <span class="n">mn_inf</span>
                <span class="n">lbrack</span> <span class="o">=</span> <span class="n">mn_inf</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># Iteratively look for a bracket for root_scalar.</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">lbrack</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                       <span class="ow">and</span> <span class="p">(</span><span class="n">dL_dLoc</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span>
                            <span class="o">*</span> <span class="n">dL_dLoc</span><span class="p">(</span><span class="n">rbrack</span><span class="p">,</span> <span class="n">fb</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)):</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">lbrack</span> <span class="o">=</span> <span class="n">rbrack</span> <span class="o">-</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">lbrack</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">dL_dLoc</span><span class="p">,</span> <span class="p">(</span><span class="n">fb</span><span class="p">,),</span>
                                  <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">fb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># At least one of the parameters determining the support is fixed;</span>
            <span class="c1"># the others then have analytical expressions from the constraints.</span>
            <span class="c1"># The completely determined case (fixed c, loc and scale)</span>
            <span class="c1"># has to be checked for not overflowing the support.</span>
            <span class="c1"># If not fixed, b has to be determined numerically.</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span> <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">get_loc</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">fscale</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span> <span class="ow">or</span> <span class="n">get_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">fc</span> <span class="ow">or</span> <span class="n">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>

            <span class="c1"># Unscaled, translated values should be positive when the location</span>
            <span class="c1"># is fixed. If it is not the case, we end up with negative `scale`</span>
            <span class="c1"># and `c`, which would trigger a FitError before exiting the</span>
            <span class="c1"># method.</span>
            <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">floc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;truncpareto&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>

            <span class="c1"># Standardised values should be within the distribution support</span>
            <span class="c1"># when all parameters controlling it are fixed. If it not the case,</span>
            <span class="c1"># `fc` is overridden by `c` determined from `floc` and `fscale` when</span>
            <span class="c1"># raising the exception.</span>
            <span class="k">if</span> <span class="n">fc</span> <span class="ow">and</span> <span class="p">(</span><span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fscale</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">fc</span><span class="o">*</span><span class="n">fscale</span> <span class="o">+</span> <span class="n">floc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;truncpareto&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">upper</span><span class="o">=</span><span class="n">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">))</span>

            <span class="c1"># The other constraints should be automatically satisfied</span>
            <span class="c1"># from the analytical expressions of the parameters.</span>
            <span class="c1"># If fc or fscale are respectively less than one or less than 0,</span>
            <span class="c1"># a FitError is triggered before exiting the method.</span>

            <span class="k">if</span> <span class="n">fb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">std_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">loc</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>
                <span class="n">logm</span> <span class="o">=</span> <span class="n">log_mean</span><span class="p">(</span><span class="n">std_data</span><span class="p">)</span>
                <span class="n">logc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="c1"># Condition for a positive root to exist.</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">logm</span> <span class="o">&lt;</span> <span class="n">logc</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

                <span class="n">lbrack</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">logm</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">logm</span> <span class="o">-</span> <span class="n">logc</span><span class="p">)</span>
                <span class="n">rbrack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">logm</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">dL_dB</span><span class="p">,</span> <span class="p">(</span><span class="n">logc</span><span class="p">,</span> <span class="n">logm</span><span class="p">),</span>
                                      <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lbrack</span><span class="p">,</span> <span class="n">rbrack</span><span class="p">))</span>
                    <span class="c1"># we should then never get there</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">converged</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">root</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="n">rbrack</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">fb</span>

        <span class="c1"># The distribution requires that `scale+loc &lt;= data &lt;= c*scale+loc`.</span>
        <span class="c1"># To avoid numerical issues, some tuning may be necessary.</span>
        <span class="c1"># We adjust `scale` to satisfy the lower bound, and we adjust</span>
        <span class="c1"># `c` to satisfy the upper bound.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">scale</span><span class="o">+</span><span class="n">loc</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">mn</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fscale</span><span class="p">:</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">get_scale</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">c</span><span class="o">*</span><span class="n">scale</span><span class="o">+</span><span class="n">loc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">mx</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">get_c</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nextafter</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_argcheck</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">scale</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">params_override</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>
        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Based on testing in gh-16782, the following methods are only</span>
            <span class="c1"># reliable if either `floc` or `fscale` are provided. They are</span>
            <span class="c1"># fast, though, so might as well see if they are better than the</span>
            <span class="c1"># generic method.</span>
            <span class="n">params_super</span> <span class="o">=</span> <span class="n">fallback</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
            <span class="n">nllf_override</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnlf</span><span class="p">(</span><span class="n">params_override</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="n">nllf_super</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nnlf</span><span class="p">(</span><span class="n">params_super</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nllf_super</span> <span class="o">&lt;</span> <span class="n">nllf_override</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">params_super</span>

        <span class="k">return</span> <span class="n">params_override</span>


<span class="n">truncpareto</span> <span class="o">=</span> <span class="n">truncpareto_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;truncpareto&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">tukeylambda_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Tukey-Lamdba continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    A flexible distribution, able to represent and interpolate between the</span>
<span class="sd">    following distributions:</span>

<span class="sd">    - Cauchy                (:math:`lambda = -1`)</span>
<span class="sd">    - logistic              (:math:`lambda = 0`)</span>
<span class="sd">    - approx Normal         (:math:`lambda = 0.14`)</span>
<span class="sd">    - uniform from -1 to 1  (:math:`lambda = 1`)</span>

<span class="sd">    `tukeylambda` takes a real number :math:`lambda` (denoted ``lam``</span>
<span class="sd">    in the implementation) as a shape parameter.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;lam&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="n">Fx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">tklmbda</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">))</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="n">Fx</span><span class="o">**</span><span class="p">(</span><span class="n">lam</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Fx</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="n">lam</span><span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="n">Px</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Px</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">lam</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">lam</span><span class="p">)),</span> <span class="n">Px</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">tklmbda</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">boxcox</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">boxcox1p</span><span class="p">(</span><span class="o">-</span><span class="n">q</span><span class="p">,</span> <span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_tlvar</span><span class="p">(</span><span class="n">lam</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">_tlkurt</span><span class="p">(</span><span class="n">lam</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lam</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">integ</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lam</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p</span><span class="p">,</span> <span class="n">lam</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">integ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">tukeylambda</span> <span class="o">=</span> <span class="n">tukeylambda_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tukeylambda&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">FitUniformFixedScaleDataError</span><span class="p">(</span><span class="n">FitDataError</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptp</span><span class="p">,</span> <span class="n">fscale</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;Invalid values in `data`.  Maximum likelihood estimation with &quot;</span>
            <span class="s2">&quot;the uniform distribution and fixed scale requires that &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;np.ptp(data) &lt;= fscale, but np.ptp(data) = </span><span class="si">{</span><span class="n">ptp</span><span class="si">}</span><span class="s2"> and &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;fscale = </span><span class="si">{</span><span class="n">fscale</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">uniform_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A uniform continuous random variable.</span>

<span class="sd">    In the standard form, the distribution is uniform on ``[0, 1]``. Using</span>
<span class="sd">    the parameters ``loc`` and ``scale``, one obtains the uniform distribution</span>
<span class="sd">    on ``[loc, loc + scale]``.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">q</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="nd">@_call_super_mom</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maximum likelihood estimate for the location and scale parameters.</span>

<span class="sd">        `uniform.fit` uses only the following parameters.  Because exact</span>
<span class="sd">        formulas are used, the parameters related to optimization that are</span>
<span class="sd">        available in the `fit` method of other distributions are ignored</span>
<span class="sd">        here.  The only positional argument accepted is `data`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : array_like</span>
<span class="sd">            Data to use in calculating the maximum likelihood estimate.</span>
<span class="sd">        floc : float, optional</span>
<span class="sd">            Hold the location parameter fixed to the specified value.</span>
<span class="sd">        fscale : float, optional</span>
<span class="sd">            Hold the scale parameter fixed to the specified value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loc, scale : float</span>
<span class="sd">            Maximum likelihood estimates for the location and scale.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        An error is raised if `floc` is given and any values in `data` are</span>
<span class="sd">        less than `floc`, or if `fscale` is given and `fscale` is less</span>
<span class="sd">        than ``data.max() - data.min()``.  An error is also raised if both</span>
<span class="sd">        `floc` and `fscale` are given.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from scipy.stats import uniform</span>

<span class="sd">        We&#39;ll fit the uniform distribution to `x`:</span>

<span class="sd">        &gt;&gt;&gt; x = np.array([2, 2.5, 3.1, 9.5, 13.0])</span>

<span class="sd">        For a uniform distribution MLE, the location is the minimum of the</span>
<span class="sd">        data, and the scale is the maximum minus the minimum.</span>

<span class="sd">        &gt;&gt;&gt; loc, scale = uniform.fit(x)</span>
<span class="sd">        &gt;&gt;&gt; loc</span>
<span class="sd">        2.0</span>
<span class="sd">        &gt;&gt;&gt; scale</span>
<span class="sd">        11.0</span>

<span class="sd">        If we know the data comes from a uniform distribution where the support</span>
<span class="sd">        starts at 0, we can use `floc=0`:</span>

<span class="sd">        &gt;&gt;&gt; loc, scale = uniform.fit(x, floc=0)</span>
<span class="sd">        &gt;&gt;&gt; loc</span>
<span class="sd">        0.0</span>
<span class="sd">        &gt;&gt;&gt; scale</span>
<span class="sd">        13.0</span>

<span class="sd">        Alternatively, if we know the length of the support is 12, we can use</span>
<span class="sd">        `fscale=12`:</span>

<span class="sd">        &gt;&gt;&gt; loc, scale = uniform.fit(x, fscale=12)</span>
<span class="sd">        &gt;&gt;&gt; loc</span>
<span class="sd">        1.5</span>
<span class="sd">        &gt;&gt;&gt; scale</span>
<span class="sd">        12.0</span>

<span class="sd">        In that last example, the support interval is [1.5, 13.5].  This</span>
<span class="sd">        solution is not unique.  For example, the distribution with ``loc=2``</span>
<span class="sd">        and ``scale=12`` has the same likelihood as the one above.  When</span>
<span class="sd">        `fscale` is given and it is larger than ``data.max() - data.min()``,</span>
<span class="sd">        the parameters returned by the `fit` method center the support over</span>
<span class="sd">        the interval ``[data.min(), data.max()]``.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Too many arguments.&quot;</span><span class="p">)</span>

        <span class="n">floc</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;floc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">fscale</span> <span class="o">=</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fscale&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_remove_optimizer_parameters</span><span class="p">(</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This check is for consistency with `rv_continuous.fit`.</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All parameters fixed. There is nothing to &quot;</span>
                             <span class="s2">&quot;optimize.&quot;</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The data contains non-finite values.&quot;</span><span class="p">)</span>

        <span class="c1"># MLE for the uniform distribution</span>
        <span class="c1"># --------------------------------</span>
        <span class="c1"># The PDF is</span>
        <span class="c1">#</span>
        <span class="c1">#     f(x, loc, scale) = {1/scale  for loc &lt;= x &lt;= loc + scale</span>
        <span class="c1">#                        {0        otherwise}</span>
        <span class="c1">#</span>
        <span class="c1"># The likelihood function is</span>
        <span class="c1">#     L(x, loc, scale) = (1/scale)**n</span>
        <span class="c1"># where n is len(x), assuming loc &lt;= x &lt;= loc + scale for all x.</span>
        <span class="c1"># The log-likelihood is</span>
        <span class="c1">#     l(x, loc, scale) = -n*log(scale)</span>
        <span class="c1"># The log-likelihood is maximized by making scale as small as possible,</span>
        <span class="c1"># while keeping loc &lt;= x &lt;= loc + scale.   So if neither loc nor scale</span>
        <span class="c1"># are fixed, the log-likelihood is maximized by choosing</span>
        <span class="c1">#     loc = x.min()</span>
        <span class="c1">#     scale = np.ptp(x)</span>
        <span class="c1"># If loc is fixed, it must be less than or equal to x.min(), and then</span>
        <span class="c1"># the scale is</span>
        <span class="c1">#     scale = x.max() - loc</span>
        <span class="c1"># If scale is fixed, it must not be less than np.ptp(x).  If scale is</span>
        <span class="c1"># greater than np.ptp(x), the solution is not unique.  Note that the</span>
        <span class="c1"># likelihood does not depend on loc, except for the requirement that</span>
        <span class="c1"># loc &lt;= x &lt;= loc + scale.  All choices of loc for which</span>
        <span class="c1">#     x.max() - scale &lt;= loc &lt;= x.min()</span>
        <span class="c1"># have the same log-likelihood.  In this case, we choose loc such that</span>
        <span class="c1"># the support is centered over the interval [data.min(), data.max()]:</span>
        <span class="c1">#     loc = x.min() = 0.5*(scale - np.ptp(x))</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># scale is not fixed.</span>
            <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># loc is not fixed, scale is not fixed.</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># loc is fixed, scale is not fixed.</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">loc</span>
                <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">loc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">FitDataError</span><span class="p">(</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">loc</span> <span class="o">+</span> <span class="n">scale</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># loc is not fixed, scale is fixed.</span>
            <span class="n">ptp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ptp</span> <span class="o">&gt;</span> <span class="n">fscale</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FitUniformFixedScaleDataError</span><span class="p">(</span><span class="n">ptp</span><span class="o">=</span><span class="n">ptp</span><span class="p">,</span> <span class="n">fscale</span><span class="o">=</span><span class="n">fscale</span><span class="p">)</span>
            <span class="c1"># If ptp &lt; fscale, the ML estimate is not unique; see the comments</span>
            <span class="c1"># above.  We choose the distribution for which the support is</span>
            <span class="c1"># centered over the interval [data.min(), data.max()].</span>
            <span class="n">loc</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fscale</span> <span class="o">-</span> <span class="n">ptp</span><span class="p">)</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">fscale</span>

        <span class="c1"># We expect the return values to be floating point, so ensure it</span>
        <span class="c1"># by explicitly converting to float.</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">loc</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>


<span class="n">uniform</span> <span class="o">=</span> <span class="n">uniform_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">vonmises_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Von Mises continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    scipy.stats.vonmises_fisher : Von-Mises Fisher distribution on a</span>
<span class="sd">                                  hypersphere</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `vonmises` and `vonmises_line` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \kappa) = \frac{ \exp(\kappa \cos(x)) }{ 2 \pi I_0(\kappa) }</span>

<span class="sd">    for :math:`-\pi \le x \le \pi`, :math:`\kappa \ge 0`. :math:`I_0` is the</span>
<span class="sd">    modified Bessel function of order zero (`scipy.special.i0`).</span>

<span class="sd">    `vonmises` is a circular distribution which does not restrict the</span>
<span class="sd">    distribution to a fixed interval. Currently, there is no circular</span>
<span class="sd">    distribution framework in SciPy. The ``cdf`` is implemented such that</span>
<span class="sd">    ``cdf(x + 2*np.pi) == cdf(x) + 1``.</span>

<span class="sd">    `vonmises_line` is the same distribution, defined on :math:`[-\pi, \pi]`</span>
<span class="sd">    on the real line. This is a regular (i.e. non-circular) distribution.</span>

<span class="sd">    Note about distribution parameters: `vonmises` and `vonmises_line` take</span>
<span class="sd">    ``kappa`` as a shape parameter (concentration) and ``loc`` as the location</span>
<span class="sd">    (circular mean). A ``scale`` parameter is accepted but does not have any</span>
<span class="sd">    effect.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    Import the necessary modules.</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; from scipy.stats import vonmises</span>

<span class="sd">    Define distribution parameters.</span>

<span class="sd">    &gt;&gt;&gt; loc = 0.5 * np.pi  # circular mean</span>
<span class="sd">    &gt;&gt;&gt; kappa = 1  # concentration</span>

<span class="sd">    Compute the probability density at ``x=0`` via the ``pdf`` method.</span>

<span class="sd">    &gt;&gt;&gt; vonmises.pdf(0, loc=loc, kappa=kappa)</span>
<span class="sd">    0.12570826359722018</span>

<span class="sd">    Verify that the percentile function ``ppf`` inverts the cumulative</span>
<span class="sd">    distribution function ``cdf`` up to floating point accuracy.</span>

<span class="sd">    &gt;&gt;&gt; x = 1</span>
<span class="sd">    &gt;&gt;&gt; cdf_value = vonmises.cdf(x, loc=loc, kappa=kappa)</span>
<span class="sd">    &gt;&gt;&gt; ppf_value = vonmises.ppf(cdf_value, loc=loc, kappa=kappa)</span>
<span class="sd">    &gt;&gt;&gt; x, cdf_value, ppf_value</span>
<span class="sd">    (1, 0.31489339900904967, 1.0000000000000004)</span>

<span class="sd">    Draw 1000 random variates by calling the ``rvs`` method.</span>

<span class="sd">    &gt;&gt;&gt; sample_size = 1000</span>
<span class="sd">    &gt;&gt;&gt; sample = vonmises(loc=loc, kappa=kappa).rvs(sample_size)</span>

<span class="sd">    Plot the von Mises density on a Cartesian and polar grid to emphasize</span>
<span class="sd">    that it is a circular distribution.</span>

<span class="sd">    &gt;&gt;&gt; fig = plt.figure(figsize=(12, 6))</span>
<span class="sd">    &gt;&gt;&gt; left = plt.subplot(121)</span>
<span class="sd">    &gt;&gt;&gt; right = plt.subplot(122, projection=&#39;polar&#39;)</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(-np.pi, np.pi, 500)</span>
<span class="sd">    &gt;&gt;&gt; vonmises_pdf = vonmises.pdf(x, loc=loc, kappa=kappa)</span>
<span class="sd">    &gt;&gt;&gt; ticks = [0, 0.15, 0.3]</span>

<span class="sd">    The left image contains the Cartesian plot.</span>

<span class="sd">    &gt;&gt;&gt; left.plot(x, vonmises_pdf)</span>
<span class="sd">    &gt;&gt;&gt; left.set_yticks(ticks)</span>
<span class="sd">    &gt;&gt;&gt; number_of_bins = int(np.sqrt(sample_size))</span>
<span class="sd">    &gt;&gt;&gt; left.hist(sample, density=True, bins=number_of_bins)</span>
<span class="sd">    &gt;&gt;&gt; left.set_title(&quot;Cartesian plot&quot;)</span>
<span class="sd">    &gt;&gt;&gt; left.set_xlim(-np.pi, np.pi)</span>
<span class="sd">    &gt;&gt;&gt; left.grid(True)</span>

<span class="sd">    The right image contains the polar plot.</span>

<span class="sd">    &gt;&gt;&gt; right.plot(x, vonmises_pdf, label=&quot;PDF&quot;)</span>
<span class="sd">    &gt;&gt;&gt; right.set_yticks(ticks)</span>
<span class="sd">    &gt;&gt;&gt; right.hist(sample, density=True, bins=number_of_bins,</span>
<span class="sd">    ...            label=&quot;Histogram&quot;)</span>
<span class="sd">    &gt;&gt;&gt; right.set_title(&quot;Polar plot&quot;)</span>
<span class="sd">    &gt;&gt;&gt; right.legend(bbox_to_anchor=(0.15, 1.06))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;kappa&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">kappa</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">vonmises</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">rvs</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">rvs</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="c1"># vonmises.pdf(x, kappa) = exp(kappa * cos(x)) / (2*pi*I[0](kappa))</span>
        <span class="c1">#                        = exp(kappa * (cos(x) - 1)) /</span>
        <span class="c1">#                          (2*pi*exp(-kappa)*I[0](kappa))</span>
        <span class="c1">#                        = exp(kappa * cosm1(x)) / (2*pi*i0e(kappa))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">cosm1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="c1"># vonmises.pdf(x, kappa) = exp(kappa * cosm1(x)) / (2*pi*i0e(kappa))</span>
        <span class="k">return</span> <span class="n">kappa</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">cosm1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_stats</span><span class="o">.</span><span class="n">von_mises_cdf</span><span class="p">(</span><span class="n">kappa</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats_skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
        <span class="c1"># vonmises.entropy(kappa) = -kappa * I[1](kappa) / I[0](kappa) +</span>
        <span class="c1">#                           log(2 * np.pi * I[0](kappa))</span>
        <span class="c1">#                         = -kappa * I[1](kappa) * exp(-kappa) /</span>
        <span class="c1">#                           (I[0](kappa) * exp(-kappa)) +</span>
        <span class="c1">#                           log(2 * np.pi *</span>
        <span class="c1">#                           I[0](kappa) * exp(-kappa) / exp(-kappa))</span>
        <span class="c1">#                         = -kappa * sc.i1e(kappa) / sc.i0e(kappa) +</span>
        <span class="c1">#                           log(2 * np.pi * i0e(kappa)) + kappa</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">i1e</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">/</span> <span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">+</span>
                <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa</span><span class="p">))</span> <span class="o">+</span> <span class="n">kappa</span><span class="p">)</span>

    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        The default limits of integration are endpoints of the interval</span>
<span class="s2">        of width ``2*pi`` centered at `loc` (e.g. ``[-pi, pi]`` when</span>
<span class="s2">        ``loc=0``).</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">expect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">conditional</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>

        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lb</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">+</span> <span class="n">_a</span>
        <span class="k">if</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ub</span> <span class="o">=</span> <span class="n">loc</span> <span class="o">+</span> <span class="n">_b</span>

        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">expect</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span>
                              <span class="n">scale</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">conditional</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="nd">@_call_super_mom</span>
    <span class="nd">@extend_notes_in_docstring</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">,</span> <span class="n">notes</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">        Fit data is assumed to represent angles and will be wrapped onto the</span>
<span class="s2">        unit circle. `f0` and `fscale` are ignored; the returned shape is</span>
<span class="s2">        always the maximum likelihood estimate and the scale is always</span>
<span class="s2">        1. Initial guesses are ignored.</span><span class="se">\n\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwds</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;superfit&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="n">data</span><span class="p">,</span> <span class="n">fshape</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
                                                                 <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
            <span class="c1"># vonmises line case, here the default fit method will be used</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="c1"># wrap data to interval [0, 2*pi]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">find_mu</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">stats</span><span class="o">.</span><span class="n">circmean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">find_kappa</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">):</span>
            <span class="c1"># Usually, sources list the following as the equation to solve for</span>
            <span class="c1"># the MLE of the shape parameter:</span>
            <span class="c1"># r = I[1](kappa)/I[0](kappa), where r = mean resultant length</span>
            <span class="c1"># This is valid when the location is the MLE of location.</span>
            <span class="c1"># More generally, when the location may be fixed at an arbitrary</span>
            <span class="c1"># value, r should be defined as follows:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">loc</span> <span class="o">-</span> <span class="n">data</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="c1"># See gh-18128 for more information.</span>

            <span class="c1"># The function r[0](kappa) := I[1](kappa)/I[0](kappa) is monotonic</span>
            <span class="c1"># increasing from r[0](0) = 0 to r[0](+inf) = 1.  The partial</span>
            <span class="c1"># derivative of the log likelihood function with respect to kappa</span>
            <span class="c1"># is monotonic decreasing in kappa.</span>
            <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># All observations are (almost) equal to the mean.  Return</span>
                <span class="c1"># some large kappa such that r[0](kappa) = 1.0 numerically.</span>
                <span class="k">return</span> <span class="mf">1e16</span>
            <span class="k">elif</span> <span class="n">r</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">def</span> <span class="nf">solve_for_kappa</span><span class="p">(</span><span class="n">kappa</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">i1e</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span><span class="o">.</span><span class="n">i0e</span><span class="p">(</span><span class="n">kappa</span><span class="p">)</span> <span class="o">-</span> <span class="n">r</span>

                <span class="c1"># The bounds of the root of r[0](kappa) = r are derived from</span>
                <span class="c1"># selected bounds of r[0](x) given in [1, Eq. 11 &amp; 16].  See</span>
                <span class="c1"># gh-20102 for details.</span>
                <span class="c1">#</span>
                <span class="c1"># [1] Amos, D. E. (1973).  Computation of Modified Bessel</span>
                <span class="c1">#     Functions and Their Ratios.  Mathematics of Computation,</span>
                <span class="c1">#     28(125): 239-251.</span>
                <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">r</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">r</span><span class="p">)</span>
                <span class="n">upper_bound</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">lower_bound</span>

                <span class="c1"># The bounds are violated numerically for certain values of r,</span>
                <span class="c1"># where solve_for_kappa evaluated at the bounds have the same</span>
                <span class="c1"># sign.  This indicates numerical imprecision of i1e()/i0e().</span>
                <span class="c1"># Return the violated bound in this case as it&#39;s more accurate.</span>
                <span class="k">if</span> <span class="n">solve_for_kappa</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">lower_bound</span>
                <span class="k">elif</span> <span class="n">solve_for_kappa</span><span class="p">(</span><span class="n">upper_bound</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">upper_bound</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">root_res</span> <span class="o">=</span> <span class="n">root_scalar</span><span class="p">(</span><span class="n">solve_for_kappa</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;brentq&quot;</span><span class="p">,</span>
                                           <span class="n">bracket</span><span class="o">=</span><span class="p">(</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">))</span>
                    <span class="k">return</span> <span class="n">root_res</span><span class="o">.</span><span class="n">root</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if the provided floc is very far from the circular mean,</span>
                <span class="c1"># the mean resultant length r can become negative.</span>
                <span class="c1"># In that case, the equation</span>
                <span class="c1"># I[1](kappa)/I[0](kappa) = r does not have a solution.</span>
                <span class="c1"># The maximum likelihood kappa is then 0 which practically</span>
                <span class="c1"># results in the uniform distribution on the circle. As</span>
                <span class="c1"># vonmises is defined for kappa &gt; 0, return instead the</span>
                <span class="c1"># smallest floating point value.</span>
                <span class="c1"># See gh-18190 for more information</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">tiny</span>

        <span class="c1"># location likelihood equation has a solution independent of kappa</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">floc</span> <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">find_mu</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># shape likelihood equation depends on location</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">fshape</span> <span class="k">if</span> <span class="n">fshape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">find_kappa</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">loc</span><span class="p">)</span>

        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">loc</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>  <span class="c1"># ensure in [-pi, pi]</span>
        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="mi">1</span>  <span class="c1"># scale is not handled</span>


<span class="n">vonmises</span> <span class="o">=</span> <span class="n">vonmises_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;vonmises&#39;</span><span class="p">)</span>
<span class="n">vonmises_line</span> <span class="o">=</span> <span class="n">vonmises_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;vonmises_line&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">wald_gen</span><span class="p">(</span><span class="n">invgauss_gen</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Wald continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `wald` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x) = \frac{1}{\sqrt{2\pi x^3}} \exp(- \frac{ (x-1)^2 }{ 2x })</span>

<span class="sd">    for :math:`x &gt;= 0`.</span>

<span class="sd">    `wald` is a special case of `invgauss` with ``mu=1``.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_open_support_mask</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">random_state</span><span class="o">.</span><span class="n">wald</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># wald.pdf(x) = 1/sqrt(2*pi*x**3) * exp(-(x-1)**2/(2*x))</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_isf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_logcdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logsf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_logsf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">15.0</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">invgauss</span><span class="o">.</span><span class="n">_entropy</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>


<span class="n">wald</span> <span class="o">=</span> <span class="n">wald_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;wald&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">wrapcauchy_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A wrapped Cauchy continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `wrapcauchy` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, c) = \frac{1-c^2}{2\pi (1+c^2 - 2c \cos(x))}</span>

<span class="sd">    for :math:`0 \le x \le 2\pi`, :math:`0 &lt; c &lt; 1`.</span>

<span class="sd">    `wrapcauchy` takes ``c`` as a shape parameter for :math:`c`.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="c1"># wrapcauchy.pdf(x, c) = (1-c**2) / (2*pi*(1+c**2-2*c*cos(x)))</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">f1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
            <span class="c1"># CDF for 0 &lt;= x &lt; pi</span>
            <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">cr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">f2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cr</span><span class="p">):</span>
            <span class="c1"># CDF for pi &lt;= x &lt;= 2*pi</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">cr</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>

        <span class="n">cr</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cr</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">f2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">c</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
        <span class="n">rcq</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">q</span><span class="p">))</span>
        <span class="n">rcmq</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">q</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">q</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rcq</span><span class="p">,</span> <span class="n">rcmq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Use 0.5 as the initial guess of the shape parameter.</span>
        <span class="c1"># For the location and scale, use the minimum and</span>
        <span class="c1"># peak-to-peak/(2*pi), respectively.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensor</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>


<span class="n">wrapcauchy</span> <span class="o">=</span> <span class="n">wrapcauchy_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;wrapcauchy&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">gennorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A generalized normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    laplace : Laplace distribution</span>
<span class="sd">    norm : normal distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `gennorm` is [1]_:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \beta) = \frac{\beta}{2 \Gamma(1/\beta)} \exp(-|x|^\beta),</span>

<span class="sd">    where :math:`x` is a real number, :math:`\beta &gt; 0` and</span>
<span class="sd">    :math:`\Gamma` is the gamma function (`scipy.special.gamma`).</span>

<span class="sd">    `gennorm` takes ``beta`` as a shape parameter for :math:`\beta`.</span>
<span class="sd">    For :math:`\beta = 1`, it is identical to a Laplace distribution.</span>
<span class="sd">    For :math:`\beta = 2`, it is identical to a normal distribution</span>
<span class="sd">    (with ``scale=1/sqrt(2)``).</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] &quot;Generalized normal distribution, Version 1&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Generalized_normal_distribution#Version_1</span>

<span class="sd">    .. [2] Nardon, Martina, and Paolo Pianca. &quot;Simulation techniques for</span>
<span class="sd">           generalized Gaussian densities.&quot; Journal of Statistical</span>
<span class="sd">           Computation and Simulation 79.11 (2009): 1317-1329</span>

<span class="sd">    .. [3] Wicklin, Rick. &quot;Simulate data from a generalized Gaussian</span>
<span class="sd">           distribution&quot; in The DO Loop blog, September 21, 2016,</span>
<span class="sd">           https://blogs.sas.com/content/iml/2016/09/21/simulate-generalized-gaussian-sas.html</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">beta</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># evaluating (.5 + c) first prevents numerical cancellation</span>
        <span class="k">return</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="c1"># evaluating (1. + c) first prevents numerical cancellation</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_ppf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="n">c1</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c5</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">([</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="mf">3.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="mf">5.0</span><span class="o">/</span><span class="n">beta</span><span class="p">])</span>
        <span class="k">return</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c3</span> <span class="o">-</span> <span class="n">c1</span><span class="p">),</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c5</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">-</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">c3</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">.5</span> <span class="o">*</span> <span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># see [2]_ for the algorithm</span>
        <span class="c1"># see [3]_ for reference implementation in SAS</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">gamma</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">z</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>
        <span class="c1"># convert y to array to ensure masking support</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.5</span>
        <span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">y</span>


<span class="n">gennorm</span> <span class="o">=</span> <span class="n">gennorm_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;gennorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">halfgennorm_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;The upper half of a generalized normal continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    gennorm : generalized normal distribution</span>
<span class="sd">    expon : exponential distribution</span>
<span class="sd">    halfnorm : half normal distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `halfgennorm` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \beta) = \frac{\beta}{\Gamma(1/\beta)} \exp(-|x|^\beta)</span>

<span class="sd">    for :math:`x, \beta &gt; 0`. :math:`\Gamma` is the gamma function</span>
<span class="sd">    (`scipy.special.gamma`).</span>

<span class="sd">    `halfgennorm` takes ``beta`` as a shape parameter for :math:`\beta`.</span>
<span class="sd">    For :math:`\beta = 1`, it is identical to an exponential distribution.</span>
<span class="sd">    For :math:`\beta = 2`, it is identical to a half normal distribution</span>
<span class="sd">    (with ``scale=1/sqrt(2)``).</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] &quot;Generalized normal distribution, Version 1&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Generalized_normal_distribution#Version_1</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="c1">#                                 beta</span>
        <span class="c1"># halfgennorm.pdf(x, beta) =  -------------  exp(-|x|**beta)</span>
        <span class="c1">#                             gamma(1/beta)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="n">beta</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincinv</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaincc</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainccinv</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammaln</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span>


<span class="n">halfgennorm</span> <span class="o">=</span> <span class="n">halfgennorm_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;halfgennorm&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">crystalball_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crystalball distribution</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `crystalball` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \beta, m) =  \begin{cases}</span>
<span class="sd">                            N \exp(-x^2 / 2),  &amp;\text{for } x &gt; -\beta\\</span>
<span class="sd">                            N A (B - x)^{-m}  &amp;\text{for } x \le -\beta</span>
<span class="sd">                          \end{cases}</span>

<span class="sd">    where :math:`A = (m / |\beta|)^m  \exp(-\beta^2 / 2)`,</span>
<span class="sd">    :math:`B = m/|\beta| - |\beta|` and :math:`N` is a normalisation constant.</span>

<span class="sd">    `crystalball` takes :math:`\beta &gt; 0` and :math:`m &gt; 1` as shape</span>
<span class="sd">    parameters.  :math:`\beta` defines the point where the pdf changes</span>
<span class="sd">    from a power-law to a Gaussian distribution.  :math:`m` is the power</span>
<span class="sd">    of the power-law tail.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    .. versionadded:: 0.19.0</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;Crystal Ball Function&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Crystal_Ball_function</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shape parameter bounds are m &gt; 1 and beta &gt; 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">m</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">beta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ibeta</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;beta&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ibeta</span><span class="p">,</span> <span class="n">im</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Arbitrary, but the default m=1 is not valid</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return PDF of the crystalball function.</span>

<span class="sd">                                            --</span>
<span class="sd">                                           | exp(-x**2 / 2),  for x &gt; -beta</span>
<span class="sd">        crystalball.pdf(x, beta, m) =  N * |</span>
<span class="sd">                                           | A * (B - x)**(-m), for x &lt;= -beta</span>
<span class="sd">                                            --</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">lhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span>
                    <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">N</span> <span class="o">*</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">lhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the log of the PDF of the crystalball function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span>

        <span class="k">def</span> <span class="nf">lhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">-</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="n">m</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">lhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return CDF of the crystalball function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">rhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span>
                    <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">lhs</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">((</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span>
                    <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">N</span> <span class="o">*</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">beta</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">rhs</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">lhs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
        <span class="n">pbeta</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">ppf_less</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="n">eb2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">eb2</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">C</span> <span class="o">+</span> <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span> <span class="o">-</span>
                    <span class="p">((</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">eb2</span><span class="o">*</span><span class="n">p</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">m</span><span class="p">)))</span>

        <span class="k">def</span> <span class="nf">ppf_greater</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
            <span class="n">eb2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">eb2</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">C</span> <span class="o">+</span> <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">_norm_ppf</span><span class="p">(</span><span class="n">_norm_cdf</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">_norm_pdf_C</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">/</span><span class="n">N</span> <span class="o">-</span> <span class="n">C</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="n">pbeta</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span> <span class="n">f</span><span class="o">=</span><span class="n">ppf_less</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="n">ppf_greater</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the n-th non-central moment of the crystalball function.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span>
                   <span class="n">_norm_pdf_C</span> <span class="o">*</span> <span class="n">_norm_cdf</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">n_th_moment</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Returns n-th moment. Defined only if n+1 &lt; m</span>
<span class="sd">            Function cannot broadcast due to the loop over n</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">m</span><span class="o">/</span><span class="n">beta</span> <span class="o">-</span> <span class="n">beta</span>
            <span class="n">rhs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="p">((</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gamma</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span>
                   <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">n</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">beta</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)))</span>
            <span class="n">lhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">rhs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">lhs</span> <span class="o">+=</span> <span class="p">(</span><span class="n">sc</span><span class="o">.</span><span class="n">binom</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">B</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span>
                        <span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="n">beta</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">m</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">lhs</span> <span class="o">+</span> <span class="n">rhs</span>

        <span class="k">return</span> <span class="n">N</span> <span class="o">*</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">m</span><span class="p">),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">n_th_moment</span><span class="p">,</span> <span class="n">otypes</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]),</span>
                              <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="n">crystalball</span> <span class="o">=</span> <span class="n">crystalball_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;crystalball&#39;</span><span class="p">,</span> <span class="n">longname</span><span class="o">=</span><span class="s2">&quot;A Crystalball Function&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function for the argus distribution used in the pdf, sf and</span>
<span class="sd">    moment calculation.</span>
<span class="sd">    Note that for all x &gt; 0:</span>
<span class="sd">    gammainc(1.5, x**2/2) = 2 * (_norm_cdf(x) - x * _norm_pdf(x) - 0.5).</span>
<span class="sd">    This can be verified directly by noting that the cdf of Gamma(1.5) can</span>
<span class="sd">    be written as erf(sqrt(x)) - 2*sqrt(x)*exp(-x)/sqrt(Pi).</span>
<span class="sd">    We use gammainc instead of the usual definition because it is more precise</span>
<span class="sd">    for small chi.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">sc</span><span class="o">.</span><span class="n">gammainc</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>


<span class="k">class</span> <span class="nc">argus_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Argus distribution</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `argus` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \chi) = \frac{\chi^3}{\sqrt{2\pi} \Psi(\chi)} x \sqrt{1-x^2}</span>
<span class="sd">                     \exp(-\chi^2 (1 - x^2)/2)</span>

<span class="sd">    for :math:`0 &lt; x &lt; 1` and :math:`\chi &gt; 0`, where</span>

<span class="sd">    .. math::</span>

<span class="sd">        \Psi(\chi) = \Phi(\chi) - \chi \phi(\chi) - 1/2</span>

<span class="sd">    with :math:`\Phi` and :math:`\phi` being the CDF and PDF of a standard</span>
<span class="sd">    normal distribution, respectively.</span>

<span class="sd">    `argus` takes :math:`\chi` as shape a parameter. Details about sampling</span>
<span class="sd">    from the ARGUS distribution can be found in [2]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] &quot;ARGUS distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/ARGUS_distribution</span>
<span class="sd">    .. [2] Christoph Baumgarten &quot;Random variate generation by fast numerical</span>
<span class="sd">           inversion in the varying parameter case.&quot; Research in Statistics,</span>
<span class="sd">           vol. 1, 2023, doi:10.1080/27684520.2023.2279060.</span>

<span class="sd">    .. versionadded:: 0.19.0</span>

<span class="sd">    %(example)s</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;chi&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_logpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="c1"># for x = 0 or 1, logpdf returns -np.inf</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span>
            <span class="n">A</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span> <span class="o">-</span> <span class="n">_norm_pdf_logC</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">A</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_logpdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_rvs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chi</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                                   <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shp</span><span class="p">,</span> <span class="n">bc</span> <span class="o">=</span> <span class="n">_check_shape</span><span class="p">(</span><span class="n">chi</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
            <span class="n">numsamples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shp</span><span class="p">))</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
            <span class="n">it</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nditer</span><span class="p">([</span><span class="n">chi</span><span class="p">],</span>
                           <span class="n">flags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;multi_index&#39;</span><span class="p">],</span>
                           <span class="n">op_flags</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;readonly&#39;</span><span class="p">]])</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">it</span><span class="o">.</span><span class="n">finished</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">it</span><span class="o">.</span><span class="n">multi_index</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bc</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">else</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">size</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rvs_scalar</span><span class="p">(</span><span class="n">it</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numsamples</span><span class="o">=</span><span class="n">numsamples</span><span class="p">,</span>
                                     <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shp</span><span class="p">)</span>
                <span class="n">it</span><span class="o">.</span><span class="n">iternext</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="p">():</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[()]</span>
        <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">_rvs_scalar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chi</span><span class="p">,</span> <span class="n">numsamples</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># if chi &lt;= 1.8:</span>
        <span class="c1"># use rejection method, see Devroye:</span>
        <span class="c1"># Non-Uniform Random Variate Generation, 1986, section II.3.2.</span>
        <span class="c1"># write: PDF f(x) = c * g(x) * h(x), where</span>
        <span class="c1"># h is [0,1]-valued and g is a density</span>
        <span class="c1"># we use two ways to write f</span>
        <span class="c1">#</span>
        <span class="c1"># Case 1:</span>
        <span class="c1"># write g(x) = 3*x*sqrt(1-x**2), h(x) = exp(-chi**2 (1-x**2) / 2)</span>
        <span class="c1"># If X has a distribution with density g its ppf G_inv is given by:</span>
        <span class="c1"># G_inv(u) = np.sqrt(1 - u**(2/3))</span>
        <span class="c1">#</span>
        <span class="c1"># Case 2:</span>
        <span class="c1"># g(x) = chi**2 * x * exp(-chi**2 * (1-x**2)/2) / (1 - exp(-chi**2 /2))</span>
        <span class="c1"># h(x) = sqrt(1 - x**2), 0 &lt;= x &lt;= 1</span>
        <span class="c1"># one can show that</span>
        <span class="c1"># G_inv(u) = np.sqrt(2*np.log(u*(np.exp(chi**2/2)-1)+1))/chi</span>
        <span class="c1">#          = np.sqrt(1 + 2*np.log(np.exp(-chi**2/2)*(1-u)+u)/chi**2)</span>
        <span class="c1"># the latter expression is used for precision with small chi</span>
        <span class="c1">#</span>
        <span class="c1"># In both cases, the inverse cdf of g can be written analytically, and</span>
        <span class="c1"># we can apply the rejection method:</span>
        <span class="c1">#</span>
        <span class="c1"># REPEAT</span>
        <span class="c1">#    Generate U uniformly distributed on [0, 1]</span>
        <span class="c1">#    Generate X with density g (e.g. via inverse transform sampling:</span>
        <span class="c1">#    X = G_inv(V) with V uniformly distributed on [0, 1])</span>
        <span class="c1"># UNTIL X &lt;= h(X)</span>
        <span class="c1"># RETURN X</span>
        <span class="c1">#</span>
        <span class="c1"># We use case 1 for chi &lt;= 0.5 as it maintains precision for small chi</span>
        <span class="c1"># and case 2 for 0.5 &lt; chi &lt;= 1.8 due to its speed for moderate chi.</span>
        <span class="c1">#</span>
        <span class="c1"># if chi &gt; 1.8:</span>
        <span class="c1"># use relation to the Gamma distribution: if X is ARGUS with parameter</span>
        <span class="c1"># chi), then Y = chi**2 * (1 - X**2) / 2 has density proportional to</span>
        <span class="c1"># sqrt(u) * exp(-u) on [0, chi**2 / 2], i.e. a Gamma(3/2) distribution</span>
        <span class="c1"># conditioned on [0, chi**2 / 2]). Therefore, to sample X from the</span>
        <span class="c1"># ARGUS distribution, we sample Y from the gamma distribution, keeping</span>
        <span class="c1"># only samples on [0, chi**2 / 2], and apply the inverse</span>
        <span class="c1"># transformation X = (1 - 2*Y/chi**2)**(1/2). Since we only</span>
        <span class="c1"># look at chi &gt; 1.8, gamma(1.5).cdf(chi**2/2) is large enough such</span>
        <span class="c1"># Y falls in the interval [0, chi**2 / 2] with a high probability:</span>
        <span class="c1"># stats.gamma(1.5).cdf(1.8**2/2) = 0.644...</span>
        <span class="c1">#</span>
        <span class="c1"># The points to switch between the different methods are determined</span>
        <span class="c1"># by a comparison of the runtime of the different methods. However,</span>
        <span class="c1"># the runtime is platform-dependent. The implemented values should</span>
        <span class="c1"># ensure a good overall performance and are supported by an analysis</span>
        <span class="c1"># of the rejection constants of different methods.</span>

        <span class="n">size1d</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">numsamples</span><span class="p">))</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">size1d</span><span class="p">))</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
        <span class="n">simulated</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">chi2</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">*</span> <span class="n">chi</span>
        <span class="k">if</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="o">-</span><span class="n">chi2</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">v</span><span class="o">**</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
                <span class="c1"># acceptance condition: u &lt;= h(G_inv(v)). This simplifies to</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">z</span><span class="p">)</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># we still need to transform z=v**(2/3) to X = G_inv(v)</span>
                    <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">accept</span><span class="p">])</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>
        <span class="k">elif</span> <span class="n">chi</span> <span class="o">&lt;=</span> <span class="mf">1.8</span><span class="p">:</span>
            <span class="n">echi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">chi2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">z</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">echi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">v</span><span class="p">)</span> <span class="o">/</span> <span class="n">chi2</span>
                <span class="c1"># as in case one, simplify u &lt;= h(G_inv(v)) and then transform</span>
                <span class="c1"># z to the target distribution X = G_inv(v)</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">accept</span><span class="p">])</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">rvs</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># conditional Gamma for chi &gt; 1.8</span>
            <span class="k">while</span> <span class="n">simulated</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">simulated</span>
                <span class="n">g</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">standard_gamma</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="p">(</span><span class="n">g</span> <span class="o">&lt;=</span> <span class="n">chi2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">num_accept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">num_accept</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">x</span><span class="p">[</span><span class="n">simulated</span><span class="p">:(</span><span class="n">simulated</span> <span class="o">+</span> <span class="n">num_accept</span><span class="p">)]</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">accept</span><span class="p">]</span>
                    <span class="n">simulated</span> <span class="o">+=</span> <span class="n">num_accept</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">chi2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">size1d</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chi</span><span class="p">):</span>
        <span class="c1"># need to ensure that dtype is float</span>
        <span class="c1"># otherwise the mask below does not work for integers</span>
        <span class="n">chi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">_argus_phi</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">chi</span> <span class="o">*</span> <span class="n">sc</span><span class="o">.</span><span class="n">ive</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">chi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="n">phi</span>
        <span class="c1"># compute second moment, use Taylor expansion for small chi (&lt;= 0.1)</span>
        <span class="n">mu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">chi</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">chi</span> <span class="o">&gt;</span> <span class="mf">0.1</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">chi</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">mu2</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span> <span class="o">*</span> <span class="n">_norm_pdf</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">phi</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">chi</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">coef</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">358</span><span class="o">/</span><span class="mi">65690625</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">94</span><span class="o">/</span><span class="mi">1010625</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">/</span><span class="mi">2625</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="o">/</span><span class="mi">175</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">]</span>
        <span class="n">mu2</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">m</span><span class="p">,</span> <span class="n">mu2</span> <span class="o">-</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>


<span class="n">argus</span> <span class="o">=</span> <span class="n">argus_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;argus&#39;</span><span class="p">,</span> <span class="n">longname</span><span class="o">=</span><span class="s2">&quot;An Argus Function&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rv_histogram</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a distribution given by a histogram.</span>
<span class="sd">    This is useful to generate a template distribution from a binned</span>
<span class="sd">    datasample.</span>

<span class="sd">    As a subclass of the `rv_continuous` class, `rv_histogram` inherits from it</span>
<span class="sd">    a collection of generic methods (see `rv_continuous` for the full list),</span>
<span class="sd">    and implements them based on the properties of the provided binned</span>
<span class="sd">    datasample.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    histogram : tuple of array_like</span>
<span class="sd">        Tuple containing two array_like objects.</span>
<span class="sd">        The first containing the content of n bins,</span>
<span class="sd">        the second containing the (n+1) bin boundaries.</span>
<span class="sd">        In particular, the return value of `numpy.histogram` is accepted.</span>

<span class="sd">    density : bool, optional</span>
<span class="sd">        If False, assumes the histogram is proportional to counts per bin;</span>
<span class="sd">        otherwise, assumes it is proportional to a density.</span>
<span class="sd">        For constant bin widths, these are equivalent, but the distinction</span>
<span class="sd">        is important when bin widths vary (see Notes).</span>
<span class="sd">        If None (default), sets ``density=True`` for backwards compatibility,</span>
<span class="sd">        but warns if the bin widths are variable. Set `density` explicitly</span>
<span class="sd">        to silence the warning.</span>

<span class="sd">        .. versionadded:: 1.10.0</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    When a histogram has unequal bin widths, there is a distinction between</span>
<span class="sd">    histograms that are proportional to counts per bin and histograms that are</span>
<span class="sd">    proportional to probability density over a bin. If `numpy.histogram` is</span>
<span class="sd">    called with its default ``density=False``, the resulting histogram is the</span>
<span class="sd">    number of counts per bin, so ``density=False`` should be passed to</span>
<span class="sd">    `rv_histogram`. If `numpy.histogram` is called with ``density=True``, the</span>
<span class="sd">    resulting histogram is in terms of probability density, so ``density=True``</span>
<span class="sd">    should be passed to `rv_histogram`. To avoid warnings, always pass</span>
<span class="sd">    ``density`` explicitly when the input histogram has unequal bin widths.</span>

<span class="sd">    There are no additional shape parameters except for the loc and scale.</span>
<span class="sd">    The pdf is defined as a stepwise function from the provided histogram.</span>
<span class="sd">    The cdf is a linear interpolation of the pdf.</span>

<span class="sd">    .. versionadded:: 0.19.0</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    Create a scipy.stats distribution from a numpy histogram</span>

<span class="sd">    &gt;&gt;&gt; import scipy.stats</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; data = scipy.stats.norm.rvs(size=100000, loc=0, scale=1.5,</span>
<span class="sd">    ...                             random_state=123)</span>
<span class="sd">    &gt;&gt;&gt; hist = np.histogram(data, bins=100)</span>
<span class="sd">    &gt;&gt;&gt; hist_dist = scipy.stats.rv_histogram(hist, density=False)</span>

<span class="sd">    Behaves like an ordinary scipy rv_continuous distribution</span>

<span class="sd">    &gt;&gt;&gt; hist_dist.pdf(1.0)</span>
<span class="sd">    0.20538577847618705</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.cdf(2.0)</span>
<span class="sd">    0.90818568543056499</span>

<span class="sd">    PDF is zero above (below) the highest (lowest) bin of the histogram,</span>
<span class="sd">    defined by the max (min) of the original dataset</span>

<span class="sd">    &gt;&gt;&gt; hist_dist.pdf(np.max(data))</span>
<span class="sd">    0.0</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.cdf(np.max(data))</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.pdf(np.min(data))</span>
<span class="sd">    7.7591907244498314e-05</span>
<span class="sd">    &gt;&gt;&gt; hist_dist.cdf(np.min(data))</span>
<span class="sd">    0.0</span>

<span class="sd">    PDF and CDF follow the histogram</span>

<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; X = np.linspace(-5.0, 5.0, 100)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots()</span>
<span class="sd">    &gt;&gt;&gt; ax.set_title(&quot;PDF from Template&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.hist(data, density=True, bins=100)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(X, hist_dist.pdf(X), label=&#39;PDF&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(X, hist_dist.cdf(X), label=&#39;CDF&#39;)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend()</span>
<span class="sd">    &gt;&gt;&gt; fig.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_support_mask</span> <span class="o">=</span> <span class="n">rv_continuous</span><span class="o">.</span><span class="n">_support_mask</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new distribution using the given histogram</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        histogram : tuple of array_like</span>
<span class="sd">            Tuple containing two array_like objects.</span>
<span class="sd">            The first containing the content of n bins,</span>
<span class="sd">            the second containing the (n+1) bin boundaries.</span>
<span class="sd">            In particular, the return value of np.histogram is accepted.</span>
<span class="sd">        density : bool, optional</span>
<span class="sd">            If False, assumes the histogram is proportional to counts per bin;</span>
<span class="sd">            otherwise, assumes it is proportional to a density.</span>
<span class="sd">            For constant bin widths, these are equivalent.</span>
<span class="sd">            If None (default), sets ``density=True`` for backward</span>
<span class="sd">            compatibility, but warns if the bin widths are variable. Set</span>
<span class="sd">            `density` explicitly to silence the warning.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_histogram</span> <span class="o">=</span> <span class="n">histogram</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_density</span> <span class="o">=</span> <span class="n">density</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">histogram</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected length 2 for parameter histogram&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of elements in histogram content &quot;</span>
                             <span class="s2">&quot;and histogram boundaries do not match, &quot;</span>
                             <span class="s2">&quot;expected n and n+1.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bins_vary</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">density</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bins_vary</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Bin widths are not constant. Assuming `density=True`.&quot;</span>
                       <span class="s2">&quot;Specify `density` explicitly to silence this warning.&quot;</span><span class="p">)</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">density</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">density</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span><span class="p">])</span>
        <span class="c1"># Set support</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PDF of the histogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)]</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        CDF calculated from the histogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ppf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Percentile function calculated from the histogram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hcdf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the n-th non-central moment.&quot;&quot;&quot;</span>
        <span class="n">integrals</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">integrals</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_entropy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute entropy of distribution&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">_lazywhere</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span>
                         <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">,</span>
                         <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_hpdf</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">res</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hbin_widths</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_updated_ctor_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the histogram as additional constructor argument</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_updated_ctor_param</span><span class="p">()</span>
        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;histogram&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_histogram</span>
        <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_density</span>
        <span class="k">return</span> <span class="n">dct</span>


<span class="k">class</span> <span class="nc">studentized_range_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A studentized range continuous random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    t: Student&#39;s t distribution</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The probability density function for `studentized_range` is:</span>

<span class="sd">    .. math::</span>

<span class="sd">         f(x; k, \nu) = \frac{k(k-1)\nu^{\nu/2}}{\Gamma(\nu/2)</span>
<span class="sd">                        2^{\nu/2-1}} \int_{0}^{\infty} \int_{-\infty}^{\infty}</span>
<span class="sd">                        s^{\nu} e^{-\nu s^2/2} \phi(z) \phi(sx + z)</span>
<span class="sd">                        [\Phi(sx + z) - \Phi(z)]^{k-2} \,dz \,ds</span>

<span class="sd">    for :math:`x ≥ 0`, :math:`k &gt; 1`, and :math:`\nu &gt; 0`.</span>

<span class="sd">    `studentized_range` takes ``k`` for :math:`k` and ``df`` for :math:`\nu`</span>
<span class="sd">    as shape parameters.</span>

<span class="sd">    When :math:`\nu` exceeds 100,000, an asymptotic approximation (infinite</span>
<span class="sd">    degrees of freedom) is used to compute the cumulative distribution</span>
<span class="sd">    function [4]_ and probability distribution function.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>

<span class="sd">    .. [1] &quot;Studentized range distribution&quot;,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Studentized_range_distribution</span>
<span class="sd">    .. [2] Batista, Ben Dêivide, et al. &quot;Externally Studentized Normal Midrange</span>
<span class="sd">           Distribution.&quot; Ciência e Agrotecnologia, vol. 41, no. 4, 2017, pp.</span>
<span class="sd">           378-389., doi:10.1590/1413-70542017414047716.</span>
<span class="sd">    .. [3] Harter, H. Leon. &quot;Tables of Range and Studentized Range.&quot; The Annals</span>
<span class="sd">           of Mathematical Statistics, vol. 31, no. 4, 1960, pp. 1122-1147.</span>
<span class="sd">           JSTOR, www.jstor.org/stable/2237810. Accessed 18 Feb. 2021.</span>
<span class="sd">    .. [4] Lund, R. E., and J. R. Lund. &quot;Algorithm AS 190: Probabilities and</span>
<span class="sd">           Upper Quantiles for the Studentized Range.&quot; Journal of the Royal</span>
<span class="sd">           Statistical Society. Series C (Applied Statistics), vol. 32, no. 2,</span>
<span class="sd">           1983, pp. 204-210. JSTOR, www.jstor.org/stable/2347300. Accessed 18</span>
<span class="sd">           Feb. 2021.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; from scipy.stats import studentized_range</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(1, 1)</span>

<span class="sd">    Calculate the first four moments:</span>

<span class="sd">    &gt;&gt;&gt; k, df = 3, 10</span>
<span class="sd">    &gt;&gt;&gt; mean, var, skew, kurt = studentized_range.stats(k, df, moments=&#39;mvsk&#39;)</span>

<span class="sd">    Display the probability density function (``pdf``):</span>

<span class="sd">    &gt;&gt;&gt; x = np.linspace(studentized_range.ppf(0.01, k, df),</span>
<span class="sd">    ...                 studentized_range.ppf(0.99, k, df), 100)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, studentized_range.pdf(x, k, df),</span>
<span class="sd">    ...         &#39;r-&#39;, lw=5, alpha=0.6, label=&#39;studentized_range pdf&#39;)</span>

<span class="sd">    Alternatively, the distribution object can be called (as a function)</span>
<span class="sd">    to fix the shape, location and scale parameters. This returns a &quot;frozen&quot;</span>
<span class="sd">    RV object holding the given parameters fixed.</span>

<span class="sd">    Freeze the distribution and display the frozen ``pdf``:</span>

<span class="sd">    &gt;&gt;&gt; rv = studentized_range(k, df)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, rv.pdf(x), &#39;k-&#39;, lw=2, label=&#39;frozen pdf&#39;)</span>

<span class="sd">    Check accuracy of ``cdf`` and ``ppf``:</span>

<span class="sd">    &gt;&gt;&gt; vals = studentized_range.ppf([0.001, 0.5, 0.999], k, df)</span>
<span class="sd">    &gt;&gt;&gt; np.allclose([0.001, 0.5, 0.999], studentized_range.cdf(vals, k, df))</span>
<span class="sd">    True</span>

<span class="sd">    Rather than using (``studentized_range.rvs``) to generate random variates,</span>
<span class="sd">    which is very slow for this distribution, we can approximate the inverse</span>
<span class="sd">    CDF using an interpolator, and then perform inverse transform sampling</span>
<span class="sd">    with this approximate inverse CDF.</span>

<span class="sd">    This distribution has an infinite but thin right tail, so we focus our</span>
<span class="sd">    attention on the leftmost 99.9 percent.</span>

<span class="sd">    &gt;&gt;&gt; a, b = studentized_range.ppf([0, .999], k, df)</span>
<span class="sd">    &gt;&gt;&gt; a, b</span>
<span class="sd">    0, 7.41058083802274</span>

<span class="sd">    &gt;&gt;&gt; from scipy.interpolate import interp1d</span>
<span class="sd">    &gt;&gt;&gt; rng = np.random.default_rng()</span>
<span class="sd">    &gt;&gt;&gt; xs = np.linspace(a, b, 50)</span>
<span class="sd">    &gt;&gt;&gt; cdf = studentized_range.cdf(xs, k, df)</span>
<span class="sd">    # Create an interpolant of the inverse CDF</span>
<span class="sd">    &gt;&gt;&gt; ppf = interp1d(cdf, xs, fill_value=&#39;extrapolate&#39;)</span>
<span class="sd">    # Perform inverse transform sampling using the interpolant</span>
<span class="sd">    &gt;&gt;&gt; r = ppf(rng.uniform(size=1000))</span>

<span class="sd">    And compare the histogram:</span>

<span class="sd">    &gt;&gt;&gt; ax.hist(r, density=True, histtype=&#39;stepfilled&#39;, alpha=0.2)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend(loc=&#39;best&#39;, frameon=False)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ik</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="n">idf</span> <span class="o">=</span> <span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;df&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ik</span><span class="p">,</span> <span class="n">idf</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_fitstart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Default is k=1, but that is not a valid value of the parameter.</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fitstart</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_moment&#39;</span>
        <span class="n">_a</span><span class="p">,</span> <span class="n">_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_support</span><span class="p">()</span>
        <span class="c1"># all three of these are used to create a numpy array so they must</span>
        <span class="c1"># be the same shape.</span>

        <span class="k">def</span> <span class="nf">_single_moment</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="n">log_const</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_studentized_range_pdf_logconst</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">log_const</span><span class="p">]</span>
            <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>

            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="n">cython_symbol</span><span class="p">,</span> <span class="n">usr_data</span><span class="p">)</span>

            <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="n">_a</span><span class="p">,</span> <span class="n">_b</span><span class="p">)]</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">epsabs</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ufunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">_single_moment</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ufunc</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)[()]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_single_pdf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="c1"># The infinite form of the PDF is derived from the infinite</span>
            <span class="c1"># CDF.</span>
            <span class="k">if</span> <span class="n">df</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
                <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_pdf&#39;</span>
                <span class="n">log_const</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_studentized_range_pdf_logconst</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">log_const</span><span class="p">]</span>
                <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
                <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_pdf_asymptotic&#39;</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
                <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="n">cython_symbol</span><span class="p">,</span> <span class="n">usr_data</span><span class="p">)</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">epsabs</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ufunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">_single_pdf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)[()]</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">_single_cdf</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
            <span class="c1"># &quot;When the degrees of freedom V are infinite the probability</span>
            <span class="c1"># integral takes [on a] simpler form,&quot; and a single asymptotic</span>
            <span class="c1"># integral is evaluated rather than the standard double integral.</span>
            <span class="c1"># (Lund, Lund, page 205)</span>
            <span class="k">if</span> <span class="n">df</span> <span class="o">&lt;</span> <span class="mi">100000</span><span class="p">:</span>
                <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_cdf&#39;</span>
                <span class="n">log_const</span> <span class="o">=</span> <span class="n">_stats</span><span class="o">.</span><span class="n">_studentized_range_cdf_logconst</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">log_const</span><span class="p">]</span>
                <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
                <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">cython_symbol</span> <span class="o">=</span> <span class="s1">&#39;_studentized_range_cdf_asymptotic&#39;</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="p">[</span><span class="n">q</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span>
                <span class="n">usr_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
                <span class="n">ranges</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)]</span>

            <span class="n">llc</span> <span class="o">=</span> <span class="n">LowLevelCallable</span><span class="o">.</span><span class="n">from_cython</span><span class="p">(</span><span class="n">_stats</span><span class="p">,</span> <span class="n">cython_symbol</span><span class="p">,</span> <span class="n">usr_data</span><span class="p">)</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">epsabs</span><span class="o">=</span><span class="mf">1e-11</span><span class="p">,</span> <span class="n">epsrel</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">integrate</span><span class="o">.</span><span class="n">nquad</span><span class="p">(</span><span class="n">llc</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">ranges</span><span class="p">,</span> <span class="n">opts</span><span class="o">=</span><span class="n">opts</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">ufunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frompyfunc</span><span class="p">(</span><span class="n">_single_cdf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># clip p-values to ensure they are in [0, 1].</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ufunc</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">df</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)[()],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>


<span class="n">studentized_range</span> <span class="o">=</span> <span class="n">studentized_range_gen</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;studentized_range&#39;</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                          <span class="n">b</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">rel_breitwigner_gen</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;A relativistic Breit-Wigner random variable.</span>

<span class="sd">    %(before_notes)s</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    cauchy: Cauchy distribution, also known as the Breit-Wigner distribution.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    The probability density function for `rel_breitwigner` is</span>

<span class="sd">    .. math::</span>

<span class="sd">        f(x, \rho) = \frac{k}{(x^2 - \rho^2)^2 + \rho^2}</span>

<span class="sd">    where</span>

<span class="sd">    .. math::</span>
<span class="sd">        k = \frac{2\sqrt{2}\rho^2\sqrt{\rho^2 + 1}}</span>
<span class="sd">            {\pi\sqrt{\rho^2 + \rho\sqrt{\rho^2 + 1}}}</span>

<span class="sd">    The relativistic Breit-Wigner distribution is used in high energy physics</span>
<span class="sd">    to model resonances [1]_. It gives the uncertainty in the invariant mass,</span>
<span class="sd">    :math:`M` [2]_, of a resonance with characteristic mass :math:`M_0` and</span>
<span class="sd">    decay-width :math:`\Gamma`, where :math:`M`, :math:`M_0` and :math:`\Gamma`</span>
<span class="sd">    are expressed in natural units. In SciPy&#39;s parametrization, the shape</span>
<span class="sd">    parameter :math:`\rho` is equal to :math:`M_0/\Gamma` and takes values in</span>
<span class="sd">    :math:`(0, \infty)`.</span>

<span class="sd">    Equivalently, the relativistic Breit-Wigner distribution is said to give</span>
<span class="sd">    the uncertainty in the center-of-mass energy :math:`E_{\text{cm}}`. In</span>
<span class="sd">    natural units, the speed of light :math:`c` is equal to 1 and the invariant</span>
<span class="sd">    mass :math:`M` is equal to the rest energy :math:`Mc^2`. In the</span>
<span class="sd">    center-of-mass frame, the rest energy is equal to the total energy [3]_.</span>

<span class="sd">    %(after_notes)s</span>

<span class="sd">    :math:`\rho = M/\Gamma` and :math:`\Gamma` is the scale parameter. For</span>
<span class="sd">    example, if one seeks to model the :math:`Z^0` boson with :math:`M_0</span>
<span class="sd">    \approx 91.1876 \text{ GeV}` and :math:`\Gamma \approx 2.4952\text{ GeV}`</span>
<span class="sd">    [4]_ one can set ``rho=91.1876/2.4952`` and ``scale=2.4952``.</span>

<span class="sd">    To ensure a physically meaningful result when using the `fit` method, one</span>
<span class="sd">    should set ``floc=0`` to fix the location parameter to 0.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Relativistic Breit-Wigner distribution, Wikipedia,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Relativistic_Breit-Wigner_distribution</span>
<span class="sd">    .. [2] Invariant mass, Wikipedia,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Invariant_mass</span>
<span class="sd">    .. [3] Center-of-momentum frame, Wikipedia,</span>
<span class="sd">           https://en.wikipedia.org/wiki/Center-of-momentum_frame</span>
<span class="sd">    .. [4] M. Tanabashi et al. (Particle Data Group) Phys. Rev. D 98, 030001 -</span>
<span class="sd">           Published 17 August 2018</span>

<span class="sd">    %(example)s</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_argcheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rho</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_shape_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">_ShapeInfo</span><span class="p">(</span><span class="s2">&quot;rho&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">))]</span>

    <span class="k">def</span> <span class="nf">_pdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="c1"># C = k / rho**2</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
            <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">over</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">C</span> <span class="o">/</span> <span class="p">(((</span><span class="n">x</span> <span class="o">-</span> <span class="n">rho</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">rho</span><span class="p">)</span><span class="o">/</span><span class="n">rho</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="c1"># C = k / (2 * rho**2) / np.sqrt(1 + 1/rho**2)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">/</span><span class="n">rho</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">rho</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="p">)))</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="c1"># Sometimes above formula produces values greater than 1.</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_munp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># C = k / (2 * rho)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">rho</span>
            <span class="k">return</span> <span class="n">C</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">rho</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># C = pi * k / (4 * rho)</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="n">rho</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
            <span class="p">)</span> <span class="o">*</span> <span class="n">rho</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rho</span> <span class="o">*</span> <span class="mi">1</span><span class="n">j</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="n">j</span><span class="o">/</span><span class="n">rho</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">C</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

    <span class="k">def</span> <span class="nf">_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rho</span><span class="p">):</span>
        <span class="c1"># Returning None from stats makes public stats use _munp.</span>
        <span class="c1"># nan values will be omitted from public stats. Skew and</span>
        <span class="c1"># kurtosis are actually infinite.</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="nd">@inherit_docstring_from</span><span class="p">(</span><span class="n">rv_continuous</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="c1"># Override rv_continuous.fit to better handle case where floc is set.</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">floc</span><span class="p">,</span> <span class="n">fscale</span> <span class="o">=</span> <span class="n">_check_fit_input_parameters</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span>
        <span class="p">)</span>

        <span class="n">censored</span> <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">CensoredData</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">censored</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">num_censored</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># There are no censored values in data, so replace the</span>
                <span class="c1"># CensoredData instance with a regular array.</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">_uncensored</span>
                <span class="n">censored</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">floc</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">censored</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># The interquartile range approximates the scale parameter gamma.</span>
            <span class="c1"># The median approximates rho * gamma.</span>
            <span class="n">p25</span><span class="p">,</span> <span class="n">p50</span><span class="p">,</span> <span class="n">p75</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
            <span class="n">scale_0</span> <span class="o">=</span> <span class="n">p75</span> <span class="o">-</span> <span class="n">p25</span>
            <span class="n">rho_0</span> <span class="o">=</span> <span class="n">p50</span> <span class="o">/</span> <span class="n">scale_0</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho_0</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;scale&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwds</span><span class="p">:</span>
                <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale_0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">floc</span><span class="p">)</span>
            <span class="n">rho_0</span> <span class="o">=</span> <span class="n">M_0</span> <span class="o">/</span> <span class="n">fscale</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho_0</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>


<span class="n">rel_breitwigner</span> <span class="o">=</span> <span class="n">rel_breitwigner_gen</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;rel_breitwigner&quot;</span><span class="p">)</span>


<span class="c1"># Collect names of classes and objects in this module.</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="n">_distn_names</span><span class="p">,</span> <span class="n">_distn_gen_names</span> <span class="o">=</span> <span class="n">get_distribution_names</span><span class="p">(</span><span class="n">pairs</span><span class="p">,</span> <span class="n">rv_continuous</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="n">_distn_names</span> <span class="o">+</span> <span class="n">_distn_gen_names</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;rv_histogram&#39;</span><span class="p">]</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, DataCebo, Inc.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>